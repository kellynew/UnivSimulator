<!DOCTYPE html>
<html lang="zh-hk">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>//部分數值不在遊戲中使用


        const TBDGPA = 999;   //每到新學期，將總成績單裏的當前學期績點改為--
        //績點相關數據
        const A = 0;
        const ALLimit = 90;
        const Aminus = 1;
        const AminusLLimit = 85;
        const Bplus = 2;
        const BplusLLimit = 82;
        const B = 3;
        const BLLimit = 78;
        const Bminus = 4;
        const BminusLLimit = 75;
        const Cplus = 5;
        const CplusLLimit = 71;
        const C = 6;
        const CLLimit = 66;
        const Cminus = 7;
        const CminusLLimit = 62;
        const D = 8;
        const DLLimit = 60;
        const Dminus = 9;
        const F = 10;
        const gradeNumber = 11;
        //從A到F，共11個成績等級

        //專業相關

        //人文大類
        const ART_MAJOR = 11;  //專業代碼
        const ART_NUM = 6;  //每學期課程數
        const ART_DIFF = 10;  //難度系數，難度系數越大，期末考越簡單。難度系數可以取正值，也可以取負值。
        const artMajorCode = 11;  //專業代碼
        const artMajorText = "人文類專業";  //專業名稱
        const artMajorCourseNum = 6;  //每學期課程數
        const artTotalCourseNum = 46;  //大二、大三，每學期多一門課。即 6x8+4=52，大四下學期寫畢業論文，沒課。再減掉6系46。
        //社科大類
        const SOCIAL_MAJOR = 22;
        const SOCIAL_NUM = 7;
        const SOCIAL_DIFF = 5;
        const socialMajorCode = 22;
        const socialMajorText = "經管法等社科專業";
        const socialMajorCourseNum = 7;
        const socialTotalCourseNum = 53;
        //工科大類
        const ENGINEER_MAJOR = 33;
        const ENGINEER_NUM = 7;
        const ENGINEER_DIFF = 0;
        const engineerMajorCode = 33;
        const engineerMajorText = "新工科類專業";
        const engineerMajorCourseNum = 7;
        const engineerTotalCourseNum = 53;
        //理科大類
        const SCIENCE_MAJOR = 44;
        const SCIENCE_NUM = 5;
        const SCIENCE_DIFF = -10;
        const scienceMajorCode = 44;
        const scienceMajorText = "基礎科學";
        const scienceMajorCourseNum = 5;
        const scienceTotalCourseNum = 39;
        //醫科大類
        const MEDICAL_MAJOR = 55;
        const MEDICAL_NUM = 8;
        const MEDICAL_DIFF = -15;    //計劃修改此處數值，點改仲未諗好
        const medicalMajorCode = 55;
        const medicalMajorText = "醫科專業";
        const medicalMajorCourseNum = 8;
        const medicalTotalCourseNum = 60;

        //不同等級的學期規劃限制
        const MONEY_M_LIMIT = 1000;
        const MONEY_H_LIMIT = 2000;
        const MONEY_EX_LIMIT = 10000;
        const HORIZON_M_LIMIT = 6;
        const HORIZON_H_LIMIT = 13;
        const HORIZON_EX_LIMIT = 24;

        //特殊事件代碼。不同事件的代碼應區分開。
        //一部分代碼不以CODE開頭，但也是事件代碼。彼此取值不能重複。
        const CODE_PIN_KUN = 1234;
        const CODE_XUE_SHENG_HUI = 2345;
        const CODE_GU_GU = 3456;
        const CODE_NOBEL = 4567;
        const CODE_GUOJIANG = 5678;
        const CODE_LIZHI = 5578;
        const CODE_GONGZUO = 2222;
        const BAOYAN_GOOD = 6789;
        const BAOYAN_BAD = 9876;
        const TIAOJI_GOOD = 3344;
        const TIAOJI_BAD = 4433;
        const CODE_XSH1 = 23451;
        const CODE_XSH2 = 23452;
        const CODE_XSH3 = 23453;
        const CODE_GGZ1 = 34567;
        const CODE_GGZ2 = 34568;
        const CODE_GGZ3 = 34569;
        const CODE_NOBEL1 = 45671;
        const CODE_NOBEL2 = 45672;
        const CODE_NOBEL3 = 45673;

        //一些事件的績點、戰力、智力限制
        const GUOJIANG_LIMIT = 370; //拿國獎的gpa下限
        const LIZHI_LIMIT = 330;    //拿勵志的gpa下限
        const XUEYE_LIMIT = 300;    //學業獎學金gpa下限
        const P1_BATTLE_LIMIT = 10; //第一階段事件 戰力要求
        const P2_BATTLE_LIMIT = 15;
        const P3_BATTLE_LIMIT = 22;
        const P1_IQ_LIMIT = 15;
        const P2_IQ_LIMIT = 12;
        const P3_IQ_LIMIT = 9;

        //通關特典
        const giftnone = "佔位符";
        const giftLowrank = "提升通關評價，解鎖更多特典";
        const giftemptystr = "";
        //E評價
        const GIFT_E_RANK = 5;
        const giftAttr1 = "鐵樹枝幹";
        const giftAttr1des = "（全屬性隨機下限+2）";
        const giftLuck1 = "幸運掛飾";
        const giftLuck1des = "(幸運值+2）";
        const giftBattle1 = "玩具拳套";
        const giftBattle1des = "（戰鬥力+2）";
        const ErankGiftTexts = [giftAttr1, giftLuck1, giftBattle1, giftLowrank, giftLowrank, giftLowrank, giftLowrank, giftLowrank, giftLowrank, giftLowrank];
        const ErankGiftDess = [giftAttr1des, giftLuck1des, giftBattle1des, giftemptystr, giftemptystr, giftemptystr, giftemptystr, giftemptystr, giftemptystr, giftemptystr];
        //D評價
        const GIFT_D_RANK = 6;
        const giftInt1 = "智力斗篷";
        const giftInt1des = "（智力隨機下限+6）";
        const giftHor1 = "望遠鏡";
        const giftHor1des = "（眼界隨機下限+6）";
        const giftFin1 = "資本家手杖";
        const giftFin1des = "（財商隨機下限+6）";
        const giftWea1 = "全面脫貧";
        const giftWea1des = "（家境隨機下限+6）";
        const DrankGiftTexts = [giftAttr1, giftLuck1, giftBattle1, giftInt1, giftHor1, giftFin1, giftWea1, giftLowrank, giftLowrank, giftLowrank];
        const DrankGiftDess = [giftAttr1des, giftLuck1des, giftBattle1des, giftInt1des, giftHor1des, giftFin1des, giftWea1des, giftemptystr, giftemptystr, giftemptystr];
        //C評價
        const GIFT_C_RANK = 7;
        const giftAttr2 = "貴族圓環";
        const giftAttr2des = "（全屬性隨機下限+4）";
        const giftLuck2 = "空靈吊墜";
        const giftLuck2des = "（幸運值+5）";
        const giftBattle2 = "攻擊之爪";
        const giftBattle2des = "（戰鬥力+5）";
        const CrankGiftTexts = [giftAttr1, giftLuck1, giftBattle1, giftInt1, giftHor1, giftFin1, giftWea1, giftAttr2, giftLuck2, giftBattle2];
        const CrankGiftDess = [giftAttr1des, giftLuck1des, giftBattle1des, giftInt1des, giftHor1des, giftFin1des, giftWea1des, giftAttr2des, giftLuck2des, giftBattle2des];
        //B評價
        const GIFT_B_RANK = 8;
        const giftWeaex = "地主家嘅傻仔";
        const giftWeaexdes = "（家境拉滿、戰鬥力+5，智力隨機上限-8）";
        const giftMoney = "暴發戶";
        const giftMoneydes = "（家境貧困，但開局金錢+25000）";
        const giftExam = "卷王";
        const giftExamdes = "（大幅提升期末考試成績）";
        const BrankGiftTexts = [giftInt1, giftHor1, giftFin1, giftWea1, giftAttr2, giftLuck2, giftBattle2, giftWeaex, giftMoney, giftExam];
        const BrankGiftDess = [giftInt1des, giftHor1des, giftFin1des, giftWea1des, giftAttr2des, giftLuck2des, giftBattle2des, giftWeaexdes, giftMoneydes, giftExamdes];
        //A評價
        const GIFT_A_RANK = 9;
        const giftAttr3 = "國王頭冠";
        const giftAttr3des = "（全屬性隨機下限+6）";
        const ArankGiftTexts = [giftInt1, giftHor1, giftFin1, giftAttr2, giftLuck2, giftBattle2, giftWeaex, giftMoney, giftExam, giftAttr3];
        const ArankGiftDess = [giftInt1des, giftHor1des, giftFin1des, giftAttr2des, giftLuck2des, giftBattle2des, giftWeaexdes, giftMoneydes, giftExamdes, giftAttr3des];
        //S評價
        const GIFT_S_RANK = 10;
        const giftExceed = "超越極限";
        const giftExceeddes = "（全屬性隨機上限+7）";
        const giftLuck3 = "幸運女神嘅庇佑";
        const giftLuck3des = "（幸運值+12）";
        const SrankGiftTexts = [giftHor1, giftAttr2, giftLuck2, giftBattle2, giftWeaex, giftMoney, giftExam, giftAttr3, giftExceed, giftLuck3];
        const SrankGiftDess = [giftHor1des, giftAttr2des, giftLuck2des, giftBattle2des, giftWeaexdes, giftMoneydes, giftExamdes, giftAttr3des, giftExceeddes, giftLuck3des];

        //結局的評價等級
        const S_END_RANK = 10;
        const A_END_RANK = 9;
        const B_END_RANK = 8;
        const C_END_RANK = 7;
        const D_END_RANK = 6;
        const E_END_RANK = 5;

        //結局代碼。所有以END結尾的，數值要區分開，不能重複
        const MOOD_END = 333;
        const STRENGTH_END = 444;
        const SPIRIT_END = 555;
        const RISK_END = 666;
        const GUAKE_END = 777;
        const BAOYAN_END = 888;
        const KAOYAN_END = 222;
        const BAOYAN1_END = 8881;
        const BAOYAN2_END = 8882;
        const BAOYAN3_END = 8883;
        const KAOYAN1_END = 2221;
        const KAOYAN2_END = 2222;
        const KAOYAN3_END = 2223;
        const BIYE_SHIYE_END = 12; //畢業即失業，要求雙證齊全且沒有工作、沒有學上
        const GONGZUO3_END = 23;
        const GONGZUO2_END = 22;
        const GONGZUO1_END = 21;
        const PERFECT_END = 1333; //考研3+工作3
        const DANBIYE_END = 1434; //單畢業證、沒工作
        const JIEYE_END = 1444;  //結業
        const XSH_END = 1354;
        const GGZ_END = 1453;
        const NOBEL_END = 4513;
        //各專業壞結局
        const ART_END = 3412;
        const SOC_END = 3413;
        const ENG_END = 3414;
        const SCI_END = 3415;
        const MED_END = 3416;




        //記錄一些全局變量。
        //這裏的變量基本都用來儲存單局數據，或作某些重要事件的判斷。開始新一局遊戲時，應重置它們的值。

        //特殊事件flag
        let flagPinKunBuZhu = false;  //貧困補助
        let flagXueShengHui = false; //學生會
        let flagGuGuZhen = false;   //氪金頁游
        let flagNobel = false;    //諾獎相關事件
        let eventPhase = 0;     //記錄各事件進展階段

        //假期事件相關
        let cetBase = 0;  //通過英語四級的基數
        let shixiBase = 0;  //找到實習的基數
        let flagCet = false;  //標誌是否通過四級
        let flagShixi = false;  //標誌是否有實習經歷
        let flagRongYu = false;  //判斷是否有（校級）榮譽

        //期末考試相關
        let numFailedExam = 0;  //表示掛過多少科
        let numCurrentFail = 0;  //這學期多少門考試沒通過
        let flagJuanWang = false;  //與通關特典有關
        let totalGPAArray = [];  //數組，用於儲存考試成績。元素是0-400的績點，不是百分製成績。

        //常規流程控制
        let specialDone = false;  //用於判斷當前學期，是否已發生特殊事件
        let jobpageDone = false; //用於表示第四年的求職計劃頁是否已顯示
        let flagQiuzhi = false;  //判斷玩家是否投簡歷出去
        let globalVocDivPointer = null;  //用來傳參的一個全局指針，沒實際含義
        let flagGradeWarning = false;  //判斷是否觸發過學業警告，目前還沒用到

        //考研、畢業論文通過率計算
        let kaoyanBase = 0;  //考研分基數
        let lunwenBase = 0;   //畢業論文基數
        let flagBaoyan3 = false; //名校保研
        let flagBaoyan2 = false;  //一般學校保研
        let flagBaoyan1 = false;  //辣雞學校保研
        let flagKaoYan3 = false; //名校考研
        let flagKaoYan2 = false; //一般校考研
        let flagKaoYan1 = false;  //一志願考研失敗

        //結局相關flag
        let flagBaoyanEnd = false;
        let flagKaoshangYan = false;  //考上研
        let flagGongzuo3 = false;  //好工作
        let flagGongzuo2 = false; //一般的工作
        let flagGongzuo1 = false; //爛工作
        let flagXuewei = false;  //畢業證+學位證
        let flagDanbiye = false;  //單畢業證
        let flagJieye = false;  //結業
        let isEnd = false;  //非正常死亡




        //歷史最佳記錄
        //!!!!跨局保存，開始新遊戲時不置零。
        let bestRecord = 0;  
    </script>
    <script>//大學相關

        class Univ {
            constructor(name, text, rank, tier, intelligence, horizon, finance, risk, pressure, fee, majorCode, exbuild) {
                this.name = name;   //大學校名
                this.text = text;   //大學描述
                this.rank = rank;   //大學排名
                this.tier = tier;   //大學梯隊
                this.intelligence = intelligence;   //學年結束時對智力的加成
                this.horizon = horizon;          //學年結束時對眼界的加成
                this.finance = finance;           //學年結束時對財商的加成
                this.risk = risk;             //學年結束時增加風險度
                this.pressure = pressure;     //內卷度，與期末考相關
                this.fee = fee;               //大學學費
                this.majorCode = majorCode;   //大學特色專業
                this.exbuild = exbuild;       //大學特色加成
            }
            //不同檔次學校給玩家不同加成，每年年底計算一次。
            update(currentPlayer) {
                currentPlayer.intelligence += this.intelligence;
                currentPlayer.horizon += this.horizon;
                currentPlayer.finance += this.finance;
                currentPlayer.risk += this.risk;
                //大學特色加成
                //如果玩家選擇該校特色專業，則享受加成
                if (this.majorCode === currentPlayer.major) {
                    currentPlayer.intelligence += this.exbuild;
                    currentPlayer.horizon += this.exbuild;
                    currentPlayer.finance += this.exbuild;
                }
            }
        }

        const rank1Univ = new Univ("北京嘅大學", "簡稱北大，各項指標都好強勁。大學裏面嘅最強王者。", 1, 0, 4, 4, 4, 2, 5, 6000, 0, 0);
        const rank2Univ = new Univ("上海嘅大學", "滬濱屹立東南冠，實力不容小覷。", 2, 1, 3, 4, 4, 2, 4, 6500, 0, 0);
        const rank3Univ = new Univ("浙江嘅大學", "簡稱浙大，top3大學，省內巨無霸。", 3, 1, 4, 3, 4, 3, 4, 6500, 0, 0);
        const rank4Univ = new Univ("南京嘅大學", "簡稱南大，學風正，當之無愧嘅第一梯隊。", 4, 1, 4, 3, 3, 3, 4, 6000, 0, 0);
        const rank5Univ = new Univ("某財經大學", "社科類專業實力強勁。", 5, 2, 2, 3, 3, 2, 3, 8000, socialMajorCode, 1);
        const rank6Univ = new Univ("某科技大學", "只有科學冇技術，理科實力強勁。", 6, 2, 3, 2, 2, 3, 4, 6500, scienceMajorCode, 1);
        const rank7Univ = new Univ("某醫科大學", "學校嘅附屬醫院近期成功晉升三甲綜合醫院。", 7, 2, 3, 2, 1, 3, 4, 6500, medicalMajorCode, 1);
        const rank8Univ = new Univ("某師範大學", "學校優先發展純文科，人文大類系業界翹楚。", 8, 2, 2, 2, 2, 2, 3, 7000, artMajorCode, 1);
        const rank9Univ = new Univ("某工業大學", "學校以工科起家，近期喺向新工科轉型。", 9, 2, 2, 2, 2, 3, 4, 7000, engineerMajorCode, 1);
        const rank10Univ = new Univ("中等偏上嘅大學", "比較均衡，學費都系中等偏上嘅。", 10, 3, 2, 2, 2, 2, 2, 8000, 0, 0);
        const rank11Univ = new Univ("某考研神校", "只要學唔死，就往死裏學。", 11, 3, 3, 1, 1, 4, 3, 7500, 0, 0);
        const rank12Univ = new Univ("坐落在大城市嘅大學", "唯一嘅優點系眼界開闊啲。", 12, 3, 1, 2, 1, 2, 2, 8500, 0, 0);
        const rank13Univ = new Univ("普通嘅大學", "能力只有平均值嘅渣渣，學費卻唔便宜。", 13, 4, 1, 1, 1, 1, 1, 9000, 0, 0);
        const rankexUniv = new Univ("辣雞大學", "不如唔上嘅爛學校", 20, 5, 0, 0, 0, 1, 0, 10000, 0, 0);

        const goodUniv = [rank1Univ, rank2Univ, rank3Univ, rank4Univ];
        const fairUniv = [rank5Univ, rank6Univ, rank7Univ, rank8Univ, rank9Univ];
        const poorUniv = [rank10Univ, rank11Univ, rank12Univ, rank13Univ];
        //為防止未知bug出現，把以上數組複製一遍
        const goodUnivList = [rank1Univ, rank2Univ, rank3Univ, rank4Univ];
        const fairUnivList = [rank5Univ, rank6Univ, rank7Univ, rank8Univ, rank9Univ];
        const poorUnivList = [rank10Univ, rank11Univ, rank12Univ, rank13Univ];

        const univList = [rank1Univ, rank2Univ, rank3Univ, rank4Univ, rank5Univ, rank6Univ, rank7Univ, rank8Univ, rank9Univ, rank10Univ, rank11Univ, rank12Univ, rank13Univ, rankexUniv];


    </script>
    <script>//狀態欄

        const statusBanner = {
            strengthSpan: document.createElement("span"),
            moodSpan: document.createElement("span"),
            spiritSpan: document.createElement("span"),
            intelligenceSpan: document.createElement("span"),
            horizonSpan: document.createElement("span"),
            moneySpan: document.createElement("span"),
            strspan1: document.createElement("span"),
            strspan2: document.createElement("span"),
            moospan1: document.createElement("span"),
            moospan2: document.createElement("span"),
            spispan1: document.createElement("span"),
            spispan2: document.createElement("span"),
            intspan1: document.createElement("span"),
            intspan2: document.createElement("span"),
            horspan1: document.createElement("span"),
            horspan2: document.createElement("span"),
            monspan1: document.createElement("span"),
            monspan2: document.createElement("span"),
            strT: "體力：",
            mooT: "心情：",
            spiT: "精力：",
            intT: "智力：",
            horT: "眼界：",
            monT: "金錢：",
            createDiv: function (player) {
                //初始化
                this.strspan1.textContent = this.strT;
                this.moospan1.textContent = this.mooT;
                this.spispan1.textContent = this.spiT;
                this.intspan1.textContent = this.intT;
                this.horspan1.textContent = this.horT;
                this.monspan1.textContent = this.monT;

                this.strspan2.textContent = player.strength.toString();
                this.moospan2.textContent = player.mood.toString();
                this.spispan2.textContent = player.spirit.toString();
                this.intspan2.textContent = "***";
                this.horspan2.textContent = "***";
                this.monspan2.textContent = player.money.toString();

                this.strengthSpan.appendChild(this.strspan1);
                this.strengthSpan.appendChild(this.strspan2);
                this.moodSpan.appendChild(this.moospan1);
                this.moodSpan.appendChild(this.moospan2);
                this.spiritSpan.appendChild(this.spispan1);
                this.spiritSpan.appendChild(this.spispan2);
                this.intelligenceSpan.appendChild(this.intspan1);
                this.intelligenceSpan.appendChild(this.intspan2);
                this.horizonSpan.appendChild(this.horspan1);
                this.horizonSpan.appendChild(this.horspan2);
                this.moneySpan.appendChild(this.monspan1);
                this.moneySpan.appendChild(this.monspan2);

                this.strengthSpan.className = "status-span";
                this.moodSpan.className = "status-span";
                this.spiritSpan.className = "status-span";
                this.intelligenceSpan.className = "status-span";
                this.horizonSpan.className = "status-span";
                this.moneySpan.className = "status-span";

                let div = document.createElement("div");
                div.appendChild(this.strengthSpan);
                div.appendChild(this.moodSpan);
                div.appendChild(this.spiritSpan);
                div.appendChild(this.intelligenceSpan);
                div.appendChild(this.horizonSpan);
                div.appendChild(this.moneySpan);
                div.className = "statusBar";

                this.strspan2.className = "plain-status-span";
                this.moospan2.className = "plain-status-span";
                this.spispan2.className = "plain-status-span";
                this.intspan2.className = "plain-status-span";
                this.horspan2.className = "plain-status-span";
                this.monspan2.className = "plain-status-span";

                return div;
            },
            updateDiv: function (player) {
                this.strspan2.textContent = player.strength.toString();
                this.moospan2.textContent = player.mood.toString();
                this.spispan2.textContent = player.spirit.toString();
                this.monspan2.textContent = player.money.toString();
                if (player.strength < 10) {
                    this.strspan2.className = "warning-status-span";
                } else {
                    this.strspan2.className = "plain-status-span";
                }
                if (player.mood < 10) {
                    this.moospan2.className = "warning-status-span";
                } else {
                    this.moospan2.className = "plain-status-span";
                }
                if (player.spirit < 10) {
                    this.spispan2.className = "warning-status-span";
                } else {
                    this.spispan2.className = "plain-status-span";
                }
                if (player.money < 500) {
                    this.monspan2.className = "warning-status-span";
                } else {
                    this.monspan2.className = "plain-status-span";
                }
                //達到一定條件時，顯示智力、眼界數值
                if (player.intelligence > 10 && player.horizon > 15) {
                    this.intspan2.textContent = player.intelligence.toString();
                } else {
                    this.intspan2.textContent = "***";
                }
                if (player.intelligence > 5 && player.horizon > 20) {
                    this.horspan2.textContent = player.horizon.toString();
                } else {
                    this.horspan2.textContent = "***";
                }

            }
        }

    </script>
    <script>//學期規劃、特殊事件

        //學期規劃
        class schoolPlan {
            constructor(text, description, moneyCost, moodCost, strengthCost, spiritCost, intelligenceBonus, horizonBonus, financeBonus, examBase, battle, risk, luck) {
                this.text = text;
                this.description = description;
                this.moneyCost = moneyCost;
                this.moodCost = moodCost;
                this.strengthCost = strengthCost;
                this.spiritCost = spiritCost;
                this.intelligenceBonus = intelligenceBonus;
                this.horizonBonus = horizonBonus;
                this.financeBonus = financeBonus;
                this.examBase = examBase;
                this.battle = battle;
                this.risk = risk;
                this.luck = luck;
            }

            //根據具體事件，消耗或恢復體力、心情、體力等
            //統一用加法。消耗體力的事件，事件中strength用負數表示。
            updateAttr(player) {
                player.mood += this.moodCost;
                player.spirit += this.spiritCost;
                player.strength += this.strengthCost;
                player.money += this.moneyCost;
                player.intelligence += this.intelligenceBonus;
                player.horizon += this.horizonBonus;
                player.finance += this.financeBonus;
                player.examBase += this.examBase;
                player.battle += this.battle;
                player.risk += this.risk;
                player.luck += this.luck;
                //體力、精力、心情上限100
                if (player.mood >= 100) {
                    player.mood = 100;
                }
                if (player.spirit >= 100) {
                    player.spirit = 100;
                }
                if (player.strength >= 100) {
                    player.strength = 100;
                }
                //風險不能降到0以下
                if (player.risk <= 0) {
                    player.risk = 0;
                }
                //幸運值最高20
                if (player.luck >= 20) {
                    player.luck = 20;
                }
                //更新狀態欄的各項數值
                statusBanner.updateDiv(player);

                //在這裏加入考研、找工作、寫畢業論文相關判定。
                if (this.text === splanQiuZhao.text) {
                    flagQiuzhi = true;
                    let x = seekJob(player, 10);
                    if (x === 3) {
                        flagGongzuo3 = true;
                    } else if (x === 2) {
                        flagGongzuo2 = true;
                    } else if (x === 1) {
                        flagGongzuo1 = true;
                    }
                }
                if (this.text === splanChunZhao.text) {
                    flagQiuzhi = true;
                    let x = seekJob(player, 5);
                    if (x === 3) {
                        flagGongzuo3 = true;
                    } else if (x === 2) {
                        flagGongzuo2 = true;
                    } else if (x === 1) {
                        flagGongzuo1 = true;
                    }
                }
                if (this.text === splanKaoYan.text) {
                    kaoyanBase += 30;
                }
                if (this.text === splanGuanXi.text) {
                    kaoyanBase += 100;
                }
                if (this.text === splanLunWen.text) {
                    lunwenBase += 10;
                }
                if (this.text === splanMaiLunWen.text) {
                    lunwenBase += 50;
                }
            }
        };

        //根據眼界值不同，顯示不同規劃

        //數值參考：
        //1低級決斷 = 25狀態
        //1中級決斷 = 40狀態
        //1高級決斷 = 100狀態
        //1其他屬性 = 50狀態 = 2000金錢
        //1智力 = 1.5其他屬性
        //1屬性 = -4風險
        //1examBase = 5狀態

        //1決斷 約等於 25狀態

        //投入1低級決斷，產出狀態值期望5+15+5=25。
        const splanFaDai = new schoolPlan("發呆", "小幅恢復心情、精力，較大幅恢復體力。", 0, GRI(4, 6), GRI(12, 17), GRI(4, 6), 0, 0, 0, 0, 0, 0, 0);
        const splanJuanJiDian = new schoolPlan("卷績點", "消耗心情、精力，小幅消耗體力。提高期末考試成績（僅限本學期）。", 0, -GRI(8, 12), -GRI(4, 6), -GRI(8, 12), 0, 0, 0, GRI(8, 12), 0, 0, 0);
        const splanDaGong = new schoolPlan("兼職打工", "小幅消耗心情、精力，較大幅度消耗體力。賺取兩千塊左右嘅零用錢。", GRI(1500, 2500), -GRI(4, 6), -GRI(12, 17), -GRI(4, 6), 0, 0, 0, 0, 0, 0, 0);
        const splanLiCai = new schoolPlan("閒錢理財", "消耗心情、精力，小幅消耗體力。小幅提升財商。", GRI(0, 100), -GRI(8, 12), -GRI(4, 6), -GRI(8, 12), 0, 0, GRI(1, 2), 0, 0, 0, 0);
        const splanDuiXian = new schoolPlan("同網友對線", "小幅消耗心情、精力，小幅提升戰鬥力。", 0, -GRI(4, 6), 0, -GRI(4, 6), 0, 0, 0, 0, GRI(1, 2), GRI(1, 2), 0);
        const lowSplanList = [splanFaDai, splanJuanJiDian, splanDaGong, splanLiCai, splanDuiXian];

        //1決斷 約等於 40狀態
        const splanLvYou = new schoolPlan("旅遊", "花一千塊錢左右。小幅消耗體力，恢復心情、精力。小幅提升眼界。", -GRI(800, 1200), GRI(8, 12), -GRI(4, 6), GRI(8, 12), 0, GRI(1, 2), 0, 0, 0, 0, 0);
        const splanBaoBan = new schoolPlan("報培訓班", "花一千塊錢左右。小幅消耗心情、精力，小幅提升智力。", -GRI(800, 1200), -GRI(4, 6), 0, -GRI(4, 6), GRI(1, 2), 0, 0, 0, 0, 0, 0);
        const splanXunXin = new schoolPlan("尋釁滋事", "花一千塊錢左右。小幅消耗體力、精力，提高戰鬥力。", -GRI(800, 1200), 0, -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0, GRI(1, 3), GRI(1, 3), 0);
        const splanMaiDaAn = new schoolPlan("買答案", "花一千塊錢左右搵任課老師買答案，大幅提高期末考試成績。", -GRI(800, 1200), 0, 0, 0, 0, 0, 0, GRI(18, 22), 0, GRI(2, 4), 0);
        //投入1中級決斷、8+8=16點狀態（總計56點狀態），產出1200金錢（折合30狀態）、0.5眼界（折合25狀態）
        const splanZiMeiTi = new schoolPlan("做自媒體", "消耗心情、精力，可能賺可能蝕。可能能提升眼界。", GRI(-1600, 4000), -GRI(6, 10), 0, -GRI(6, 10), 0, GRI(0, 1), 0, 0, 0, 0, 0);
        const middleSplanList = [splanLvYou, splanBaoBan, splanXunXin, splanMaiDaAn, splanZiMeiTi];

        //1決斷 約等於 100狀態
        const splanTangPing = new schoolPlan("躺平", "乜都唔做，較大幅度恢復心情、精力、體力。可能會有好事發生。", 0, GRI(12, 17), GRI(12, 17), GRI(12, 17), 0, 0, 0, 0, 0, -GRI(1, 2), GRI(1, 2));
        const splanHeiKe = new schoolPlan("威脅學霸做替考", "極大幅提高期末考試成績。", 0, 0, 0, 0, 0, 0, 0, GRI(25, 35), 0, GRI(3, 5), 0);
        const splanChaoGu = new schoolPlan("炒股票", "大概率蝕好多，較大幅度提升財商。", GRI(-3600, 400), 0, 0, 0, 0, 0, GRI(2, 4), 0, 0, 0, 0);
        const splanLianAi = new schoolPlan("談戀愛", "花兩千塊左右，大幅消耗體力，恢復心情、精力。較大幅度提升眼界。", -GRI(1500, 2500), GRI(8, 12), -GRI(17, 23), GRI(8, 12), 0, GRI(2, 4), 0, 0, 0, 0, 0);
        const splanGanRao = new schoolPlan("唔畀室友學習", "消耗體力，提高自己嘅期末成績，較大幅度提高戰鬥力。但係會變笨。", 0, 0, -GRI(8, 12), 0, -GRI(1, 2), 0, 0, GRI(8, 12), GRI(2, 4), GRI(2, 4), 0);
        const highSplanList = [splanTangPing, splanHeiKe, splanChaoGu, splanLianAi, splanGanRao];

        //1決斷 約等於 400狀態
        const splanGeJiuCai = new schoolPlan("操縱金融市場", "割散戶韭菜，一次就能賺一萬左右，極大幅提高財商同戰鬥力。但可能會發生唔好嘅事。", GRI(8000, 12000), 0, 0, 0, 0, 0, GRI(4, 6), 0, GRI(4, 6), GRI(18, 22), 0);
        const splanTiKao = new schoolPlan("黑進教務系統", "期末成績拉滿，順便勒索學校兩千塊錢，極大幅提高戰鬥力。但唔肯定會遭報應。", 2000, 0, 0, 0, 0, 0, 0, 100, GRI(4, 6), GRI(18, 22), 0);
        const splanChanHui = new schoolPlan("懺悔", "向地球OL管理員坦白罪過，祈求寬恕。捐出五千塊錢，大幅消耗體力、精力、心情。", -5000, -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 0, 0, 0, -GRI(23, 25), GRI(5, 7));
        const splanKeYan = new schoolPlan("做科研", "消耗體力、精力、心情，極大幅度增加智力，仲能夠攞兩千塊左右嘅補助。", GRI(1800, 2200), -GRI(8, 12), -GRI(8, 12), -GRI(8, 12), GRI(4, 6), 0, 0, 0, 0, 0, 0);
        const splanJiuYe = new schoolPlan("做市場調研", "消耗體力，極大幅度增加求職成功率，仲能提高財商。", 0, 0, -GRI(8, 12), 0, 0, GRI(4, 6), GRI(1, 3), 0, 0, 0, GRI(1, 2));  //眼界同求職成功率正相關
        const splanDuJia = new schoolPlan("去豪華酒店度假", "花一萬塊錢，體力、精力、心情全部恢復到滿狀態。較大幅度增加幸運值。", -10000, 200, 200, 200, 0, 0, 0, 0, 0, 0, GRI(4, 6));
        const exSplanList = [splanGeJiuCai, splanTiKao, splanChanHui, splanKeYan, splanJiuYe, splanDuJia];

        //零體力、零錢嗰陣，返去特殊規劃
        const splanBanZhuan = new schoolPlan("搬磚", "搭落去半條命，賺幾千塊錢。", GRI(3000, 5000), -GRI(35, 45), -GRI(35, 45), -GRI(35, 45), 0, 0, 0, 0, 0, 0, 0);
        const zeroStrengthPlans = lowSplanList;
        const zeroMoneyPlans = [splanBanZhuan, splanLvYou, splanBaoBan, splanChaoGu, splanLianAi];

        //大四學年涉及考研、就業、寫畢業論文等，適用特殊嘅一組規劃
        const splanJYFudao = new schoolPlan("聽就業輔導講座", "花五千塊錢，聽職場前輩傳授人生經驗。可能比自己悶頭投簡歷強。（較大幅度增加求職成功率。）", -5000, 0, 0, 0, 0, GRI(2, 4), 0, 0, 0, 0, 0);    //求職成功率同眼界正相關
        const splanXiuZheng = new schoolPlan("休整", "花啲小錢，食好飲好休息好。（花一兩千塊錢，大幅恢復體力、精力、心情。）", -GRI(1500, 2500), GRI(17, 23), GRI(17, 23), GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanQiuZhao = new schoolPlan("秋招投簡歷", "一口氣投十份簡歷出去，總能攞到offer啦？（投出十份簡歷，大幅消耗精力。）", 0, 0, 0, -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanKaoYan = new schoolPlan("復習考研", "大幅消耗體力、精力、心情，小幅提升考研成績。", 0, -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanGuanXi = new schoolPlan("搵關係，買今年嘅考研題", "花五千塊買原題，考研穩如老狗。但只要平時認真復習，而家唔搵關係都能考上啦？", -5000, 0, 0, 0, 0, 0, 0, 0, 0, GRI(38, 42), 0);
        const splanChunZhao = new schoolPlan("春招投簡歷", "唔肯定秋招投嘅簡歷已經出結果咗。但保險起見，仲係繼續投啦。（投出五份簡歷，大幅消耗精力。）", 0, 0, 0, -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanLunWen = new schoolPlan("準備畢業論文", "總得畢業啦？唔係四年學白上咗。（大幅消耗體力、精力、心情，提高畢業答辯通過率。）", 0, -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanMaiLunWen = new schoolPlan("買畢業論文", "只要價格啱，願意寫本科畢業論文嘅一抓一大把。點解非得自己寫？（花兩萬塊錢，大幅提高畢業答辯通過率。）", -20000, 0, 0, 0, 0, 0, 0, 0, 0, GRI(46, 54), 0);
        const DaSiShangSplanList = [splanQiuZhao, splanKaoYan, splanXiuZheng, splanJYFudao, splanGuanXi];  //大四上plan
        //因為後續處理中，涉及錢唔夠禁止揀相關選項嘅操作。呢個陣列各計劃順序唔能調換。
        const DaSiXiaSplanList = [splanChunZhao, splanLunWen, splanXiuZheng, splanJYFudao, splanMaiLunWen]; //同樣，呢度各計劃順序唔能調換。



        //特殊事件


        class specialEvent {
            constructor(text, description, moneyCost, moodCost, strengthCost, spiritCost, intelligenceBonus, financeBonus, battle, risk, code, examBase) {
                this.text = text;
                this.description = description;
                this.moneyCost = moneyCost;
                this.moodCost = moodCost;
                this.strengthCost = strengthCost;
                this.spiritCost = spiritCost;
                this.intelligenceBonus = intelligenceBonus;
                this.financeBonus = financeBonus;
                this.battle = battle;
                this.risk = risk;
                this.code = code; //事件識別碼
                this.examBase = examBase;
            }

            //根據具體事件，消耗或恢復體力、心情、體力等
            //統一用加法。消耗體力的事件，事件中strength用負數表示。
            updateAttr(player) {
                player.mood += this.moodCost;
                player.spirit += this.spiritCost;
                player.strength += this.strengthCost;
                player.money += this.moneyCost;
                player.intelligence += this.intelligenceBonus;
                player.finance += this.financeBonus;
                player.risk += this.risk;
                player.battle += this.battle;
                player.examBase += this.examBase;

                if (player.mood >= 100) {
                    player.mood = 100;
                }
                if (player.spirit >= 100) {
                    player.spirit = 100;
                }
                if (player.strength >= 100) {
                    player.strengh = 100;
                }
                if (player.risk <= 0) {
                    player.risk = 0;
                }
                //更新狀態欄的各項數值
                statusBanner.updateDiv(player);
            }
        };

        //貧困生相關事件
        const seventPinKunRenDing = new specialEvent("家境貧寒，認定咗貧困生資格", "拿到2000塊錢補助。如果成績優秀，仲有機會評上勵志獎學金。", 2000, 0, 0, 0, 0, 0, 0, 0, CODE_PIN_KUN, 0);
        const seventPinKunBuZhu = new specialEvent("貧困補助到賬", "拿到兩千塊錢。但系要強制參加活動，仲要完善啲證明材料，有啲麻煩。（小幅消耗心情、精力、體力。）", 2000, -GRI(4, 6), -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0, 0, 0);
        const seventPinKunXueYe = new specialEvent("學業獎學金", "最普羅大眾嘅獎學金，冇乜好講嘅。同貧困生補助加埋，能有四千塊錢。", 4000, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventLiZhi = new specialEvent("勵志獎學金", "評上勵志獎學金，手頭寬裕好多。同貧困生補助加埋，足足七千塊嘅。", 7000, 0, 0, 0, 0, 0, 0, 0, CODE_LIZHI, 0);
        const seventPinKunGuoJiang = new specialEvent("拿到國家獎學金", "拿到八千塊錢。再加上今年兩千嘅貧困生補助，到手一共一萬塊。既有面子又有里子。", 10000, 0, 0, 0, 0, 0, 0, 0, CODE_GUOJIANG, 0);

        //獎學金事件
        const seventXueYe = new specialEvent("學業獎學金", "只要努力學習，就能拿到嘅獎學金。唔需要天賦。獎金得區區兩千塊，仲唔夠一個月花嘅。", 2000, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventGuoJiang = new specialEvent("拿到國家獎學金", "學校冇設置其他花裏胡哨嘅榮譽，國獎到頂。佢證明你學業上無敵咗——順便重給你八千塊錢。", 8000, 0, 0, 0, 0, 0, 0, 0, CODE_GUOJIANG, 0);

        //學生會事件
        const seventXueShengHui = new specialEvent("加入咗學生會", "唔肯定會有好事發生。有學生會經歷，將來搵工嘅時候都方便啲。但系入會面試有啲麻煩，仲要做份好正式嘅簡歷，花咗唔少時間。（小幅消耗心情、精力、體力。）", 0, -GRI(4, 6), -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0, CODE_XUE_SHENG_HUI, 0);
        //命名規則：route Xueshenghui (phase) 1
        const rXsh1 = new specialEvent("出任校會部長", "當上咗辦公室副主任（正部長級）。校學生會嘅中流砥柱。既要喺一線做事，又要搞好部門內團隊建設。今日請學弟學妹食飯，花咗唔少錢。但心情變好咗。", -GRI(800, 1299), GRI(8, 12), 0, 0, 0, 0, 0, 0, CODE_XSH1, 0);
        const rXsh2 = new specialEvent("擠進校會主席團", "作為主席團成員兼任辦公室主任，屬於副主席級高幹。每週都要開工作會議懟人。戰鬥力較大幅度提升咗。", 0, 0, 0, 0, 0, 0, 3, 0, CODE_XSH2, 0);
        const rXsh3 = new specialEvent("成為學生會長", "校會一把手，整個學校都喺肩上扛住，位高權重。跳出三界外，唔喺五行中。直接成為人生贏家。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_XSH3, 0);
        const rListXsh = [rXsh1, rXsh2, rXsh3];

        //課金頁游事件
        const seventGuGuZhen = new specialEvent("發現一款課金頁游", "有乜非玩不可嘅理由咩？騙課唔講，仲愈玩愈氣。（課咗五百塊、小幅降低心情。）", -500, -GRI(4, 6), 0, 0, 0, 0, 0, 0, CODE_GU_GU, 0);
        const rGGZ1 = new specialEvent("入圍排行榜", "往頁游裏課金，不知不覺課到全服前一百咗。（剛講完又課咗兩千入去。）", -2000, 0, 0, 0, 0, 0, 0, 0, CODE_GGZ1, 0);
        const rGGZ2 = new specialEvent("擠進全服前十", "屌，居然課到全服前十咗。少講都砸咗五千塊入去啦？", -5000, 0, 0, 0, 0, 0, 0, 0, CODE_GGZ2, 0);
        const rGGZ3 = new specialEvent("頁游登頂", "砸咗兩萬入去，總算站上排行榜第一嘅位置咗。大學？嗰系乜嘢？有課金頁游就夠咗。", -20000, 0, 0, 0, 0, 0, 0, 0, CODE_GGZ3, 0);
        const rListGGZ = [rGGZ1, rGGZ2, rGGZ3];

        //諾獎事件
        const seventNobel = new specialEvent("生死看淡，唔服就乾", "sb網友叫囂住公園單挑。你無所畏懼，對方反倒慫咗。真爽。（恢復心情、大幅提升戰鬥力）", 0, GRI(8, 12), 0, 0, 0, 0, GRI(2, 4), GRI(3, 4), CODE_NOBEL, 0);
        const rNobel1 = new specialEvent("嶄露頭角", "你日日喺網上對線，發現別人都系sb。突然，你轉念一想。可能唔系人哋傻，而系你太聰明咗。（增加戰鬥力。）", 0, 0, 0, 0, 0, 0, GRI(1, 3), 0, CODE_NOBEL1, 0);
        const rNobel2 = new specialEvent("證明咗哥德巴赫猜想", "你苦思冥想，終於證明出咗哥德巴赫猜想。你搵到數學系嘅老師，佢卻說你系民科。你感到好氣憤。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_NOBEL2, 0);
        const rNobel3 = new specialEvent("獲得諾貝爾獎", "經過一年努力，你又解決咗好多數學難題。你嘅辯論技巧有所提升，用物理手段說服咗數學院所有老師。數學院學術委員會研究決定，授予你諾貝爾數學獎。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_NOBEL3, 0);
        const rListNobel = [rNobel1, rNobel2, rNobel3];

        //三條特殊路線嘅前置事件數組
        //命名規則：special event 前置
        const seQianZhi = [seventXueShengHui, seventGuGuZhen, seventNobel];//大四相關事件。
        //主要系將文字消息提示畀用戶，相關數據處理喺別嘅地方進行。
        const seventBaoyanGood = new specialEvent("預錄取", "推免系統開放，被研究生學校嘅老師催住填咗佢哋。一分耕耘一分收穫，總算有學上咗。", 0, 0, 0, 0, 0, 0, 0, 0, BAOYAN_GOOD, 0);
        const seventBaoyanBad = new specialEvent("咕咕咕", "推免系統卡頓，研究生學校話佢哋冇名額喇。煮熟嘅鴨子飛咗，仲有噉嘅操作？（大幅降低心情、精力。）", 0, -GRI(17, 23), 0, -GRI(17, 23), 0, 0, 0, 0, BAOYAN_BAD, 0);
        const seventTiaojiGood = new specialEvent("調劑上岸", "調劑去咗一所辣雞大學。算喇，有書念總好過冇有。", 0, 0, 0, 0, 0, 0, 0, 0, TIAOJI_GOOD, 0);
        const seventTiaojiBad = new specialEvent("調劑失敗", "見鬼，就冇一所大學要我？（心情變差喇。）", 0, -GRI(25, 35), 0, 0, 0, 0, 0, 0, TIAOJI_BAD, 0);
        const seventGongzuo3 = new specialEvent("令人心動嘅offer", "名企管培生，在寫字樓上班嘅職場精英。有望兩年內晉升中層領導，五年躋身高管序列。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_GONGZUO, 0);
        const seventGongzuo2 = new specialEvent("差強人意嘅offer", "工作枯燥乏味，工資就噉樣，附近房租卻唔低。走一步睇一步喇。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_GONGZUO, 0);
        const seventGongzuo1 = new specialEvent("黑作坊offer", "郊區黑作坊兩班倒，比牛馬仲牛馬。一定系你上輩子修來嘅福報。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_GONGZUO, 0);
        const seventGongzuo0 = new specialEvent("顆粒無收", "搵咗一整年工作，卻冇任何一家公司要你。認命喇。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);

        const seventKeGaiDasi = new specialEvent("嚴抓畢設質量", "為迎接教育部門檢查，校領導要求提升本科學位論文質量，加強論文評審工作。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventShiJuanDasi = new specialEvent("放放水啦", "畢業答辯前夕，班上一位同學試圖一躍解千愁。院領導連夜開會，要求論文答辯放水，防止類似事件再次發生。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);

        //其他特殊事件

        //負面事件。根據風險值，概率觸發。
        const seventMaiBi = new specialEvent("買筆", "有人上門推銷，自稱系經濟系畢業班學生，做緊社會實踐，要你買佢嘅筆。一看系騙子。你揍咗佢一頓，唔使賠佢醫藥費。（損失一筆錢，大幅消耗體力、精力、心情，小幅提升戰鬥力。）", -GRI(1500, 2500), -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 1, 1, 0, 0);
        const seventKeGai = new specialEvent("教學質量", "連續好幾屆學生反映，期末考試太簡單、冇區分度。任課老師痛定思痛，狠抓教學質量，順便加大期末考試難度。（降低本學期期末考試成績。）", 0, 0, 0, 0, 0, 0, 0, 0, 0, -GRI(8, 12));
        const seventChaoJia = new specialEvent("寢室矛盾", "因為寢室衛生問題，跟室友大打出手。雙方都很唔爽。（大幅降低心情、精力，提高戰鬥力。）", 0, -GRI(17, 23), 0, -GRI(17, 23), 0, 0, GRI(1, 3), GRI(4, 5), 0, 0);
        const seventXueHan = new specialEvent("血汗工廠", "被輔導員賣去血汗工廠打工。搭落去半條命，卻只攞到幾百塊勞務費。", GRI(400, 600), 0, -GRI(40, 60), 0, 0, 0, 0, 0, 0, 0);
        const seventHengHuo = new specialEvent("飛來橫禍", "上學路上被板磚砸到腦袋。乍看上去冇問題，但可能落下後遺症。（可能小幅降低智力）", 0, 0, 0, 0, -GRI(0, 2), 0, 0, 0, 0, 0);
        const badSeventList = [seventMaiBi, seventKeGai, seventChaoJia, seventXueHan, seventHengHuo];
        //極端負面事件
        const seventZhaPian = new specialEvent("AI詐騙", "有人用AI大模型生成影片，冒充你嘅輔導員讓你打錢。血虧一萬塊唔講，心情都變差咗。", -10000, -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0, 0);
        const seventXiaDu = new specialEvent("飲水機下毒", "室友往飲水機裏放慢性毒藥。你偶爾感到唔舒服，但冇想太多。不知不覺中變傻咗。（極大幅度降低智商、財商）", 0, 0, 0, 0, -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0);
        const seventJueWang = new specialEvent("絕望", "學校發佈就業報告。你仔細閱讀，發現你們學院嘅本科就業率只有個位數。你絕望喇。", 0, -100, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventChuanXiao = new specialEvent("被騙進傳銷窩點", "你好朋友要帶你一起發財。你同意咗，結果被騙去傳銷窩點。你耗盡全部體力，總算搵到機會逃出嚟。", 0, 0, -100, 0, 0, 0, 0, 0, 0, 0);
        const seventDiuShuJu = new specialEvent("電腦壞咗", "你嘅創新項目即將結項答辯，結果做好嘅文件打不開喇。你拆落硬碟，去電腦城搵人恢復數據，又被騙咗一筆錢。（精力清空。）", -GRI(1500, 2500), 0, 0, -100, 0, 0, 0, 0, 0, 0);
        const vbadSeventList = [seventZhaPian, seventXiaDu, seventJueWang, seventChuanXiao, seventDiuShuJu];

        //正面事件 根據幸運值，概率觸發。
        const seventJianQian = new specialEvent("撿錢", "上學路上撿到一個銀包，裏面有幾千塊錢。真走運。", GRI(2000, 4000), 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventJiangzuo = new specialEvent("聽講座", "聽咗一場經濟學講座。學到唔少經濟知識，仲收到一個小禮物。（獲得幾百塊錢，提升財商。）", GRI(400, 600), 0, 0, 0, 0, GRI(1, 3), 0, 0, 0, 0);
        const seventShiJuan = new specialEvent("往年試卷", "意外地入手一份去年嘅期末考試卷。雖然無法確定真假，但睇落似噉嘢。（提升期末考試成績）", 0, 0, 0, 0, 0, 0, 0, 0, 0, GRI(8, 12));
        const seventJingSai = new specialEvent("競賽獲獎", "參加學校舉辦嘅知識競賽，意外獲獎。感覺突然變聰明咗？（恢復心情、精力，小幅提升智商。）", 0, GRI(8, 12), 0, GRI(8, 12), 1, 0, 0, 0, 0, 0);
        const seventPoCai = new specialEvent("破財消災", "丟咗一百塊錢，可能系乜嘢好兆頭。（略微降低負面事件發生概率。）", -100, 0, 0, 0, 0, 0, 0, -GRI(3, 5), 0, 0);
        const goodSeventList = [seventJianQian, seventJiangzuo, seventShiJuan, seventJingSai, seventPoCai];
        //畀更強buff嘅正面事件
        const seventManJi = new specialEvent("滿分預定", "你完成咗老師佈置嘅大作業。老師好滿意，讓你向全班同學作報告，並當場宣佈你期末滿分。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 100);
        const seventZhanLi = new specialEvent("戰力爆表", "上課時遭到恐怖襲擊。你臨危唔亂，利用教室桌椅做掩護，徒手制服三名持槍嘅恐怖分子。戰鬥力極大幅度上升，仲得到咗五千塊獎金。", 5000, 0, 0, 0, 0, 0, GRI(4, 6), 0, 0, 0);
        const seventXianRen = new specialEvent("仙人撫頂", "夢中受智慧之神點撥，洞察萬物之理。智商極大幅度上升。", 0, 0, 0, 0, GRI(4, 6), 0, 0, 0, 0, 0);
        const seventYinHang = new specialEvent("和行長吃飯", "你二代室友同銀行行長吃飯，順便拉你湊數。你聽到唔少內幕消息，理財觀念被刷新。（財商極大幅度提升。）", 0, 0, 0, 0, 0, GRI(4, 6), 0, 0, 0, 0);
        const seventXinPing = new specialEvent("心平氣和", "調理陰陽，達到天人合一嘅境界。身心都得到休息，與世無爭。", 0, GRI(40, 60), GRI(40, 60), GRI(40, 60), 0, 0, 0, -GRI(8, 12), 0, 0);
        const vgoodSeventList = [seventManJi, seventZhanLi, seventXianRen, seventYinHang, seventXinPing];


        //隨機數方法
        function GRI(min, max) {
            if (min >= max) {
                return max;
            }  //這個判斷可能是多餘的
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
    <script>//一些簡單的計算函數。
        //注意，部分函數涉及對全局變量的訪問與修改。


        //生成min和max之間的隨機整數，包括min和max。最大不超過max
        function getRandomInteger(min, max) {
            if (min >= max) {
                return max;
            }  //這個判斷可能是多餘的
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        //隨機給出玩家初始屬性。可以選擇通關特典，獲得特殊加成
        function initializePlayerBuild(currentPlayer, giftstr1, giftstr2) {
            //不啟用任何特典的情況下，四項屬性取0-10之間的隨機數。
            let wl = 0;  //wealth lower limit
            let wu = 10;
            let il = 0;
            let iu = 10;
            let hl = 0;
            let hu = 10;
            let fl = 0;
            let fu = 10;
            currentPlayer.money = 0;
            //通關特典giftExam，涉及期末考試相關計算。由於作為玩家屬性的examBase每學期都被置零，這裏不做修改。在期末考試部分做修改。此處只設置一個flag。
            if (giftstr1 === giftExam || giftstr2 === giftExam) {
                flagJuanWang = true;
            }
            switch (giftstr1) {
                case giftAttr1: {
                    wl += 2;
                    il += 2;
                    hl += 2;
                    fl += 2;
                    break;
                }
                case giftLuck1: {
                    currentPlayer.luck += 2;
                    break;
                }
                case giftBattle1: {
                    currentPlayer.battle += 2;
                    break;
                }
                case giftInt1: {
                    il += 6;
                    break;
                }
                case giftHor1: {
                    hl += 6;
                    break;
                }
                case giftFin1: {
                    fl += 6;
                    break;
                }
                case giftWea1: {
                    wl += 6;
                    break;
                }
                case giftAttr2: {
                    wl += 4;
                    il += 4;
                    hl += 4;
                    fl += 4;
                    break;
                }
                case giftLuck2: {
                    currentPlayer.luck += 5;
                    break;
                }
                case giftBattle2: {
                    currentPlayer.battle += 5;
                    break;
                }
                case giftWeaex: {
                    wl += 10;
                    currentPlayer.battle += 5;
                    iu -= 8;
                    break;
                }
                case giftMoney: {
                    wu -= 7;
                    currentPlayer.money += 25000;
                    break;
                }
                case giftAttr3: {
                    wl += 6;
                    il += 6;
                    hl += 6;
                    fl += 6;
                    break;
                }
                case giftExceed: {
                    wu += 7;
                    iu += 7;
                    hu += 7;
                    fu += 7;
                    break;
                }
                case giftLuck3: {
                    currentPlayer.luck += 12;
                    break;
                }
                default:
                    break;
            }
            switch (giftstr2) {
                case giftAttr1: {
                    wl += 2;
                    il += 2;
                    hl += 2;
                    fl += 2;
                    break;
                }
                case giftLuck1: {
                    currentPlayer.luck += 2;
                    break;
                }
                case giftBattle1: {
                    currentPlayer.battle += 2;
                    break;
                }
                case giftInt1: {
                    il += 6;
                    break;
                }
                case giftHor1: {
                    hl += 6;
                    break;
                }
                case giftFin1: {
                    fl += 6;
                    break;
                }
                case giftWea1: {
                    wl += 6;
                    break;
                }
                case giftAttr2: {
                    wl += 4;
                    il += 4;
                    hl += 4;
                    fl += 4;
                    break;
                }
                case giftLuck2: {
                    currentPlayer.luck += 5;
                    break;
                }
                case giftBattle2: {
                    currentPlayer.battle += 5;
                    break;
                }
                case giftWeaex: {
                    wl += 10;
                    currentPlayer.battle += 5;
                    iu -= 8;
                    break;
                }
                case giftMoney: {
                    wu -= 7;
                    currentPlayer.money += 25000;
                    break;
                }
                case giftAttr3: {
                    wl += 6;
                    il += 6;
                    hl += 6;
                    fl += 6;
                    break;
                }
                case giftExceed: {
                    wu += 7;
                    iu += 7;
                    hu += 7;
                    fu += 7;
                    break;
                }
                case giftLuck3: {
                    currentPlayer.luck += 12;
                    break;
                }
                default:
                    break;
            }

            currentPlayer.wealth = getRandomInteger(wl, wu);
            currentPlayer.intelligence = getRandomInteger(il, iu);
            currentPlayer.horizon = getRandomInteger(hl, hu);
            currentPlayer.finance = getRandomInteger(fl, fu);
            //初始金錢為100乘家境平方，再加1000。即，初始金錢在1000-11000範圍變動。
            currentPlayer.money += 100 * currentPlayer.wealth * currentPlayer.wealth + 2000;
            //家境對財商的加成。取整數。
            currentPlayer.finance += Math.floor(currentPlayer.wealth / 2);
            //注意，啟用超越極限特典的情況下，家境、智力值可能突破10。高考填志願、結算等頁面應做相應處理。
            return;
        }

        //阻止用戶選擇超過三項
        function checkCollegeSelections(checkbox, selectedCheckboxes) {
            if (checkbox.checked) {
                // 如果選中，添加到選中列表
                if (selectedCheckboxes.length >= 3) {
                    // 如果選擇的數量已達到限制，取消選中
                    checkbox.checked = false;
                    alert("最多揀三項！");
                    return;
                }
                selectedCheckboxes.push(checkbox);
            } else {
                // 如果取消選中，從選中列表中移除
                let index = selectedCheckboxes.indexOf(checkbox);
                if (index !== -1) {
                    selectedCheckboxes.splice(index, 1);
                }
            }
        }

        //給填志願頁各大學選項加描述
        function appendUnivtext(li, name, text) {
            let div1 = document.createElement("div");
            let div2 = document.createElement("div");
            div1.className = "apply-univname";
            div2.className = "apply-univtext"
            div1.textContent = name;
            div2.textContent = text;
            li.appendChild(div1);
            li.appendChild(div2);
            return;
        }


        //從給定的規劃組中隨機選出count個規劃
        function selectRandomPlans(plansArray, count) {
            let selectedPlans = [];
            let usedIndices = new Set();

            while (selectedPlans.length < count) {
                let index = Math.floor(Math.random() * plansArray.length);
                // 確保不會重複選擇相同的計劃
                if (!usedIndices.has(index)) {
                    usedIndices.add(index);
                    selectedPlans.push(plansArray[index]);
                }
            }
            return selectedPlans;
        }
        //期末考試相關計算

        //該函數返回一個數組。數組每個元素都是0-100的整數，代表考試成績。數組長度代表一共考多少門課。
        function calFinalExam(inte, base, univ, eNum, luck) {
            //分數取值範圍在0-100，相關屬性提高隨機下限。
            let lLimit = base + luck + inte * 6 + 10 * univ.tier;

            let final = [];
            //對每門課分別做判定
            for (let i = 0; i < eNum; i++) {
                //如果下限超過100，則判定為滿分。
                let result = 0;
                if (lLimit >= 100) {
                    result = 100;
                } else {
                    result = getRandomInteger(lLimit, 100);
                }
                //根據學校的競爭激烈度，對最終分數做調整
                result -= 2 * univ.pressure;
                //負數的情況下，調整為0分。
                if (result < 0) {
                    result = 0;
                }
                //如果掛科，根據幸運值給一次補救機會。
                if (result < 60) {
                    let z = getRandomInteger(0, 20);
                    if (z <= luck) {
                        result = 60;
                    }
                }
                final.push(result);
            }
            return final;
        }
        //計算績點。注意，該函數返回一個0-400的整數。顯示給用戶時，應先乘0.01
        function calExamGPA(exam) {
            //複製數組
            let gpa = [];
            let sum = 0;
            for (let i = 0; i < exam.length; i++) {
                gpa.push(exam[i]);
            }

            //百分製成績換算成績點。保留兩位小數，即取0-400的整數。
            for (let i = 0; i < gpa.length; i++) {
                if (gpa[i] >= 90) {
                    gpa[i] = 400;
                } else if (gpa[i] >= 85) {
                    gpa[i] = 370;
                } else if (gpa[i] >= 82) {
                    gpa[i] = 330;
                } else if (gpa[i] >= 78) {
                    gpa[i] = 300;
                } else if (gpa[i] >= 75) {
                    gpa[i] = 270;
                } else if (gpa[i] >= 71) {
                    gpa[i] = 230;
                } else if (gpa[i] >= 66) {
                    gpa[i] = 200;
                } else if (gpa[i] >= 62) {
                    gpa[i] = 170;
                } else if (gpa[i] >= 60) {
                    gpa[i] = 130;
                } else {
                    gpa[i] = 0;
                }

                sum += gpa[i];
            }

            let result = Math.floor(sum / gpa.length);
            return result;
        }
        function score2GPA(score) {
            //把百分製成績數組換算成GPA數組
            let gpa = [];
            for (let i = 0; i < score.length; i++) {
                gpa.push(score[i]);
            }
            for (let i = 0; i < gpa.length; i++) {
                if (gpa[i] >= 90) {
                    gpa[i] = 400;
                } else if (gpa[i] >= 85) {
                    gpa[i] = 370;
                } else if (gpa[i] >= 82) {
                    gpa[i] = 330;
                } else if (gpa[i] >= 78) {
                    gpa[i] = 300;
                } else if (gpa[i] >= 75) {
                    gpa[i] = 270;
                } else if (gpa[i] >= 71) {
                    gpa[i] = 230;
                } else if (gpa[i] >= 66) {
                    gpa[i] = 200;
                } else if (gpa[i] >= 62) {
                    gpa[i] = 170;
                } else if (gpa[i] >= 60) {
                    gpa[i] = 130;
                } else {
                    gpa[i] = 0;
                }
            }
            return gpa;
        }
        function gpaArray2GPA(array) {
            //計算平均績點
            let sum = 0;
            for (let i = 0; i < array.length; i++) {
                sum += array[i];
            }
            let result = Math.floor(sum / array.length);
            return result;
        }

        //計算四級得分
        function calCetScore(player) {
            let base = (player.intelligence + player.luck) * 20 + cetBase + 235 - (player.univRank * 10);
            //數值參考： 智商10、大學排名第一，隨機下限正好是425
            if (base >= 710) {
                return 710;
            }
            if (base < 0) {
                base = 0;
            }
            let score = getRandomInteger(base, 710);
            return score;
        }

        //計算實習
        //3： 好實習 2：一般的實習  1：差實習 0：沒找到
        function calShixi(player) {
            let base = player.horizon + player.finance + player.battle + shixiBase + player.luck - player.univRank;

            switch (player.majorCode) {
                case ART_MAJOR:
                    base -= 10;
                    break;
                case SOCIAL_MAJOR:
                case ENGINEER_MAJOR:
                    base += 5;
                    break;
                case MEDICAL_MAJOR:
                    base -= 5;   //增加遊戲難度
                    //base += 10;           
                    break;
                default:
                    break;
            }

            if (base > 100) {
                return 3;
            }
            let x1 = getRandomInteger(base, 100);
            let x2 = getRandomInteger(base, 100);
            let x3 = getRandomInteger(base, 100);

            if (x1 > 90 || x2 > 90 || x3 > 90) {
                return 3;
            }
            if (x1 > 80 || x2 > 80 || x3 > 80) {
                return 2;
            }
            if (x1 > 60 || x2 > 60 || x3 > 60) {
                return 1;
            }
            return 0;
        }

        //計算保研
        //3：保上頂尖名校  2：保一般的學校  1：保差的學校  0：沒有
        function calBaoYan(player) {
            if (!flagShixi) {
                return 0;
            }
            let base = player.horizon + player.battle + player.finance + (player.luck + player.intelligence) * 2 - player.univRank * 3;

            switch (player.majorCode) {
                case ART_MAJOR:
                    base -= 20;
                    break;
                case MEDICAL_MAJOR:
                    //base += 5;
                    base -= 10;   //增加遊戲難度
                    break;
                case SCIENCE_MAJOR:
                    base += 10;
                    break;
                default:
                    base -= 5;
                    break;
            }

            if (base > 100) {
                return 3;
            }

            let x1 = getRandomInteger(base, 100);
            let x2 = getRandomInteger(base, 100);
            let x3 = getRandomInteger(base, 100);

            if (x1 > 90 || x2 > 90 || x3 > 90) {
                return 3;
            }
            if (x1 > 80 || x2 > 80 || x3 > 80) {
                return 2;
            }
            if (x1 > 60 || x2 > 60 || x3 > 60) {
                return 1;
            }
            return 0;
        }

        //計算考研
        //3表示考上好學校，2表示考上一般學校，1表示達到國家線，0表示沒達到國家線。
        function calKaoYan(player) {
            let base = kaoyanBase + (player.intelligence + player.luck + player.battle - player.univRank) * 5;
            if (base >= 500) {
                return 3;
            }

            if (base >= 300 || player.univRank <= 4) {
                base -= 100;
                let z = getRandomInteger(base, 500);
                if (z > 400) {
                    return 3;
                }
                return 1;
            }

            if (player.univRank === 11) {
                base += 50; //考研神校特殊加成
            }

            let y = getRandomInteger(base, 500);

            if (y > 350) {
                return 2;
            }
            return 0;
        }

        //考研調劑計算
        function tiaojiShangan(player) {
            let base = (player.horizon + player.finance) * 2 + player.battle + player.luck;
            let z = getRandomInteger(0, 100);
            if (base > z)
                return true;
            let y = getRandomInteger(0, 35);
            if (y <= player.luck) {
                return true;
            }
            return false;
        }

        //找工作計算
        //3表示好工作，2表示一般工作，1表示差工作，0表示沒找到。
        function seekJob(player, count) {
            //找工作主要和眼界有關
            let m = getRandomInteger(0, 50);
            if (m <= player.luck) {
                return 3;
            }

            let y = player.horizon * 3 + player.finance + player.intelligence + player.battle + player.luck + 100 - (player.univRank * 10);

            if (flagShixi) {
                y += 100;
            }
            if (flagCet) {
                y += 50;
            }
            if (flagRongYu) {
                y += 50;
            }

            switch (player.majorCode) {
                case ENGINEER_MAJOR:
                    y += 70;
                    break;
                case MEDICAL_MAJOR:
                    //y += 50;
                    y -= 30;   //增加遊戲難度
                    break;
                case SOCIAL_MAJOR:
                case SCIENCE_MAJOR:
                    y += 30;
                    break;
                default:
                    break;
            }

            if (player.univRank <= 4) {
                for (let i = 0; i < count; i++) {
                    let z = getRandomInteger(0, 4000);
                    if (y > z) {
                        return 3;
                    }
                }
                return 0;
            }
            if (player.univRank === 20) {
                return 1;
            }

            for (let i = 0; i < count; i++) {
                let j = getRandomInteger(0, 100);
                if (j > 60) {
                    let z = getRandomInteger(0, 4000);
                    if (y > z) {
                        return 3;
                    }
                } else if (j > 30) {
                    let z = getRandomInteger(0, 2500);
                    if (y > z) {
                        return 2;
                    }
                } else {
                    let z = getRandomInteger(0, 1000);
                    if (y > z) {
                        return 1;
                    }
                }
            }
            return 0;

        }

        //畢業論文計算
        function calLunwen(player) {
            let base = lunwenBase + player.intelligence + player.battle - player.univRank;
            switch (player.majorCode) {
                case ART_MAJOR:
                    base += ART_DIFF;
                    break;
                case SOCIAL_MAJOR:
                    base += SOCIAL_DIFF;
                    break;
                case ENGINEER_MAJOR:
                    base += ENGINEER_DIFF;
                    break;
                case SCIENCE_MAJOR:
                    base += SCIENCE_DIFF;
                    break;
                case MEDICAL_MAJOR:
                    base += MEDICAL_DIFF;
                    break;
            }
            if (base >= 100) {
                return 100;
            }
            let z = getRandomInteger(base, 100);

            if (z < 60) {
                let x = getRandomInteger(0, 30);
                if (x <= player.luck) {
                    return 60;
                }
            }
            return z;
        }






        //遊戲結算頁相關
        function wealth2RatingSpan(wealth) {
            //輸入表示家境的0-10的數，返回一個帶有樣式的
            let spanname = document.createElement("span");
            spanname.textContent = "家境：";
            let spanrating = document.createElement("span");

            if (wealth === 10) {
                spanrating.textContent = wealth.toString() + "    中產";
                spanrating.className = "attr-rating-A";
            } else if (wealth >= 7) {
                spanrating.textContent = wealth.toString() + "    小康";
                spanrating.className = "attr-rating-B";
            } else if (wealth >= 4) {
                spanrating.textContent = wealth.toString() + "    溫飽";
                spanrating.className = "attr-rating-C";
            } else {
                spanrating.textContent = wealth.toString() + "    貧困";
                spanrating.className = "attr-rating-D";
            }
            if (wealth > 10) {
                spanrating.textContent = wealth.toString() + "    富裕";
                spanrating.className = "attr-rating-S";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function univ2RatingSpan(univrank) {
            let univ = univList.find(un => un.rank === univrank);
            let spanname = document.createElement("span");
            spanname.textContent = "就讀院校：";
            let spanrating = document.createElement("span");

            if (univrank === 1) {
                spanrating.textContent = univ.name + "    頂尖";
                spanrating.className = "attr-rating-S";
            } else if (univrank <= 4) {
                spanrating.textContent = univ.name + "    一流";
                spanrating.className = "attr-rating-A";
            } else if (univrank <= 8) {
                spanrating.textContent = univ.name + "    省重點";
                spanrating.className = "attr-rating-B";
            } else if (univrank <= 11) {
                spanrating.textContent = univ.name + "    普通";
                spanrating.className = "attr-rating-C";
            } else if (univrank === 12) {
                spanrating.textContent = univ.name + "    唔太好";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = univ.name + "    辣雞";
                spanrating.className = "attr-rating-E";
            }
            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function inte2RatingSpan(intelligence, endflag) {
            let spanname = document.createElement("span");
            spanname.textContent = "智力：";
            let spanrating = document.createElement("span");

            if (intelligence > 30) {
                spanrating.textContent = intelligence.toString() + "    超凡";
                spanrating.className = "attr-rating-S";
            } else if (intelligence > 25) {
                spanrating.textContent = intelligence.toString() + "    天才";
                spanrating.className = "attr-rating-A";
            } else if (intelligence > 20) {
                spanrating.textContent = intelligence.toString() + "    聰明";
                spanrating.className = "attr-rating-B";
            } else if (intelligence > 15) {
                spanrating.textContent = intelligence.toString() + "    普通";
                spanrating.className = "attr-rating-C";
            } else if (intelligence > 10) {
                spanrating.textContent = intelligence.toString() + "    愚笨";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = intelligence.toString() + "    製杖";
                spanrating.className = "attr-rating-E";
            }

            if (endflag === NOBEL_END) {
                spanrating.textContent = "***" + "    唔好講";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function hor2RatingSpan(horizon) {
            let spanname = document.createElement("span");
            spanname.textContent = "眼界：";
            let spanrating = document.createElement("span");

            if (horizon >= 40) {
                spanrating.textContent = horizon.toString() + "    彌綸天地";
                spanrating.className = "attr-rating-S";
            } else if (horizon >= 30) {
                spanrating.textContent = horizon.toString() + "    高瞻遠矚";
                spanrating.className = "attr-rating-A";
            } else if (horizon >= 25) {
                spanrating.textContent = horizon.toString() + "    見多識廣";
                spanrating.className = "attr-rating-B";
            } else if (horizon >= 20) {
                spanrating.textContent = horizon.toString() + "    普通";
                spanrating.className = "attr-rating-C";
            } else if (horizon >= 10) {
                spanrating.textContent = horizon.toString() + "    目光短淺";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = horizon.toString() + "    井底之蛙";
                spanrating.className = "attr-rating-E";
            }
            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function fin2RatingSpan(finance) {
            let spanname = document.createElement("span");
            spanname.textContent = "財商：";
            let spanrating = document.createElement("span");

            if (finance >= 35) {
                spanrating.textContent = finance.toString() + "    世界級投資家";
                spanrating.className = "attr-rating-S";
            } else if (finance >= 30) {
                spanrating.textContent = finance.toString() + "    專業投資者";
                spanrating.className = "attr-rating-A";
            } else if (finance >= 25) {
                spanrating.textContent = finance.toString() + "    投機客";
                spanrating.className = "attr-rating-B";
            } else if (finance >= 20) {
                spanrating.textContent = finance.toString() + "    公募基金經理";
                spanrating.className = "attr-rating-C";
            } else if (finance >= 10) {
                spanrating.textContent = finance.toString() + "    韭菜";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = finance.toString() + "    唔識數錢";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function battle2RatingSpan(battle) {
            let spanname = document.createElement("span");
            spanname.textContent = "戰鬥力：";
            let spanrating = document.createElement("span");

            if (battle >= 25) {
                spanrating.textContent = battle.toString() + "    戰神";
                spanrating.className = "attr-rating-S";
            } else if (battle >= 20) {
                spanrating.textContent = battle.toString() + "    王者";
                spanrating.className = "attr-rating-A";
            } else if (battle >= 15) {
                spanrating.textContent = battle.toString() + "    校霸";
                spanrating.className = "attr-rating-B";
            } else if (battle >= 10) {
                spanrating.textContent = battle.toString() + "    寢室扛把子";
                spanrating.className = "attr-rating-C";
            } else if (battle > 5) {
                spanrating.textContent = battle.toString() + "    打過架";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = battle.toString() + "    得5嘅渣渣";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function end2RatingSpan(endflag) {
            let spanname = document.createElement("span");
            spanname.textContent = "結局：";
            let spanrating = document.createElement("span");

            if (endflag === MOOD_END || endflag === STRENGTH_END || endflag === SPIRIT_END || endflag === RISK_END || endflag === GUAKE_END) {
                spanrating.textContent = "中道崩殂" + "    E";
                spanrating.className = "attr-rating-E";
            }
            if (endflag === ART_END || endflag === SOC_END || endflag === ENG_END || endflag === SCI_END || endflag === MED_END) {
                spanrating.textContent = "倒喺畢業前夕" + "    E";
                spanrating.className = "attr-rating-E";
            }
            if (endflag === BAOYAN_END) {
                if (flagBaoyan3) {
                    spanrating.textContent = "名校保研" + "    A";
                    spanrating.className = "attr-rating-A";
                } else if (flagBaoyan2) {
                    spanrating.textContent = "保研" + "    B";
                    spanrating.className = "attr-rating-B";
                } else {
                    spanrating.textContent = "辣雞學校保研" + "    C";
                    spanrating.className = "attr-rating-D";
                }
            }
            if (endflag === KAOYAN_END) {
                if (flagKaoYan3) {
                    spanrating.textContent = "名校研究生" + "    A";
                    spanrating.className = "attr-rating-A";
                } else if (flagKaoYan2) {
                    spanrating.textContent = "讀研" + "    B";
                    spanrating.className = "attr-rating-B";
                } else {
                    spanrating.textContent = "辣雞學校讀研" + "    C";
                    spanrating.className = "attr-rating-D";
                }
            }
            if (endflag === PERFECT_END) {
                spanrating.textContent = "天選之子" + "    S";
                spanrating.className = "attr-rating-S";
            }
            if (endflag === GONGZUO3_END) {
                spanrating.textContent = "職場精英" + "    A";
                spanrating.className = "attr-rating-A";
            }
            if (endflag === GONGZUO2_END) {
                spanrating.textContent = "平凡嘅上班族" + "    B";
                spanrating.className = "attr-rating-B";
            }
            if (endflag === BIYE_SHIYE_END) {
                spanrating.textContent = "畢業即失業" + "    C";
                spanrating.className = "attr-rating-C";
            }
            if (endflag === DANBIYE_END) {
                spanrating.textContent = "單證戰士" + "    D";
                spanrating.className = "attr-rating-D";
            }
            if (endflag === GONGZUO1_END) {
                spanrating.textContent = "黑作坊牛馬" + "    D";
                spanrating.className = "attr-rating-D";
            }
            if (endflag === JIEYE_END) {
                spanrating.textContent = "大學結業" + "    D";
                spanrating.className = "attr-rating-D";
            }
            if (endflag === XSH_END) {
                spanrating.textContent = "學生會長" + "    S";
                spanrating.className = "attr-rating-S";
            }
            if (endflag === GGZ_END) {
                spanrating.textContent = "沉迷頁游" + "    S";
                spanrating.className = "attr-rating-S";
            }
            if (endflag === NOBEL_END) {
                spanrating.textContent = "諾獎得主" + "    S";
                spanrating.className = "attr-rating-S";
            }


            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function end2rank(endflag) {
            let rank = 0;
            switch (endflag) {
                case NOBEL_END:
                case GGZ_END:
                case XSH_END:
                case PERFECT_END:
                    rank = S_END_RANK;
                    break;
                case GONGZUO3_END:
                case BAOYAN3_END:
                case KAOYAN3_END:
                    rank = A_END_RANK;
                    break;
                case BAOYAN2_END:
                case KAOYAN2_END:
                case GONGZUO2_END:
                    rank = B_END_RANK;
                    break;
                case BAOYAN1_END:
                case BIYE_SHIYE_END:
                case KAOYAN1_END:
                    rank = C_END_RANK;
                    break;
                case GONGZUO1_END:
                case DANBIYE_END:
                case JIEYE_END:
                    rank = D_END_RANK;
                    break;
                default:
                    rank = E_END_RANK;
            }
            return rank;
        }
        function endrank2string(rank) {
            switch (rank) {
                case S_END_RANK:
                    return "S";
                case A_END_RANK:
                    return "A";
                case B_END_RANK:
                    return "B";
                case C_END_RANK:
                    return "C";
                case D_END_RANK:
                    return "D";
                case E_END_RANK:
                    return "E";
                default:
                    return "--";
            }
        }
        function endRecordDiv(rank) {
            let div = document.createElement("div");
            let div1 = document.createElement("div");
            let div2 = document.createElement("div");

            let span1 = document.createElement("span");
            let span2 = document.createElement("span");
            let span3 = document.createElement("span");
            let span4 = document.createElement("span");

            div1.appendChild(span1);
            div1.appendChild(span2);
            div2.appendChild(span3);
            div2.appendChild(span4);
            div.appendChild(div1);
            div.appendChild(div2);

            span1.textContent = "歷史最佳：";
            span2.textContent = "  " + endrank2string(bestRecord);
            span3.textContent = "本局評價：";
            span4.textContent = "  " + endrank2string(rank);
            if (rank > bestRecord) {
                span4.textContent += "（新紀錄）";
            }
            switch (bestRecord) {
                case S_END_RANK:
                    span2.className = "end-rating-S";
                    break;
                case A_END_RANK:
                    span2.className = "end-rating-A";
                    break;
                case B_END_RANK:
                    span2.className = "end-rating-B";
                    break;
                case C_END_RANK:
                    span2.className = "end-rating-C";
                    break;
                case D_END_RANK:
                    span2.className = "end-rating-D";
                    break;
                case E_END_RANK:
                default:
                    span2.className = "end-rating-E";
                    break;
            }
            switch (rank) {
                case S_END_RANK:
                    span4.className = "end-rating-S";
                    break;
                case A_END_RANK:
                    span4.className = "end-rating-A";
                    break;
                case B_END_RANK:
                    span4.className = "end-rating-B";
                    break;
                case C_END_RANK:
                    span4.className = "end-rating-C";
                    break;
                case D_END_RANK:
                    span4.className = "end-rating-D";
                    break;
                case E_END_RANK:
                default:
                    span4.className = "end-rating-E";
                    break;
            }
            return div;

        }
        function appendGifttext(li, text, description, rank) {
            let span1 = document.createElement("span");
            let span2 = document.createElement("span");
            span1.textContent = text;
            span2.textContent = description;
            if (rank === GIFT_S_RANK) {
                span1.className = "gift-rating-S";
            }
            if (rank === GIFT_A_RANK) {
                span1.className = "gift-rating-A";
            }
            if (rank === GIFT_B_RANK) {
                span1.className = "gift-rating-B";
            }
            if (rank === GIFT_C_RANK) {
                span1.className = "gift-rating-C";
            }
            if (rank === GIFT_D_RANK) {
                span1.className = "gift-rating-D";
            }
            if (rank === GIFT_E_RANK) {
                span1.className = "gift-rating-E";
            }
            li.appendChild(span1);
            li.appendChild(span2);
            //或許一般不會用id傳參，大概有更合適的寫法
            li.id = text;
            return;
        }

        //該函數接受一個字符串表示的特典，返回作為classname的字符串
        function gift2SpanClassname(giftstr) {
            switch (giftstr) {
                case giftInt1:
                case giftHor1:
                case giftFin1:
                case giftWea1:
                    return "gift-rating-D";
                case giftAttr2:
                case giftLuck2:
                case giftBattle2:
                    return "gift-rating-C";
                case giftWeaex:
                case giftMoney:
                case giftExam:
                    return "gift-rating-B";
                case giftAttr3:
                    return "gift-rating-A";
                case giftExceed:
                case giftLuck3:
                    return "gift-rating-S";
                default:
                    return "gift-rating-E";
            }
        } 
    </script>
    <script>

        //儲存玩家本輪遊戲數據
        class Player {
            constructor(name, gender, wealth, mood, strength, spirit, intelligence, horizon, finance, luck, risk, money, year, univRank, major, round, examBase, battle, semester, cgpa, tgpa) {
                this.name = name;			//姓名，由玩家自選
                this.gender = gender;			//性別，由玩家自選
                this.wealth = wealth;			//財富，與初始金錢、生活費掛鈎
                this.mood = mood;			//心情，心情好才想做事
                this.strength = strength;		//體力
                this.spirit = spirit;			//精力
                this.intelligence = intelligence;	//智商
                this.horizon = horizon;			//眼界
                this.finance = finance;			//財商，與賺錢相關
                this.luck = luck;			//幸運，可以增加事件判定成功的機率
                this.risk = risk;			//初始為0，為正值時增加暴斃概率
                this.money = money;			//玩家的錢
                this.year = year;			//記錄玩家現在上大學第幾年  
                this.univRank = univRank;		//記錄玩家上甚麼大學
                this.major = major;			//專業
                this.round = round;			//學期規劃輪次
                this.examBase = examBase;		//期末考試成績隨機下限
                this.battle = battle;			//戰鬥力
                this.semester = semester;		//學期
                this.cgpa = cgpa;			//上學期績點，請注意，績點統一用0-400的數表示
                this.tgpa = tgpa;			//總績點
            }
        }


        //各顯示欄

        //標題。隨遊戲推進，切換學年、學期顯示
        const titleBanner = {
            title: document.createElement("h1"),
            div: document.createElement("div"),

            createDiv: function () {
                this.title.textContent = "大一年上學期";
                this.div.className = "mTitle";
                this.div.appendChild(this.title);
                return this.div;
            },

            updateDiv: function (player) {
                switch (player.year) {
                    case 1: {
                        titleBanner.title.textContent = "大一年";
                        break;
                    }
                    case 2: {
                        titleBanner.title.textContent = "大二年";
                        break;
                    }
                    case 3: {
                        titleBanner.title.textContent = "大三年";
                        break;
                    }
                    case 4: {
                        titleBanner.title.textContent = "大四年";
                        break;
                    }
                };
                if (player.semester % 2 === 1) {
                    titleBanner.title.textContent += "上學期";
                } else {
                    titleBanner.title.textContent += "下學期";
                }
            }
        }

        //重要事件記錄欄
        const eventRecord = {
            title: document.createElement("h3"),
            list: document.createElement("div"),

            createDiv: function () {
                this.title.textContent = "重要事件記錄";
                this.list.innerHTML = ""; //初始化時置零
                let div = document.createElement("div");
                div.appendChild(this.title);
                div.appendChild(this.list);
                div.className = "sidebar";
                return div;
            },

            updateDiv: function (msg) {
                let para = document.createElement("p");
                para.textContent = msg + "！";
                this.list.appendChild(para);
            }
        }



        //特殊事件欄
        const specialEventList = {
            title: document.createElement("h3"),
            div1: document.createElement("div"),
            div2: document.createElement("div"),
            div: document.createElement("div"),
            okbutton: document.createElement("button"),
            cplayer: null,

            createDiv: function (player) {
                //初始化
                this.title.className = "sevent-title";
                this.title.textContent = "發生特殊事件！"
                this.div1.className = "sevent-para1";
                this.div2.className = "sevent-para2";
                this.div.className = "sevent-container";
                this.okbutton.className = "sevent-button";
                this.okbutton.textContent = "收到";
                this.cplayer = player;

                this.div.appendChild(this.title);
                this.div.appendChild(this.div1);
                this.div.appendChild(this.div2);
                this.div.appendChild(this.okbutton);

                this.okbutton.onclick = () => {
                    specialEventList.div.style.display = "none";

                    if (eventPhase === 4) {
                        if (flagXueShengHui) {
                            setGameover(player, XSH_END);
                        }
                        if (flagGuGuZhen) {
                            setGameover(player, GGZ_END);
                        }
                        if (flagNobel) {
                            setGameover(player, NOBEL_END);
                        }
                        return;
                    }

                    if (flagBaoyanEnd) {
                        setGameover(specialEventList.cplayer, BAOYAN_END);
                        return;
                    }

                    testEnd(specialEventList.cplayer);
                    if (isEnd)
                        return;

                    schoolTodoList.showPlan(specialEventList.cplayer);
                }

                this.div.style.display = "none";
                return this.div;
            },

            showDiv: function (player) {
                //展示
                let ev = specialEventList.getEvent(player);
                specialEventList.div1.textContent = ev.text;
                specialEventList.div2.textContent = ev.description;
                ev.updateAttr(player);
                specialDone = true;


                //一些特殊事件在這做額外處理，updateAttr函數不涉及

                if (ev.code === CODE_PIN_KUN) {
                    flagPinKunBuZhu = true;
                    eventRecord.updateDiv(seventPinKunRenDing.text);
                }
                if (ev.code === CODE_XUE_SHENG_HUI) {
                    flagXueShengHui = true;
                    eventPhase = 1;
                    eventRecord.updateDiv(seventXueShengHui.text);
                }
                if (ev.code === CODE_GU_GU) {
                    flagGuGuZhen = true;
                    eventPhase = 1;
                    eventRecord.updateDiv(seventGuGuZhen.text);
                }
                if (ev.code === CODE_NOBEL) {
                    flagNobel = true;
                    eventPhase = 1;
                    eventRecord.updateDiv(seventNobel.text);
                }
                if (ev.code === CODE_GUOJIANG || ev.code === CODE_LIZHI) {
                    flagRongYu = true;
                    eventRecord.updateDiv(seventGuoJiang.text);
                }

                if (ev.code === CODE_XSH1 || ev.code === CODE_GGZ1 || ev.code === CODE_NOBEL1) {
                    eventPhase = 2;
                }

                if (ev.code === CODE_XSH2 || ev.code === CODE_GGZ2 || ev.code === CODE_NOBEL2) {
                    eventPhase = 3;
                }

                if (ev.code === CODE_XSH3 || ev.code === CODE_GGZ3 || ev.code === CODE_NOBEL3) {
                    eventPhase = 4;
                }

                if (ev.code === CODE_XSH1) {
                    eventRecord.updateDiv(rXsh1.text);
                }
                if (ev.code === CODE_XSH2) {
                    eventRecord.updateDiv(rXsh2.text);
                }
                if (ev.code === CODE_XSH3) {
                    eventRecord.updateDiv(rXsh3.text);
                }

                if (ev.code === CODE_GGZ1) {
                    eventRecord.updateDiv(rGGZ1.text);
                }
                if (ev.code === CODE_GGZ2) {
                    eventRecord.updateDiv(rGGZ2.text);
                }
                if (ev.code === CODE_GGZ3) {
                    eventRecord.updateDiv(rGGZ3.text);
                }

                if (ev.code === CODE_NOBEL1) {
                    eventRecord.updateDiv(rNobel1.text);
                }
                if (ev.code === CODE_NOBEL2) {
                    eventRecord.updateDiv(rNobel2.text);
                }
                if (ev.code === CODE_NOBEL3) {
                    eventRecord.updateDiv(rNobel3.text);
                }
                if (ev.code === BAOYAN_GOOD) {
                    eventRecord.updateDiv("推免成功");
                    flagBaoyanEnd = true;
                }
                if (ev.code === BAOYAN_BAD) {
                    eventRecord.updateDiv("推免失敗");
                }
                if (ev.code === TIAOJI_GOOD) {
                    eventRecord.updateDiv("調劑成功");
                    flagKaoshangYan = true;
                }
                if (ev.code === TIAOJI_BAD) {
                    eventRecord.updateDiv("調劑失敗");
                    flagKaoshangYan = false;
                }
                if (ev.code === CODE_GONGZUO) {
                    eventRecord.updateDiv("搵到工作喇");
                }

                specialEventList.div.style.display = "flex";

            },

            getEvent: function (player) {
                //隨機獲取當前事件

                //找工作事件
                if (player.semester === 8 && player.round > 2) {
                    if (flagGongzuo3) {
                        return seventGongzuo3;
                    }
                    if (flagGongzuo2) {
                        return seventGongzuo2;
                    }
                    if (flagGongzuo1) {
                        return seventGongzuo1;
                    }
                    return seventGongzuo0;
                }

                //判定特殊路線後續劇情
                if (player.semester % 2 === 1) {
                    switch (eventPhase) {
                        case 1: {
                            if (player.year === 4) {
                                break;
                            }
                            if (flagXueShengHui && player.battle >= P1_BATTLE_LIMIT) {
                                return rXsh1;
                            }
                            if (flagNobel && player.intelligence <= P1_IQ_LIMIT && player.battle >= P1_BATTLE_LIMIT) {
                                return rNobel1;
                            }
                            if (flagGuGuZhen && player.money >= 2000 && player.battle >= P1_BATTLE_LIMIT) {
                                return rGGZ1;
                            }
                            break;
                        }
                        case 2: {
                            if (player.year === 4) {
                                break;
                            }
                            if (flagXueShengHui && player.battle >= P2_BATTLE_LIMIT) {
                                return rXsh2;
                            }
                            if (flagNobel && player.battle >= P2_BATTLE_LIMIT && player.intelligence <= P2_IQ_LIMIT) {
                                return rNobel2;
                            }
                            if (flagGuGuZhen && player.battle >= P2_BATTLE_LIMIT && player.money >= 5000) {
                                return rGGZ2;
                            }
                            break;
                        }
                        case 3: {
                            if (flagXueShengHui && player.battle >= P3_BATTLE_LIMIT) {
                                return rXsh3;
                            }
                            if (flagNobel && player.battle >= P3_BATTLE_LIMIT && player.intelligence <= P3_IQ_LIMIT) {
                                return rNobel3;
                            }
                            if (flagGuGuZhen && player.battle >= P3_BATTLE_LIMIT && player.money >= 20000) {
                                return rGGZ3;
                            }
                            break;
                        }
                    };
                }

                //再判定大四上學期特殊事件
                if (player.semester === 7) {
                    //保研事件
                    if (flagBaoyan2 || flagBaoyan1) {
                        if (numFailedExam > 0) {
                            return seventBaoyanBad;
                        }
                        return seventBaoyanGood;
                    } else if (flagBaoyan3) {
                        if (player.univRank >= 9 || !flagRongYu || numFailedExam > 0) {
                            return seventBaoyanBad;
                        }
                        return seventBaoyanGood;
                    }
                }

                //判定大四下學期特殊事件
                if (player.semester === 8) {
                    //考研調劑事件
                    if (flagKaoYan1) {
                        if (tiaojiShangan(player)) {
                            return seventTiaojiGood;
                        } else {
                            return seventTiaojiBad;
                        }

                    }
                }


                //大一上學期，先判定獎學金相關事件
                if (player.year === 1 && player.wealth <= 3 && player.semester % 2 === 1) {
                    //第一年、家境值不超過3，獲得貧困補助
                    return seventPinKunRenDing;
                } else if (flagPinKunBuZhu && player.year > 1 && player.semester % 2 === 1) {  //補助、獎學金事件，都僅在上半學期觸發
                    //貧困生資格的情況下，依次判定 國獎+貧困補助； 勵志+貧困補助； 貧困補助
                    //為簡化程序計算，用以往學期總績點代替上學年績點
                    if (player.tgpa > GUOJIANG_LIMIT) {
                        return seventPinKunGuoJiang;
                    } else if (player.tgpa > LIZHI_LIMIT) {
                        return seventLiZhi;
                    } else if (player.tgpa > XUEYE_LIMIT) {
                        return seventPinKunXueYe;
                    } else {
                        return seventPinKunBuZhu;
                    };
                } else if (player.year > 1 && player.semester % 2 === 1 && player.tgpa > GUOJIANG_LIMIT) {
                    return seventGuoJiang;
                } else if (player.year > 1 && player.semester % 2 === 1 && player.tgpa > XUEYE_LIMIT) {
                    return seventXueYe;
                }

                //沒有獲得獎學金的情況下，繼續各結局路線相關事件判定
                if (player.year === 1 && player.semester % 2 === 1) {
                    //第一年時隨機給出各路線前置事件，不發生其他隨機事件。
                    let z = getRandomInteger(0, 2);
                    return seQianZhi[z];
                }


                //如果沒進入重要路線，則判定發生哪些隨機事件。

                let a = getRandomInteger(0, 100);
                if (a > 50 + player.risk - player.luck) {
                    let b = getRandomInteger(0, 200);
                    if (b < player.risk) {
                        let c = getRandomInteger(0, 4); //隨機事件列表都是五個五個一組
                        return vbadSeventList[c];
                    } else {
                        let c = getRandomInteger(0, 4);
                        //大四下學期不發生績點相關事件
                        if (badSeventList[c] === seventKeGai && player.semester === 8) {
                            lunwenBase -= 10;
                            return seventKeGaiDasi;
                        }
                        return badSeventList[c];
                    }
                } else {
                    let b = getRandomInteger(0, 100);
                    if (b < player.luck) {
                        let c = getRandomInteger(0, 4);
                        //大四下學期不發生績點相關事件
                        if (player.semester === 8 && c === 0) {
                            let d = getRandomInteger(1, 4);
                            return vgoodSeventList[d];
                        }
                        return vgoodSeventList[c];
                    } else {
                        let c = getRandomInteger(0, 4);
                        //大四下學期不發生績點相關事件
                        if (goodSeventList[c] === seventShiJuan && player.semester === 8) {
                            lunwenBase += 20;
                            return seventShiJuanDasi;
                        }
                        return goodSeventList[c];
                    }
                }


            }

        }
        //學期規劃欄
        const schoolTodoList = {

            title: document.createElement("h3"),

            button1: document.createElement("button"),
            button2: document.createElement("button"),
            button3: document.createElement("button"),
            button4: document.createElement("button"),
            button5: document.createElement("button"),

            des1: document.createElement("p"),
            des2: document.createElement("p"),
            des3: document.createElement("p"),
            des4: document.createElement("p"),
            des5: document.createElement("p"),

            bfbox1: document.createElement("div"),
            bfbox2: document.createElement("div"),
            bfbox3: document.createElement("div"),
            bfbox4: document.createElement("div"),
            bfbox5: document.createElement("div"),

            div: document.createElement("div"),
            //以下兩個用來傳參
            cplans: zeroStrengthPlans,
            cplayer: null,


            createDiv: function () {
                //初始化
                this.cplans = zeroStrengthPlans;
                this.cplayer = null;

                //button沒有checked屬性，不好傳參，索性寫五個函數
                this.button1.addEventListener("click", schoolTodoList.updateAttrB1);
                this.button2.addEventListener("click", schoolTodoList.updateAttrB2);
                this.button3.addEventListener("click", schoolTodoList.updateAttrB3);
                this.button4.addEventListener("click", schoolTodoList.updateAttrB4);
                this.button5.addEventListener("click", schoolTodoList.updateAttrB5);

                this.button1.className = "splan-button";
                this.bfbox1.className = "splan-buttonbox";

                this.button2.className = "splan-button";
                this.bfbox2.className = "splan-buttonbox";

                this.button3.className = "splan-button";
                this.bfbox3.className = "splan-buttonbox";

                this.button4.className = "splan-button";
                this.bfbox4.className = "splan-buttonbox";

                this.button5.className = "splan-button";
                this.bfbox5.className = "splan-buttonbox";

                this.title.className = "splan-title";

                this.bfbox1.appendChild(this.button1);
                this.bfbox1.appendChild(this.des1);
                this.bfbox2.appendChild(this.button2);
                this.bfbox2.appendChild(this.des2);
                this.bfbox3.appendChild(this.button3);
                this.bfbox3.appendChild(this.des3);
                this.bfbox4.appendChild(this.button4);
                this.bfbox4.appendChild(this.des4);
                this.bfbox5.appendChild(this.button5);
                this.bfbox5.appendChild(this.des5);

                this.div.appendChild(this.title);
                this.div.appendChild(this.bfbox1);
                this.div.appendChild(this.bfbox2);
                this.div.appendChild(this.bfbox3);
                this.div.appendChild(this.bfbox4);
                this.div.appendChild(this.bfbox5);

                this.div.className = "splan-container";
                this.div.style.display = "none";

                return this.div;
            },

            showPlan: function (player) {

                schoolTodoList.cplayer = player;

                if (schoolTodoList.cplayer.round > 2 && schoolTodoList.cplayer.semester === 8 && !jobpageDone) {
                    if (flagQiuzhi) {
                        //跳轉特殊事件找工作界面
                        schoolTodoList.div.style.display = "none";
                        jobpageDone = true;
                        specialEventList.showDiv(player);
                        return;
                    }
                }


                //每學期可以做三次規劃。擬通過player的屬性控制
                if (schoolTodoList.cplayer.round > 2) {
                    schoolTodoList.cplayer.round = 0;
                    schoolTodoList.div.style.display = "none";
                    transPage.showDiv();
                    return;
                }

                //做完第一次規劃後，進入特殊事件環節
                if (schoolTodoList.cplayer.round === 1 && !specialDone) {
                    schoolTodoList.div.style.display = "none";
                    specialEventList.showDiv(player);
                    return;
                }

                testEnd(schoolTodoList.cplayer);
                if (isEnd)
                    return;

                schoolTodoList.button1.disabled = false;
                schoolTodoList.button2.disabled = false;
                schoolTodoList.button3.disabled = false;
                schoolTodoList.button4.disabled = false;
                schoolTodoList.button5.disabled = false;

                schoolTodoList.title.textContent = "接下來要做乜嘢？（本學期第" + (schoolTodoList.cplayer.round + 1).toString() + "/3次規劃）";

                schoolTodoList.div.style.display = "flex";

                schoolTodoList.cplans = schoolTodoList.getPlans();

                schoolTodoList.button1.textContent = schoolTodoList.cplans[0].text;
                schoolTodoList.des1.textContent = schoolTodoList.cplans[0].description;
                schoolTodoList.button2.textContent = schoolTodoList.cplans[1].text;
                schoolTodoList.des2.textContent = schoolTodoList.cplans[1].description;
                schoolTodoList.button3.textContent = schoolTodoList.cplans[2].text;
                schoolTodoList.des3.textContent = schoolTodoList.cplans[2].description;
                schoolTodoList.button4.textContent = schoolTodoList.cplans[3].text;
                schoolTodoList.des4.textContent = schoolTodoList.cplans[3].description;
                schoolTodoList.button5.textContent = schoolTodoList.cplans[4].text;
                schoolTodoList.des5.textContent = schoolTodoList.cplans[4].description;

                if (schoolTodoList.cplans === zeroStrengthPlans) {
                    schoolTodoList.button2.disabled = true;
                    schoolTodoList.button3.disabled = true;
                    schoolTodoList.button4.disabled = true;
                    schoolTodoList.button5.disabled = true;

                    schoolTodoList.des2.textContent = "冇體力喇，乜都做唔到。";
                    schoolTodoList.des3.textContent = "冇體力喇，乜都做唔到。";
                    schoolTodoList.des4.textContent = "冇體力喇，乜都做唔到。";
                    schoolTodoList.des5.textContent = "冇體力喇，乜都做唔到。";
                }

                if (schoolTodoList.cplans === zeroMoneyPlans) {
                    schoolTodoList.button2.disabled = true;
                    schoolTodoList.button3.disabled = true;
                    schoolTodoList.button4.disabled = true;
                    schoolTodoList.button5.disabled = true;

                    schoolTodoList.des2.textContent = "賺錢要緊";
                    schoolTodoList.des3.textContent = "賺錢要緊";
                    schoolTodoList.des4.textContent = "賺錢要緊";
                    schoolTodoList.des5.textContent = "賺錢要緊";
                }

                //對大四上、大四下規劃的特殊處理
                if (schoolTodoList.cplans === DaSiShangSplanList) {
                    if (schoolTodoList.cplayer.money < 5000) {
                        schoolTodoList.button4.disabled = true;
                        schoolTodoList.button5.disabled = true;
                        schoolTodoList.des4.textContent = "你錢夠唔夠？";
                        schoolTodoList.des5.textContent = "你錢夠唔夠？";
                    }
                    if (schoolTodoList.cplayer.money < 2000) {
                        schoolTodoList.button3.disabled = true;
                        schoolTodoList.des3.textContent = "你錢夠唔夠？";
                    }
                }

                if (schoolTodoList.cplans === DaSiXiaSplanList) {
                    if (schoolTodoList.cplayer.money < 20000) {
                        schoolTodoList.button5.disabled = true;
                        schoolTodoList.des5.textContent = "你錢夠唔夠？";
                    }
                    if (schoolTodoList.cplayer.money < 5000) {
                        schoolTodoList.button4.disabled = true;
                        schoolTodoList.des4.textContent = "你錢夠唔夠？";
                    }
                    if (schoolTodoList.cplayer.money < 2000) {
                        schoolTodoList.button3.disabled = true;
                        schoolTodoList.des3.textContent = "你錢夠唔夠？";
                    }
                }

            },

            updateAttrB1: function () {
                (schoolTodoList.cplans[0]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB2: function () {
                (schoolTodoList.cplans[1]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB3: function () {
                (schoolTodoList.cplans[2]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB4: function () {
                (schoolTodoList.cplans[3]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB5: function () {
                (schoolTodoList.cplans[4]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            getPlans: function () {

                let chosenPlans = [];

                if (this.cplayer.horizon > HORIZON_EX_LIMIT && this.cplayer.money >= MONEY_EX_LIMIT) {
                    let npm = selectRandomPlans(middleSplanList, 2);
                    let nph = selectRandomPlans(highSplanList, 2);
                    let npex = selectRandomPlans(exSplanList, 1);

                    npm.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    nph.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    chosenPlans.push(npex[0]);
                } else if (this.cplayer.horizon > HORIZON_H_LIMIT && this.cplayer.money >= MONEY_H_LIMIT) {

                    let npl = selectRandomPlans(lowSplanList, 2);
                    let npm = selectRandomPlans(middleSplanList, 2);
                    let nph = selectRandomPlans(highSplanList, 1);

                    npl.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    npm.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    chosenPlans.push(nph[0]);
                } else if (this.cplayer.horizon > HORIZON_M_LIMIT && this.cplayer.money >= MONEY_M_LIMIT) {

                    let npl = selectRandomPlans(lowSplanList, 3);
                    let npm = selectRandomPlans(middleSplanList, 2);

                    npl.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    npm.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                } else {
                    let npl = selectRandomPlans(lowSplanList, 4);
                    let npm = selectRandomPlans(middleSplanList, 1);

                    npl.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    chosenPlans.push(npm[0]);
                }

                if (this.cplayer.strength <= 0) {
                    return zeroStrengthPlans;
                }

                if (this.cplayer.money <= 0) {
                    return zeroMoneyPlans;
                }

                if (this.cplayer.semester === 7) {
                    return DaSiShangSplanList;
                }

                if (this.cplayer.semester === 8) {
                    return DaSiXiaSplanList;
                }

                return chosenPlans;
            }
        }
        //期末考試成績界面
        const examReport = {
            title: document.createElement("h3"),
            subtitle: document.createElement("h4"),
            para1: document.createElement("p"),
            para2: document.createElement("p"),
            para3: document.createElement("p"),
            para4: document.createElement("p"),
            submit: document.createElement("button"),
            div: document.createElement("div"),
            text1: "本學期，你選修咗",
            text2: "門課。成績分別系：",
            text3: "你通過咗",
            text4: "門課，掛咗",
            text5: "門課。",
            text6: "你本學期嘅績點系：",
            textTBD: "--",
            cplayer: null,

            createDiv: function (player) {
                //初始化
                this.cplayer = player;
                this.title.textContent = "期末考試成績單";
                this.subtitle.textContent = "大一年上學期";
                this.para1.textContent = this.text1 + this.textTBD + this.text2;
                this.para2.textContent = this.textTBD;
                this.para3.textContent = this.text3 + this.textTBD + this.text4 + this.textTBD + this.text5;
                this.para4.textContent = this.text6 + this.textTBD;
                this.submit.textContent = "收到";
                this.submit.onclick = () => {
                    this.div.style.display = "none";
                    //先處理遊戲結束的情況
                    if (player.semester === 8) {
                        if (flagXuewei) {
                            //雙證齊全的情況
                            //按結局從好到壞依次判定
                            if (flagGongzuo3 && flagKaoYan3) {
                                setGameover(examReport.cplayer, PERFECT_END);
                            } else if (flagGongzuo3) {
                                setGameover(examReport.cplayer, GONGZUO3_END);
                            } else if (flagKaoYan3) {
                                setGameover(examReport.cplayer, KAOYAN_END);
                            } else if (flagKaoYan2) {
                                setGameover(examReport.cplayer, KAOYAN_END);
                            } else if (flagGongzuo2) {
                                setGameover(examReport.cplayer, GONGZUO2_END);
                            } else if (flagKaoYan1 && flagKaoshangYan) {
                                setGameover(examReport.cplayer, KAOYAN_END);
                            } else if (!flagGongzuo1) {
                                setGameover(examReport.cplayer, BIYE_SHIYE_END);
                            } else {
                                setGameover(examReport.cplayer, GONGZUO1_END);
                            }
                        } else if (flagDanbiye) {
                            //單證。按結局從好到壞依次判定
                            if (flagGongzuo1) {
                                setGameover(examReport.cplayer, GONGZUO1_END);
                            } else {
                                setGameover(examReport.cplayer, DANBIYE_END);
                            }
                        } else {
                            //結業
                            setGameover(examReport.cplayer, JIEYE_END);
                        }
                        return;
                    }
                    setVacationPage(this.cplayer, globalVocDivPointer);
                }
                this.div.appendChild(this.title);
                this.div.appendChild(this.subtitle);
                this.div.appendChild(this.para1);
                this.div.appendChild(this.para2);
                this.div.appendChild(this.para3);
                this.div.appendChild(this.para4);
                this.div.appendChild(this.submit);

                this.div.style.display = "none";
                this.div.className = "exam-container";
                this.title.className = "exam-title";
                this.subtitle.className = "exam-subtitle";
                this.para1.className = "exam-para";
                this.para2.className = "exam-para";
                this.para3.className = "exam-para";
                this.para4.className = "exam-para";
                this.submit.className = "exam-button";
                return this.div;
            },

            showGraduateDiv: function (player) {
                examReport.title.textContent = "畢業答辯";
                examReport.subtitle.textContent = "大四年下學期";
                if (numFailedExam <= 2) {
                    examReport.para1.textContent = "畢業答辯滿分100分。經專家討論，你的得分系：";
                    let sc = calLunwen(player);
                    examReport.para2.textContent = sc.toString();
                    if (sc < 60) {
                        flagDanbiye = true;  //畢業證單證
                        examReport.para3.textContent = "冇通過畢業答辯，拿唔到學位證！";
                        if ((flagKaoshangYan || flagGongzuo3 || flagGongzuo2) && !flagGongzuo1) {
                            this.para4.textContent = "冇學位證，考研、搵工作嘅事都黃咗……";
                        } else if (flagGongzuo1) {
                            this.para4.textContent = "黑作坊老闆答應你，冇學位證都能去上班。真系不幸中嘅萬幸。";
                        } else {
                            this.para4.textContent = "轉念一想，你既冇考上研究生，也冇搵到工作。冇學位證對你冇任何影響。你釋然咗。";
                        }
                    } else {
                        flagXuewei = true;   //畢業證+學位證
                        examReport.para3.textContent = "答辯委員會同意授予你學士學位。";
                        if (flagKaoshangYan || flagGongzuo3 || flagGongzuo2) {
                            this.para4.textContent = "前途一片光明！";
                        } else if (flagGongzuo1) {
                            this.para4.textContent = "收拾收拾去當牛馬啦。";
                        } else {
                            this.para4.textContent = "畢業即失業，但好彩畢業證學位證都拿到手咗。";
                        }
                    }
                } else {
                    flagJieye = true;   //結業證
                    examReport.para1.textContent = "你驚奇地發現，答辯名單上冇你名字！";
                    examReport.para2.textContent = "你打電話問輔導員，先知道因為自己掛科太多，根本就冇進入答辯流程。";
                    examReport.para3.textContent = "事後，你拿到咗結業證書";
                    if (flagKaoshangYan || flagGongzuo3 || flagGongzuo2) {
                        this.para4.textContent = "只拿到結業證，考上嘅研、搵到嘅工作都黃咗。";
                    } else if (flagGongzuo1) {
                        this.para4.textContent = "好在黑作坊老闆唔挑，只有結業證都能去當牛馬。";
                    } else {
                        this.para4.textContent = "好在你本來就一事無成，畢唔畢業都一個樣。";
                    }
                }
                this.div.style.display = "flex";
            },

            updateDiv: function (player) {
                //最後一學期是畢業論文
                if (player.semester === 8) {
                    examReport.showGraduateDiv(player);
                    return;
                }

                //計算期末考試成績
                //先查詢玩家上的哪所大學。rank與大學一一對應，用rank查。
                let univ = univList.find(un => un.rank === player.univRank);
                //再計算期末考多少門課、考試基礎難度。和專業、年級有關。
                let exNum = 0;
                let exbase = player.examBase;
                switch (player.major) {
                    case ART_MAJOR: {
                        exNum = ART_NUM;
                        exbase += ART_DIFF;
                        break;
                    }
                    case SOCIAL_MAJOR: {
                        exNum = SOCIAL_NUM;
                        exbase += SOCIAL_DIFF;
                        break;
                    }
                    case ENGINEER_MAJOR: {
                        exNum = ENGINEER_NUM;
                        exbase += ENGINEER_DIFF;
                        break;
                    }
                    case SCIENCE_MAJOR: {
                        exNum = SCIENCE_NUM;
                        exbase += SCIENCE_DIFF;
                        break;
                    }
                    case MEDICAL_MAJOR: {
                        exNum = MEDICAL_NUM;
                        exbase += MEDICAL_DIFF;
                        break;
                    }
                }

                //大二、大三時，多加一門課
                if (player.year === 2 || player.year === 3) {
                    exNum++;
                }
                //一年增加兩點智力的情況下，對考試下限修正是+10。
                if (player.univRank <= 4) {
                    exbase -= (player.year - 1) * 20;
                } else if (player.univRank <= 8) {
                    exbase -= (player.year - 1) * 15;
                } else {
                    exbase -= (player.year - 1) * 10;
                }
                //通關特典加成
                if (flagJuanWang) {
                    exbase += 30;
                }
                //為方便後續補考程序，將更新後的exbase再傳回去
                player.examBase = exbase;
                let score = calFinalExam(player.intelligence, exbase, univ, exNum, player.luck);
                //score是一個數組。數組元素是0-100的數，代表每門課考多少分；數組長度是考試門數。
                let gpa = calExamGPA(score);
                //該函數接受一個以0-100計分的數組，計算每門課績點，再返回一個0-400的數表示平均績點。
                let cNum = score.length;
                switch (player.year) {
                    case 1: {
                        this.subtitle.textContent = "大一年";
                        break;
                    }
                    case 2: {
                        this.subtitle.textContent = "大二年";
                        break;
                    }
                    case 3: {
                        this.subtitle.textContent = "大三年";
                        break;
                    }
                    case 4: {
                        this.subtitle.textContent = "大四年";
                        break;
                    }
                };
                if (player.semester % 2 === 0) {
                    this.subtitle.textContent += "下學期";
                } else {
                    this.subtitle.textContent += "上學期";
                };
                let sText = "";

                for (let i = 0; i < cNum; i++) {
                    //百分製成績換算成各等級
                    if (score[i] >= ALLimit) {
                        sText += "A";
                    } else if (score[i] >= AminusLLimit) {
                        sText += "A-";
                    } else if (score[i] >= BplusLLimit) {
                        sText += "B+";
                    } else if (score[i] >= BLLimit) {
                        sText += "B";
                    } else if (score[i] >= BminusLLimit) {
                        sText += "B-";
                    } else if (score[i] >= CplusLLimit) {
                        sText += "C+";
                    } else if (score[i] >= CLLimit) {
                        sText += "C";
                    } else if (score[i] >= CminusLLimit) {
                        sText += "C-";
                    } else if (score[i] >= DLLimit) {
                        sText += "D";
                    } else {
                        sText += "F";
                    }
                    if (i < score.length - 1) {
                        sText += "，";
                    } else {
                        sText += "。";
                    }
                };

                let pCourse = score.filter(element => element >= 60);
                let pNum = pCourse.length;
                let fCourse = score.filter(element => element < 60);
                let fNum = fCourse.length;
                let sgpa = (0.01 * gpa).toFixed(2);

                numCurrentFail = fNum;
                let gpaarray = score2GPA(score);
                for (let i = 0; i < score.length; i++) {
                    totalGPAArray.push(gpaarray[i]);
                }
                let tgpa = gpaArray2GPA(totalGPAArray);  //之前學期總績點
                this.para1.textContent = this.text1 + cNum.toString() + this.text2;
                this.para2.textContent = sText;
                this.para3.textContent = this.text3 + pNum.toString() + this.text4 + fNum.toString() + this.text5;
                this.para4.textContent = this.text6 + sgpa.toString();
                gradeReport.updateDiv(gpa, tgpa, player.major, pNum);
                player.cgpa = gpa;
                player.tgpa = tgpa;
                this.div.style.display = "flex";
            }
        }
        //掛科補考欄
        const examResit = {
            title: document.createElement("h3"),
            div1: document.createElement("div"),
            div2: document.createElement("div"),
            div3: document.createElement("div"),
            button: document.createElement("button"),
            div: document.createElement("div"),
            done: false,  //表示補考前、補考後
            cplayer: null,

            createDiv: function (player) {
                this.cplayer = player;
                this.div1.innerHTML = "";
                this.div2.innerHTML = "";
                this.div3.innerHTML = "";
                this.title.textContent = "開學補考";
                this.button.textContent = "點我開始補考";

                this.button.onclick = () => {
                    //補考後
                    if (examResit.done) {
                        examResit.done = false;
                        examResit.button.textContent = "點我開始補考";
                        examResit.div1.innerHTML = "";
                        examResit.div2.innerHTML = "";
                        examResit.div3.innerHTML = "";
                        examResit.div.style.display = "none";
                        //跳轉到學期規劃界面。因為這是新學期的開頭，所以學年、學期等數據不在此變更。
                        examResit.cplayer.examBase = 0;
                        schoolTodoList.showPlan(examResit.cplayer);
                        return;
                    }
                    //補考前
                    let exnum = numCurrentFail;
                    numCurrentFail = 0;
                    let exbase = examResit.cplayer.examBase;
                    exbase += 5;
                    examResit.cplayer.examBase = 0;
                    let univ = univList.find(un => un.rank === (examResit.cplayer).univRank);
                    let inte = examResit.cplayer.intelligence;
                    let luck = examResit.cplayer.luck;

                    let score = calFinalExam(inte, exbase, univ, exnum, luck);
                    let pCourse = score.filter(element => element >= 60);
                    let pNum = pCourse.length;
                    let fCourse = score.filter(element => element < 60);
                    let fNum = fCourse.length;

                    examResit.div2.textContent = pNum.toString() + "門課補考後合格，成績記錄變更為‘P’。";
                    if (fNum > 0) {
                        examResit.div2.textContent += fNum.toString() + "門課仍然唔合格，維持‘F’嘅記錄。";
                    };
                    //更新成績記錄
                    let j = 0;
                    for (let i = 0; i < totalGPAArray.length; i++) {
                        if (j >= pNum) {
                            break;
                        }
                        //補考通過pNum門課，將成績記錄裏pNum門不合格的課改為補考合格
                        if (totalGPAArray[i] === 0) {
                            totalGPAArray[i] = 100;  // 補考合格P對應績點1.00
                            j++;
                        }
                    }

                    let tgpa = gpaArray2GPA(totalGPAArray);

                    //處理掛科的學業警告
                    if (fNum > 0) {
                        //第一次掛科
                        if (numFailedExam === 0 && fNum <= 2) {
                            gradeReport.appendWarning("掛科喇，失去保研資格！");
                        } else if (numFailedExam <= 2 && numFailedExam + fNum > 2) {
                            //第一次觸發學業預警
                            gradeReport.appendWarning("你掛咗超過兩門課，觸發學業預警。掛五門課即退學，務必端正學習態度。");
                        }

                        numFailedExam += fNum;
                        if (numFailedExam >= 5) {
                            //掛科太多，直接結束遊戲
                            setGameover(examResit.cplayer, GUAKE_END);
                        }
                    }

                    gradeReport.updateDiv(TBDGPA, tgpa, player.major, pNum);
                    examResit.div3.textContent = "總成績單已更新，請自行查看。"
                    examResit.button.textContent = "收到";
                    examResit.done = true;
                }

                this.div.appendChild(this.title);
                this.div.appendChild(this.div1);
                this.div.appendChild(this.div2);
                this.div.appendChild(this.div3);
                this.div.appendChild(this.button);
                this.div.className = "resit-container";
                this.title.className = "resit-title";
                this.div1.className = "resit-div";
                this.div2.className = "resit-div";
                this.div3.className = "resit-div";
                this.button.className = "resit-button";

                examResit.div.style.display = "none";
                return this.div;

            },

            updateDiv: function () {
                //補考時已進入新學期
                let exnum = numCurrentFail;
                this.div1.textContent = "你上學期掛咗" + exnum.toString() + "門課。"
                examResit.div.style.display = "flex";
            }


        }
        //學年總結
        const yearReport = {
            title: document.createElement("h3"),
            div1: document.createElement("div"),
            div2: document.createElement("div"),
            div3: document.createElement("div"),
            div4: document.createElement("div"),
            button: document.createElement("button"),
            div: document.createElement("div"),
            cplayer: null,

            createDiv: function (player) {
                this.cplayer = player;
                this.title.textContent = "學年總結";
                this.button.textContent = "開啟新學年";
                this.div.appendChild(this.title);
                this.div.appendChild(this.div1);
                this.div.appendChild(this.div2);
                this.div.appendChild(this.div3);
                this.div.appendChild(this.div4);
                this.div.appendChild(this.button);
                this.div.style.display = "none";

                this.button.onclick = () => {
                    yearReport.cplayer.year++;
                    yearReport.cplayer.semester++;
                    gradeReport.updateDiv(TBDGPA, yearReport.cplayer.tgpa, yearReport.cplayer.major, 0);
                    titleBanner.updateDiv(yearReport.cplayer);
                    yearReport.div.style.display = "none";
                    if (numCurrentFail > 0) {
                        examResit.updateDiv();
                    } else {
                        yearReport.cplayer.examBase = 0;
                        schoolTodoList.showPlan(yearReport.cplayer);
                    }
                }
                this.div.className = "yearr-container";
                this.title.className = "yearr-title";
                this.div1.className = "yearr-div";
                this.div2.className = "yearr-div";
                this.div3.className = "yearr-div";
                this.div4.className = "yearr-div";
                this.button.className = "yearr-button";

                return this.div;
            },

            updateDiv: function () {
                //此函數同時更新各項數據
                let univ = univList.find(un => un.rank === (yearReport.cplayer).univRank);
                //計算學校給玩家的年度加成
                univ.update(yearReport.cplayer);
                yearReport.div1.textContent = "一年過去，增長咗唔少知識。（基礎屬性提升。）";

                //計算收支
                let fac = yearReport.cplayer.finance;  //財商提供的收入系數
                if (fac > 50) {
                    fac = 50;
                }
                if (fac < 0) {
                    fac = 0;
                }

                //財商提供的理財收入
                let fmoney = Math.floor(0.01 * fac * yearReport.cplayer.money);
                fmoney += fac * 500;

                //家裏給的生活費
                let wmoney = yearReport.cplayer.wealth * yearReport.cplayer.wealth * 100;

                let income = fmoney + wmoney - univ.fee;

                this.div2.textContent = "被動理財收入" + fmoney.toString() + "元（與財商、現有資金相關），屋企畀嘅生活費" + wmoney.toString() + "元（與家境有關），學費" + univ.fee.toString() + "元。";
                this.div3.textContent = "淨收支" + income.toString() + "元。";

                yearReport.cplayer.money += income;

                this.div4.textContent = "明年都要繼續努力。";

                statusBanner.updateDiv(yearReport.cplayer);
                yearReport.div.style.display = "flex";

            }
        }
        //過渡界面
        const tranKeyframes = [
            { transform: "rotate(0) scale(1)" },
            { transform: "rotate(360deg) scale(0)" },
        ];
        const tranParams = {
            duration: 1000,
            iteration: 1,
        };
        const transPage = {
            rotDiv: document.createElement("div"),
            text1: document.createElement("div"),
            text2: document.createElement("div"),
            cplayer: null,  //用來傳參
            isrunning: false,  //避免動畫出錯

            createDiv: function (player) {
                let div = document.createElement("div");
                this.text1.textContent = "11";
                this.text2.textContent = "22";
                this.text1.className = "trans-text";
                this.text2.className = "trans-text";
                this.rotDiv.appendChild(this.text1);
                this.rotDiv.appendChild(this.text2);
                this.rotDiv.addEventListener("click", transPage.rotate);
                div.appendChild(this.rotDiv);
                this.rotDiv.className = "trans-container";
                this.rotDiv.style.display = "none";
                this.cplayer = player;
                this.isrunning = false;
                return div;
            },

            showDiv: function () {
                this.text1.textContent = "考試周到咗";
                this.text2.textContent = "點我開始期末考試";
                this.rotDiv.style.display = "flex";
                //最後一學期寫畢業論文，唔使上課。
                if (transPage.cplayer.semester === 8) {
                    this.text1.textContent = "終於寫完畢業論文喇";
                    this.text2.textContent = "點我開始畢業答辯";
                }
            },

            rotate: function () {
                if (transPage.isrunning) {
                    return;
                }
                //檢測瀏覽器是否支持
                if ("animate" in document.body) {
                    transPage.isrunning = true;
                    transPage.rotDiv.animate(tranKeyframes, tranParams).finished.then(() => {
                        //等動畫結束後，執行後續操作
                        transPage.rotDiv.style.display = "none"; //隱藏本頁面
                        transPage.isrunning = false;
                        if (transPage.cplayer.semester === 8) {
                            examReport.showGraduateDiv(transPage.cplayer);
                            return;
                        }
                        examReport.updateDiv(transPage.cplayer);
                    }).catch((error) => {
                        console.error("動畫出錯：", error);
                        transPage.isrunning = false;
                        alert("哎呀，出錯啦。請再試一遍。");
                    });
                } else {
                    //處理不支持動畫的情況
                    console.log("瀏覽器不支持動畫，直接跳過");
                    transPage.rotDiv.style.display = "none";
                    transPage.isrunning = false;
                    if (transPage.cplayer.semester === 8) {
                        examReport.showGraduateDiv(transPage.cplayer);
                        return;
                    }
                    examReport.updateDiv(transPage.cplayer);
                }
            }
        }


        //總成績單
        const gradeReport = {
            title: document.createElement("h3"),
            currentGPA: document.createElement("p"), //本學期GPA
            totalGPA: document.createElement("p"), //總GPA
            failCourse: document.createElement("p"), //掛科數
            passCourse: document.createElement("p"), //已修課程數
            gradeWarning: document.createElement("div"), //相關警告

            currentGPAText1: "本學期績點：",
            currentGPANum: 0,
            totalGPAText1: "總學分績：",
            totalGPANum: 0,
            failCourseText1: "掛科數：",
            failCourseNum: 0,
            passCourseText1: "已通過課程數：",
            passCourseNum: 0,
            textTBD: "--",

            createDiv: function (major) {
                this.title.textContent = "成績單";

                //考慮到多周目遊戲裏，相關值可能被改變。調用該函數初始化時，應將相關值置零。
                this.currentGPANum = 0;
                this.totalGPANum = 0;
                this.failCourseNum = 0;
                this.passCourseNum = 0;
                this.gradeWarning.innerHTML = "";

                this.currentGPA.textContent = this.currentGPAText1 + this.textTBD;
                this.totalGPA.textContent = this.totalGPAText1 + this.textTBD;
                this.failCourse.textContent = this.failCourseText1 + this.failCourseNum.toString();
                this.passCourse.textContent = this.passCourseText1 + this.passCourseNum.toString();

                switch (major) {
                    case artMajorCode: {
                        this.passCourse.textContent += ("/" + artTotalCourseNum.toString());
                        break;
                    }
                    case socialMajorCode: {
                        this.passCourse.textContent += ("/" + socialTotalCourseNum.toString());
                        break;
                    }
                    case engineerMajorCode: {
                        this.passCourse.textContent += ("/" + engineerTotalCourseNum.toString());
                        break;
                    }
                    case scienceMajorCode: {
                        this.passCourse.textContent += ("/" + scienceTotalCourseNum.toString());
                        break;
                    }
                    case medicalMajorCode: {
                        this.passCourse.textContent += ("/" + medicalTotalCourseNum.toString());
                        break;
                    }
                    default:
                        break;
                };

                let div = document.createElement("div");
                div.appendChild(this.title);
                div.appendChild(this.currentGPA);
                div.appendChild(this.totalGPA);
                div.appendChild(this.failCourse);
                div.appendChild(this.passCourse);
                div.appendChild(this.gradeWarning);
                div.className = "sidebar";
                return div;
            },

            updateDiv: function (cGPA, tGPA, major, pnum) {
                //cGPA表示當前學期GPA
                //tGPA表示總GPA
                this.currentGPA.textContent = this.currentGPAText1 + ((0.01 * cGPA).toFixed(2)).toString() + "/4.00";
                this.totalGPA.textContent = this.totalGPAText1 + ((0.01 * tGPA).toFixed(2)).toString() + "/4.00";
                this.failCourse.textContent = this.failCourseText1 + (numCurrentFail + numFailedExam).toString();
                gradeReport.passCourseNum += pnum;
                this.passCourse.textContent = this.passCourseText1 + (this.passCourseNum).toString();

                if (cGPA === TBDGPA) {
                    this.currentGPA.textContent = this.currentGPAText1 + this.textTBD;
                }

                switch (major) {
                    case artMajorCode: {
                        this.passCourse.textContent += ("/" + artTotalCourseNum.toString());
                        break;
                    }
                    case socialMajorCode: {
                        this.passCourse.textContent += ("/" + socialTotalCourseNum.toString());
                        break;
                    }
                    case engineerMajorCode: {
                        this.passCourse.textContent += ("/" + engineerTotalCourseNum.toString());
                        break;
                    }
                    case scienceMajorCode: {
                        this.passCourse.textContent += ("/" + scienceTotalCourseNum.toString());
                        break;
                    }
                    case medicalMajorCode: {
                        this.passCourse.textContent += ("/" + medicalTotalCourseNum.toString());
                        break;
                    }
                    default:
                        break;
                };

            },

            appendWarning: function (msg) {
                //學業警告資訊
                let p = document.createElement("p");
                p.textContent = msg;
                this.gradeWarning.appendChild(p);
            }

        }

    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        ul li {
            list-style-type: none;
        }

        /*Github角標樣式*/
        .github-corner {
            z-index: 999;
            position: sticky;
            top: 0;
        }


        /*歡迎頁設置*/
        .welcome-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .welcome-flex {
            text-align: center;
        }

        .wfirst {
            font-size: 2em;
            margin-bottom: 40px;
        }

        .wsecond {
            font-size: 1.5em;
            margin-bottom: 80px;
        }

        .wbutton {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 2em;
            cursor: pointer;
            border-radius: 5px;
        }



        /*選專業頁設置*/
        .major-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .major-title {
            font-size: 1.5em;
            margin-bottom: 20px;

        }

        .major-rgroup {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .major-ritem {
            font-size: 1.5em;
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }


        .major-page input {

            border-radius: 50%;
            width: 16px;
            height: 16px;

            border: 2px solid #999;
            transition: 0.2s all linear;
            margin-right: 5px;

            position: relative;
        }

        .major-page input:checked {
            border: 6px solid black;
        }

        .major-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
        }

        /*填志願頁設置*/
        .apply-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .apply-title {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .apply-container {
            display: flex;
            flex-direction: column;
        }

        .apply-univname {
            font-size: 1.2em;
        }

        .apply-univtext {
            margin-top: 5px;
        }

        .apply-univcontainer {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            background-color: rgb(242, 241, 233);
            border: 1px solid rgb(200, 233, 245);
            /* 普通的邊框 */
            border-width: 2px;
            /* 邊框寬度 */
            border-style: solid;
            /* 邊框樣式 */
            border-radius: 5px;
            /* 邊框圓角 */
        }

        .apply-univcontainer.done {
            background-color: lightblue;
            border-color: red;
        }





        /*
    .apply-description {
      font-size: 1.5em;
      margin-bottom: 20px;
    }
    
    .apply-univ {
      font-size: 1em;
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
      width: 40%;
      background-color: beige;
    }
    
    .apply-univ-label {
      font-size: 1.2em;
      height: 65%;
    }
    */

        .apply-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
        }

        /*錄取頁設置*/
        .admission-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .admission-title {
            font-size: 1.7em;
            margin-bottom: 35px;
        }

        .admission-txt {
            font-size: 1.3em;
            margin-bottom: 50px;
        }

        .admission-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }


        /*主頁面*/




        .mTitle {
            text-align: center;
            padding: 20px;
            background-color: #f1f1f1;
        }

        .statusBar {
            overflow: hidden;
            background-color: #333;
            text-align: center;
            padding: 30px;
            position: sticky;
            top: 0;
        }

        .status-span {
            padding: 14px;
            color: white;
            white-space: nowrap;
            /* 避免狀態欄在奇怪的地方換行  */
        }

        .plain-status-span {
            padding: 5px;
            font-weight: normal;
            color: white;
        }

        .warning-status-span {
            color: #FF6666;
            font-weight: bold;
        }

        .bcontainer {
            display: flex;
            flex-wrap: wrap;
        }

        .sidebar {
            width: 100%;
            /*顯示在小螢幕上時為100%寬度*/
            background-color: #f1f1f1;
            padding: 15px;
            box-sizing: border-box;
            align-items: center;
            justify-content: center;
        }

        .ccontainer {
            width: 100%;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* 媒體查詢：當螢幕寬度大於600px時，應用以下樣式 */
        @media screen and (min-width: 600px) {
            .sidebar {
                width: 20%;
                /* 在大螢幕上側邊欄寬度為20% */
            }

            .ccontainer {
                width: 60%;
                /* 在大螢幕上內容寬度為60% */
            }

            .bcontainer {
                flex-direction: row;
            }
        }

        /* 學期規劃界面 */
        .splan-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .splan-title {
            font-size: 1.4em;
            margin-bottom: 25px;
        }

        .splan-buttonbox {
            align-items: center;
            justify-content: center;
            display: flex;
            flex-direction: column;
            font-size: 1em;
            margin-bottom: 15px;
            background-color: #333;
            color: white;
            text-align: center;
        }

        .splan-button {
            width: 75%;
            padding: 5px 5px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 特殊事件界面 */
        .sevent-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .sevent-title {
            font-size: 1.3em;
            margin-bottom: 30px;
        }

        .sevent-para1 {
            padding: 15px;
            font-size: 1.3em;
            margin-bottom: 40px;
            background-color: #f1f1f1;
            width: 50%;
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .sevent-para2 {
            background-color: #f1f1f1;
            width: 50%;
            padding: 10px;
            text-align: center;
            margin-bottom: 30px;
            justify-content: center;
            align-items: center;
            line-height: 150%;
        }

        .sevent-button {
            padding: 5px;
            font-size: 1.2em;
            width: 30%;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 轉場頁  */
        .trans-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: lightyellow;
        }

        .trans-text {
            font-size: 1.3em;
            margin-bottom: 20px;
        }


        /* 期末考試頁  */
        .exam-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f1f1f1;
        }

        .exam-title {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .exam-subtitle {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .exam-para {
            margin-bottom: 10px;
        }

        .exam-button {
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 假期事件頁 */
        .vacation-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .vacation-title {
            font-size: 1.5em;
            margin-bottom: 25px;
        }

        .vacation-div1 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .vacation-div2 {
            margin-bottom: 20px;
            line-height: 150%;
        }

        .vacation-button {
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 補考頁 */
        .resit-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .resit-title {
            font-size: 1.5em;
            margin-bottom: 25px;
        }

        .vacation-div {
            margin-bottom: 10px;
        }

        .resit-button {
            margin-top: 35px;
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }







        /*  學年總結頁  */
        .yearr-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f1f1f1;
        }

        .yearr-title {
            font-size: 1.5em;
            margin-bottom: 30px;
        }

        .yearr-div {
            line-height: 150%;
            margin-bottom: 5px;
        }

        .yearr-button {
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
            background-color: lightgray;
        }




        /* 結局頁相關  */

        .gameover-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .gameover-title {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .gameover-subtitle {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .gameover-container {
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        .gameover-button {
            margin-top: 30px;
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }



        /*  結算頁相關   */

        .enddata-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .enddata-title {
            font-size: 2em;
            margin-bottom: 40px;
            text-align: center;
        }

        .enddata-container {
            margin-bottom: 10px;
            font-size: 1.2em;
            line-height: 150%;
        }

        .enddata-rankdiv {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.4em;
        }

        .enddata-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }


        .attr-rating-S {
            color: red;
        }

        .attr-rating-A {
            color: gold;
        }

        .attr-rating-B {
            color: green;
        }

        .attr-rating-C {
            color: lightblue;
        }

        .attr-rating-D {
            color: darkblue;
        }

        .attr-rating-E {
            color: dimgrey;
        }

        .end-rating-S {
            color: red;
        }

        .end-rating-A {
            color: gold;
        }

        .end-rating-B {
            color: green;
        }

        .end-rating-C {
            color: lightblue;
        }

        .end-rating-D {
            color: darkblue;
        }

        .end-rating-E {
            color: dimgrey;
        }



        /* 通關特典頁面  */

        .gift-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .gift-rating-S {
            color: red;
        }

        .gift-rating-A {
            color: gold;
        }

        .gift-rating-B {
            color: lightgreen;
        }

        .gift-rating-C {
            color: lightblue;
        }

        .gift-rating-D {
            color: darkblue;
        }

        .gift-rating-E {
            color: black;
        }

        .gift-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .gift-container {
            margin-bottom: 35px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .gift-item {
            padding: 10px;
            background: #9f9e9e;
            margin-bottom: 10px;
            border: 1px solid rgb(200, 233, 245);
            /* 普通的邊框 */
            border-width: 2px;
            /* 邊框寬度 */
            border-style: solid;
            /* 邊框樣式 */
            border-radius: 5px;
            /* 邊框圓角 */
        }

        .gift-item.done {
            background: #5691ff;
            border-color: red;
        }

        .gift-button {
            padding: 10px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>

    <title>大學模擬器粵語版</title>
</head>

<body style="margin: 0; height: 100%">
    <a href="https://github.com/lingch16/UnivSimulator" target="_blank" class="github-corner"
        title="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250"
            style="fill:#333; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg>
    </a>

    <div class="welcome-page">
        <div class="welcome-flex wfirst">
            <h1>高考終於出分喇！</h1>
        </div>

        <div class="welcome-flex wsecond">
            <p>而家快啲嚟</p>
        </div>

        <div class="welcome-flex">
            <button id="startButton" class="wbutton" disabled>加載中...</button>
        </div>
    </div>


    <script>//選專業界面
        function setMajorPage(player) {

            //清空之前的頁面
            document.body.innerHTML = "";
            //document.body.innerHTML = githubCorner;

            let title = document.createElement("h2");
            title.textContent = "選擇一個鐘意嘅專業啦：";

            let majorTDiv = document.createElement("div");
            majorTDiv.appendChild(title);



            let optionArt = document.createElement("input");
            let optionSoc = document.createElement("input");
            let optionEng = document.createElement("input");
            let optionSci = document.createElement("input");
            let optionMed = document.createElement("input");
            let labelArt = document.createElement("label");
            let labelSoc = document.createElement("label");
            let labelEng = document.createElement("label");
            let labelSci = document.createElement("label");
            let labelMed = document.createElement("label");

            optionArt.type = "radio";
            optionArt.name = "majorChoose";
            optionArt.id = "choiceArt";
            optionArt.value = "art";

            optionSoc.type = "radio";
            optionSoc.name = "majorChoose";
            optionSoc.id = "choiceSoc";
            optionSoc.value = "soc";

            optionEng.type = "radio";
            optionEng.name = "majorChoose";
            optionEng.id = "choiceEng";
            optionEng.value = "eng";

            optionSci.type = "radio";
            optionSci.name = "majorChoose";
            optionSci.id = "choiceSci";
            optionSci.value = "sci";

            optionMed.type = "radio";
            optionMed.name = "majorChoose";
            optionMed.id = "choiceMed";
            optionMed.value = "med";

            labelArt.htmlFor = optionArt.id;
            labelSoc.htmlFor = optionSoc.id;
            labelEng.htmlFor = optionEng.id;
            labelSci.htmlFor = optionSci.id;
            labelMed.htmlFor = optionMed.id;

            labelArt.textContent = "純文科（期末考試簡單）";
            labelSoc.textContent = "經管法等社科類（比較均衡）";
            labelEng.textContent = "新工科類專業（好搵工作）";
            labelSci.textContent = "基礎科學（更容易保研）";
            labelMed.textContent = "醫科專業（高難，建議二週目再選）";

            let majorGroupDiv = document.createElement("div");

            let majorItemDiv1 = document.createElement("div");
            let majorItemDiv2 = document.createElement("div");
            let majorItemDiv3 = document.createElement("div");
            let majorItemDiv4 = document.createElement("div");
            let majorItemDiv5 = document.createElement("div");

            majorItemDiv1.appendChild(optionArt);
            majorItemDiv1.appendChild(labelArt);

            majorItemDiv2.appendChild(optionSoc);
            majorItemDiv2.appendChild(labelSoc);

            majorItemDiv3.appendChild(optionEng);
            majorItemDiv3.appendChild(labelEng);

            majorItemDiv4.appendChild(optionSci);
            majorItemDiv4.appendChild(labelSci);

            majorItemDiv5.appendChild(optionMed);
            majorItemDiv5.appendChild(labelMed);

            let submit = document.createElement("button");
            submit.textContent = "確定";

            majorTDiv.className = "major-title";

            majorGroupDiv.className = "major-rgroup";

            majorItemDiv1.className = "major-ritem";
            majorItemDiv2.className = "major-ritem";
            majorItemDiv3.className = "major-ritem";
            majorItemDiv4.className = "major-ritem";
            majorItemDiv5.className = "major-ritem";

            majorGroupDiv.appendChild(majorItemDiv1);
            majorGroupDiv.appendChild(majorItemDiv2);
            majorGroupDiv.appendChild(majorItemDiv3);
            majorGroupDiv.appendChild(majorItemDiv4);
            majorGroupDiv.appendChild(majorItemDiv5);

            submit.className = "major-button";

            let majorPageDiv = document.createElement("div");
            majorPageDiv.appendChild(majorTDiv);
            majorPageDiv.appendChild(majorGroupDiv);
            majorPageDiv.appendChild(submit);
            majorPageDiv.className = "major-page";

            submit.onclick = () => {

                let choice = document.querySelector('input[name="majorChoose"]:checked');

                if (!choice) {
                    alert("請揀選一個選項");
                    return;
                }

                switch (choice.value) {
                    case optionArt.value: {
                        player.major = artMajorCode;
                        break;
                    }
                    case optionSoc.value: {
                        player.major = socialMajorCode;
                        break;
                    }
                    case optionEng.value: {
                        player.major = engineerMajorCode;
                        break;
                    }
                    case optionSci.value: {
                        player.major = scienceMajorCode;
                        break;
                    }
                    case optionMed.value: {
                        player.major = medicalMajorCode;
                        player.risk += 10;    //增加遊戲難度
                        break;
                    }
                }
                optionArt = null;
                optionSoc = null;
                optionEng = null;
                optionSci = null;
                optionMed = null;
                labelArt = null;
                labelSoc = null;
                labelEng = null;
                labelSci = null;
                labelMed = null;
                submit = null;
                div = null;
                setCollegeApplyPage(player);
            };

            document.body.appendChild(majorPageDiv);

        }

        //主程序
        function setUnivGame(my) {
            //頁面佈局
            let mainDiv = document.createElement("div");


            let mainTitle = titleBanner.createDiv();     //最上方的標題

            let statusDiv = statusBanner.createDiv(my);   //上方的狀態欄，顯示體力、心情、精力、金錢

            let eventDiv = eventRecord.createDiv();  //重要事件列表，靠左顯示

            let centerContainer = document.createElement("div"); //中間的顯示界面

            let schoolPlanDiv = schoolTodoList.createDiv();  //學期規劃欄
            let specialeventDiv = specialEventList.createDiv(my);  //特殊事件欄
            let examContainer = examReport.createDiv(my);  //期末考試成績顯示欄
            let transDiv = transPage.createDiv(my); //轉場動畫頁
            globalVocDivPointer = document.createElement("div"); //假期事件欄
            let examresitDiv = examResit.createDiv(my); //掛科開學補考頁
            let yearrDiv = yearReport.createDiv(my);  //學年總結頁

            centerContainer.appendChild(schoolPlanDiv);
            centerContainer.appendChild(specialeventDiv);
            centerContainer.appendChild(examContainer);
            centerContainer.appendChild(transDiv);
            centerContainer.appendChild(globalVocDivPointer);
            centerContainer.appendChild(examresitDiv);
            centerContainer.appendChild(yearrDiv);
            centerContainer.className = "ccontainer";

            let gradeDiv = gradeReport.createDiv(my.major); //總成績單，靠右側顯示

            let bigContainer = document.createElement("div"); //標題、狀態欄下面的全部
            bigContainer.className = "bcontainer";
            bigContainer.appendChild(eventDiv);
            bigContainer.appendChild(centerContainer);
            bigContainer.appendChild(gradeDiv);


            mainDiv.appendChild(mainTitle);
            mainDiv.appendChild(statusDiv);
            mainDiv.appendChild(bigContainer);

            document.body.appendChild(mainDiv);


            my.year = 1;
            my.semester = 1;

            //更新頁面設置

            titleBanner.updateDiv(my);
            schoolTodoList.showPlan(my);




        }

        //錄取通知書頁
        function setAdmissionLetterPage(collegeRank, player) {

            let title = document.createElement("h2");
            let text = document.createElement("h3");
            let college = univList.find((univ) => univ.rank === collegeRank);

            if (collegeRank < rankexUniv.rank) {
                title.textContent = "恭喜！";
            } else {
                title.textContent = "你滑檔喇！";
            }
            text.textContent = "你被" + college.name + "錄取咗";

            let admissionDiv = document.createElement("div");
            admissionDiv.className = "admission-page";

            let atDiv = document.createElement("div");
            atDiv.className = "admission-title";
            let atxtDiv = document.createElement("div");
            atxtDiv.className = "admission-txt";

            atDiv.appendChild(title);
            atxtDiv.appendChild(text);

            let okButton = document.createElement("button");
            okButton.textContent = "點我開啟大學生活";
            okButton.className = "admission-button";
            okButton.onclick = function () {

                document.body.removeChild(admissionDiv);
                admissionDiv = null;

                setUnivGame(player);

            }

            admissionDiv.appendChild(atDiv);
            admissionDiv.appendChild(atxtDiv);
            admissionDiv.appendChild(okButton);
            document.body.appendChild(admissionDiv);

        }

        //志願填報頁面
        function setCollegeApplyPage(currentPlayer) {
            //刪除之前頁面
            document.body.innerHTML = "";
            //document.body.innerHTML = githubCorner;

            let collegeApplyDiv = document.createElement("div");
            collegeApplyDiv.className = "apply-page";
            let applyContainer = document.createElement("div");
            applyContainer.className = "apply-container";

            let title = document.createElement("h2");
            title.textContent = "志願填報"
            title.className = "apply-title";

            let description1 = document.createElement("h3");
            description1.className = "apply-description";

            switch (currentPlayer.intelligence) {
                case 10:
                    description1.textContent = "你嘅高考位次：省狀元";
                    break;
                case 9:
                    description1.textContent = "你嘅高考位次：市狀元";
                    break;
                case 8:
                    description1.textContent = "你嘅高考位次：萬裏挑一";
                    break;
                case 7:
                    description1.textContent = "你嘅高考分：頂尖高校提檔線";
                    break;
                case 6:
                    description1.textContent = "你嘅高考成績：全校第一";
                    break;
                case 5:
                    description1.textContent = "你嘅高考位次：百裏挑一";
                    break;
                case 4:
                    description1.textContent = "你嘅高考成績：班級前十";
                    break;
                case 3:
                    description1.textContent = "你嘅高考成績：中等偏上";
                    break;
                case 2:
                    description1.textContent = "你嘅高考分：只有平均分";
                    break;
                case 1:
                    description1.textContent = "你嘅高考分：勉勉強強";
                    break;
                default:
                    description1.textContent = "你嘅高考分：唔系咁理想";
                    break;
            }

            if (currentPlayer.intelligence > 10) {
                description1.textContent = "你嘅高考成績：刷新歷史記錄";
            }


            let description2 = document.createElement("h3");
            description2.className = "apply-description";
            description2.textContent = "志願規劃師為你推薦咗五所學校，按去年錄取分數線從高到低嘅順序，排列如下。請揀選其中三所。"

            collegeApplyDiv.appendChild(title);
            collegeApplyDiv.appendChild(description1);
            collegeApplyDiv.appendChild(description2);

            //用隨機生成的智商代替高考分數，作為填志願的依據。填報成功失敗與院校排名和智商有關。    
            //@HazukiKaguya：
            //優化志願填報頁面院校邏輯

            //第一梯隊填報的第五個志願從第二梯隊中隨機抽取；
            let tier1UnivList = [...goodUniv];
            tier1UnivList.push(fairUniv[getRandomInteger(0, 4)]);

            //第二梯隊填報的第五個志願從第三梯隊中隨機抽取，前四個志願為第二梯隊的五個隨機刪去一個；
            let fairRandomUnivList = [...fairUniv];
            fairRandomUnivList.splice(getRandomInteger(0, 4), 1);
            let tier2UnivList = [...fairRandomUnivList];
            tier2UnivList.push(poorUniv[getRandomInteger(0, 2)]); //poorUniv數組有四個元素，最後一個是tier4的學校。這裏只在前三個tier3的學校間隨機抽。

            //第三梯隊填報的第一個志願從第二梯隊中隨機抽取
            let tier3UnivList = [fairUniv[getRandomInteger(0, 4)]];
            tier3UnivList.push(...poorUniv);

            let currentUnivList = [];
            if (currentPlayer.intelligence >= 6) {
                currentUnivList = [...tier1UnivList];
            } else if (currentPlayer.intelligence >= 3) {
                currentUnivList = [...tier2UnivList];
            } else {
                currentUnivList = [...tier3UnivList];
            }


            let myCollege = [];
            let pass = [];

            //設置複選框
            let selectedunivnames = [];

            for (let i = 0; i < currentUnivList.length; i++) {
                let cdiv = document.createElement("div");
                let cdiv1 = document.createElement("div");
                let cdiv2 = document.createElement("div");
                cdiv.className = "apply-univcontainer";
                cdiv1.className = "apply-univname";
                cdiv2.className = "apply-univtext";
                cdiv1.textContent = currentUnivList[i].name;
                cdiv2.textContent = currentUnivList[i].text;
                cdiv.appendChild(cdiv1);
                cdiv.appendChild(cdiv2);
                applyContainer.appendChild(cdiv);
                cdiv.addEventListener("click", function () {
                    if (this.classList.contains("done")) {
                        let index = selectedunivnames.indexOf(cdiv1.textContent);
                        if (index !== -1) {
                            selectedunivnames.splice(index, 1);
                        }
                        this.classList.toggle("done");
                        return;
                    }
                    if (selectedunivnames.length >= 3) {
                        alert("最多揀選三所學校");
                        return;
                    }
                    this.classList.toggle("done");
                    selectedunivnames.push(cdiv1.textContent);
                })
            }


            let submitButton = document.createElement("button");
            submitButton.textContent = "確定";
            submitButton.className = "apply-button";

            submitButton.onclick = () => {
                //獲取選擇項
                if (selectedunivnames.length < 3) {
                    alert("請揀選三所學校");
                    return;
                }

                for (let i = 0; i < selectedunivnames.length; i++) {
                    let uv = univList.find(element => element.name === selectedunivnames[i]);
                    myCollege.push(uv);
                }
                if (myCollege.length === 3) {
                    //依次檢查是否被錄取
                    myCollege.sort(function (a, b) {
                        return a.rank - b.rank
                    });
                    for (let j = 0; j < myCollege.length; j++) {
                        let admissionProbability = currentPlayer.intelligence * 4 + myCollege[j].tier * 10 + myCollege[j].rank;
                        let testNumber = getRandomInteger(0, 100);  //獲取0到100間的隨機數
                        if (admissionProbability >= testNumber) {
                            pass.push(myCollege[j]);
                        }
                    }
                    if (pass.length === 0) {
                        currentPlayer.univRank = rankexUniv.rank;
                    } else {
                        currentPlayer.univRank = pass[0].rank;
                    }
                    //省、市狀元不會滑檔
                    if (currentPlayer.intelligence >= 10) {
                        currentPlayer.univRank = myCollege[0].rank;
                    }
                    if ((currentPlayer.intelligence === 9) && (currentPlayer.univRank !== myCollege[0].rank)) {
                        currentPlayer.univRank = myCollege[1].rank;
                    }
                    document.body.removeChild(collegeApplyDiv);
                    collegeApplyDiv = null;
                    setAdmissionLetterPage(currentPlayer.univRank, currentPlayer);
                } else {
                    myCollege = [];
                    pass = [];
                    alert("請揀選三所學校");
                    return;
                }
            }

            collegeApplyDiv.appendChild(applyContainer);
            collegeApplyDiv.appendChild(submitButton);
            document.body.appendChild(collegeApplyDiv);
        }

        window.onload = function () {
            let btn = document.getElementById('startButton');
            btn.disabled = false;
            btn.textContent = '填志願';
            btn.addEventListener("click", setGame);
        };


        //上大學前
        function setGame() {
            // 初始化玩家資訊。尚未實裝的功能用TBD表示。
            //分別是 姓名、性別、家境、心情、體力、精力、智商、眼界、財商、幸運、風險、資金、年級、所上大學排名（初始值100）、專業代碼（初始值0）、學期規劃輪次（用於跟蹤學期規劃決斷次數、期末考試成績基礎隨機下限）、戰鬥力（初始值5）、學期（取值0-8，初始為0）、上學期績點、總績點
            let my = new Player("TBD", "TBD", 0, 100, 100, 100, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 5, 0, 0, 0);
            //通關特典待實裝
            //隨機給出玩家初始屬性。計算通關特典加成。
            initializePlayerBuild(my, giftnone, giftnone);
            //上大學前
            setMajorPage(my);
        }



        //假期頁面
        function setVacationPage(my, div) {

            let title = document.createElement("h3");
            title.textContent = "假期事件";

            let div1 = document.createElement("div");
            let div2 = document.createElement("div");

            let button = document.createElement("button");
            button.textContent = "知道了";

            //根據是否掛科、年級學期等，顯示各假期事件
            if (numCurrentFail > 0 && my.semester != 7 && my.semester != 2) {
                //掛科嘅情況下，顯示複習補考界面
                //第七學期系考研事件，唔能跳過。
                div1.textContent = "補考";
                div2.textContent = "掛科喇，老老實實喺屋企複習補考啦。（極大幅度消耗心情、精力、體力，提升補考通過率。）";
                my.examBase += 10;
                my.strength -= 25;
                my.spirit -= 25;
                my.mood -= 25;
            } else if (my.semester === 1) {
                div1.textContent = "準備四級考試";
                div2.textContent = "下學期可以考英語四級。要想保研，必須通過四級。將來考研、搵工作，通過英語四級都系加分項。利用呢個假期，好好準備啦。（消耗心情、精力、體力，大幅提升四級通過概率。）";
                cetBase = 200;
                my.strength -= 10;
                my.spirit -= 10;
                my.mood -= 10;
            } else if (my.semester === 2) {
                div1.textContent = "四級成績發佈";
                let score = calCetScore(my);
                if (score < 425) {
                    div2.textContent = "大學英語四級滿分710，你考咗" + score.toString() + "分。痛失保研資格。";
                    gradeReport.appendWarning("冇通過四級，失去保研資格！");
                } else {
                    div2.textContent = "大學英語四級滿分710，你考咗" + score.toString() + "分。通過大學英語四級，未來一片光明。";
                    eventRecord.updateDiv("通過了英語四級");
                    flagCet = true;
                }
            } else if (my.semester === 3) {
                div1.textContent = "準備暑期實習";
                div2.textContent = "聽說實習或項目經歷好重要。雖說而家仲系寒假，但凡事要趁早。而家唔提前準備，暑假搵唔到就麻煩喇。（消耗心情、精力、體力，大幅提升搵到實習嘅概率。）";
                my.strength -= 10;
                my.spirit -= 10;
                my.mood -= 10;
                shixiBase = 20;
            } else if (my.semester === 4) {
                div1.textContent = "暑期實習";
                let sx = calShixi(my);
                if (sx === 3) {
                    div2.textContent = "搵到一份非常好嘅實習，從中收穫好多。唔單止能寫進簡歷裏，技能水平都實打實噉提高咗。（極大幅度提升眼界、財商、戰鬥力、智力。）";
                    my.horizon += 5;
                    my.finance += 5;
                    my.intelligence += 5;
                    my.battle += 5;
                    flagShixi = true;
                    eventRecord.updateDiv("實習經歷get");
                } else if (sx === 2) {
                    div2.textContent = "搵到一份實習。辛辛苦苦噉干咗一暑假，累繫纍啲，但確實有收穫。（較大幅度提升眼界、財商，消耗體力。）";
                    my.horizon += 3;
                    my.finance += 3;
                    my.strength -= 10;
                    flagShixi = true;
                    eventRecord.updateDiv("實習經歷get");
                } else if (sx === 1) {
                    div2.textContent = "隻搵到辣雞實習。畀輔導員唬弄去校友嘅黑心企業打白工，干咗一暑假。除咗張廢紙一樣嘅實習證明，乜嘢都冇拿到。（大幅消耗體力。）";
                    my.strength -= 20;
                    flagShixi = true;
                    eventRecord.updateDiv("實習經歷get");
                } else {
                    div2.textContent = "投咗十幾份簡歷出去，全部石沉大海。一份像樣嘅實習都冇搵到。心累。（大幅消耗心情、精力。）";
                    my.mood -= 20;
                    my.spirit -= 20;
                }
            } else if (my.semester === 5) {
                //分考研和保研兩條線
                if (numFailedExam > 0 || !flagCet) {
                    div1.textContent = "複習考研";
                    div2.textContent = "離考研仲有一年，你唔認為自己能堅持落嚟。但周圍同學都開始準備咗，你只好加入考研大軍。（較大幅度消耗體力、心情、精力，提升考研分數。）";
                    my.strength -= 15;
                    my.mood -= 15;
                    my.spirit -= 15;
                    kaoyanBase += 50;
                } else {
                    div1.textContent = "準備保研";
                    div2.textContent = "總之，先把簡歷改靚啲。再到網上搵往年夏令營筆試題，隨手做一做啦。（較大幅度提高智力。）";
                    my.intelligence += 3;
                }
            } else if (my.semester === 6) {
                //同樣，分考研和保研兩條線
                let tgpa = gpaArray2GPA(totalGPAArray);
                if (numFailedExam > 0 || !flagCet) {
                    div1.textContent = "複習考研";
                    div2.textContent = "離考研只剩半年唔到，正系最後衝刺階段。複習效率槓槓嘅。（大幅消耗體力、精力，大幅提升考研分數。）";
                    my.strength -= 20;
                    my.spirit -= 20;
                    kaoyanBase += 150;
                } else if (tgpa > 300) {
                    div1.textContent = "保研夏令營";
                    let by = calBaoYan(my);
                    if (by === 3) {
                        div2.textContent = "參加頂尖名校嘅夏令營，被評為優秀營員！同一堆神仙打架，費盡千辛萬苦脫穎而出，前途一片光明。（大幅消耗精力。）";
                        my.spirit -= 20;
                        eventRecord.updateDiv("提前鎖定名校研究生");
                        flagBaoyan3 = true;
                    } else if (by === 2) {
                        div2.textContent = "參加咗一堆學校嘅保研夏令營，結果只拿到好一般學校嘅優營。點解會噉呢？（大幅降低心情、精力。）";
                        my.spirit -= 20;
                        my.mood -= 20;
                        flagBaoyan2 = true;
                        eventRecord.updateDiv("大概能保研");
                    } else if (by === 1) {
                        div2.textContent = "幾乎全部夏令營都一輪游喇。別人都系等待面試，你筆試被刷直接先回去喇。只有一所好辣雞嘅大學畀你發offer。心態崩喇。";
                        my.mood -= 50;
                        flagBaoyan1 = true;
                        eventRecord.updateDiv("能保研，但不如唔保");
                    } else {
                        div2.textContent = "整個暑假都系外面跑，結果卻顆粒無收，保研全拒得。你感到身心俱疲。";
                        my.mood -= 40;
                        my.strength -= 40;
                        my.spirit -= 40;
                    }
                } else {
                    div1.textContent = "轉投考研";
                    div2.textContent = "績點太低，點睇都拿唔到保研資格。你認清現實，抓緊時間複習考研。而家仲來得及。（大幅消耗體力、精力、心情，較大幅度提高考研分數。）";
                    my.strength -= 20;
                    my.mood -= 20;
                    my.spirit -= 20;
                    kaoyanBase = 100;
                }
            } else {   //第七學期發生最後一個假期事件。
                //保研提前進入結局，呢度只有考研線
                let ky = calKaoYan(my);
                div1.textContent = "考研成績公佈";
                if (ky === 3) {
                    div2.textContent = "初試第一進面，點睇都穩喇。哪怕把老師揍一頓，都照樣能讀研究生。就系咁自信。";
                    eventRecord.updateDiv("考上咗名校研究生");
                    flagKaoYan3 = true;
                    flagKaoYan2 = false;
                    flagKaoYan1 = false;
                    flagKaoshangYan = true;
                } else if (ky === 2) {
                    div2.textContent = "考得比想像中好。早知能考噉高，就報更好嘅學校喇。唉，知足常樂，有書讀總好過冇有。學校差就差點啦。";
                    eventRecord.updateDiv("考上研究生");
                    flagKaoYan2 = true;
                    flagKaoYan3 = false;
                    flagKaoyan1 = false;
                    flagKaoshangYan = true;
                } else if (ky === 1) {
                    div2.textContent = "考研初試冇過線。呢學校好噁心啊，壓分壓得忒狠。只能聯繫調劑喇。（心情大幅降低。）";
                    my.mood -= 20;
                    flagKaoYan1 = true;
                    flagKaoYan3 = false;
                    flagKaoYan2 = false;
                    flagKaoshangYan = false;
                } else {
                    div2.textContent = "總分4開頭，但只有兩位數，聯繫調劑嘅功夫都省咗。你自己都被整笑咗。（恢復心情。）";
                    my.mood += 10;
                    flagKaoYan3 = false;
                    flagKaoYan2 = false;
                    flagKaoYan1 = false;
                    flagKaoshangYan = false;
                }
            }

            statusBanner.updateDiv(my);

            div.className = "vacation-container";
            title.className = "vacation-title";
            div1.className = "vacation-div1";
            div2.className = "vacation-div2";
            button.className = "vacation-button";

            div.appendChild(title);
            div.appendChild(div1);
            div.appendChild(div2);
            div.appendChild(button);

            button.onclick = () => {
                div.removeChild(title);
                div.removeChild(div1);
                div.removeChild(div2);
                div.removeChild(button);
                specialDone = false;
                testEnd(my);
                if (isEnd)
                    return;

                if (my.semester % 2 === 1) {
                    //上半學期，不顯示學年總結。跳轉至下一學期規劃。掛科的情況下，先跳轉補考頁面
                    my.semester++;
                    gradeReport.updateDiv(TBDGPA, my.tgpa, my.major, 0);
                    titleBanner.updateDiv(my);
                    if (numCurrentFail > 0) {
                        //跳轉補考頁
                        examResit.updateDiv();
                        return;
                    } else {
                        //不掛科的情況下，直接跳轉學期規劃。此時因為numCurrentFail必為0，無需再置零
                        my.examBase = 0;
                        schoolTodoList.showPlan(my);
                        return;
                    }
                } else {
                    //跳轉學年總結頁
                    yearReport.updateDiv();
                    return;
                }
                
            }

        }

        //判斷遊戲是否結束

        function testEnd(player) {
            //依次計算心情、體力、精力
            let z = getRandomInteger(15, 100);
            let x = z - player.risk + player.battle + player.luck;
            let mood = player.mood;
            let strength = player.strength;
            let spirit = player.spirit;
            let endflag = 0;

            if (mood < 0 && mood + x < 0) {
                endflag = MOOD_END;
                isEnd = true;
            } else if (strength < 0 && strength + x < 0) {
                endflag = STRENGTH_END;
                isEnd = true;
            } else if (spirit < 0 && spirit + x < 0) {
                endflag = SPIRIT_END;
                isEnd = true;
            } else if (x < 0) {
                if (player.year === 4) {
                    switch (player.major) {
                        case artMajorCode:
                            endflag = ART_END;
                            break;
                        case socialMajorCode:
                            endflag = SOC_END;
                            break;
                        case engineerMajorCode:
                            endflag = ENG_END;
                            break;
                        case scienceMajorCode:
                            endflag = SCI_END;
                            break;
                        case medicalMajorCode:
                            endflag = MED_END;
                            break;
                    }
                } else {
                    endflag = RISK_END;
                }
                isEnd = true;
            }

            setGameover(player, endflag);
            return;
        }

        //顯示結局畫面
        function setGameover(my, endflag) {

            if (endflag === 0) {
                return;
            }

            document.body.innerHTML = githubCorner;

            let mainpage = document.createElement("div");
            mainpage.className = "gameover-page";

            let title = document.createElement("h1");
            let titleContainer = document.createElement("div");
            titleContainer.className = "gameover-title";

            titleContainer.appendChild(title);

            let subtitle = document.createElement("h3");
            let subtitleContainer = document.createElement("div");
            subtitleContainer.appendChild(subtitle);
            subtitleContainer.className = "gameover-subtitle";

            let text = document.createElement("p");
            let textContainer = document.createElement("div");
            textContainer.appendChild(text);
            textContainer.className = "gameover-container";

            let button = document.createElement("button");
            button.textContent = "點我進入結算頁";
            button.className = "gameover-button";

            button.onclick = () => {
                setEnddataPage(my, endflag);
            }

            mainpage.appendChild(titleContainer);
            mainpage.appendChild(subtitleContainer);
            mainpage.appendChild(textContainer);
            mainpage.appendChild(button);

            switch (endflag) {
                case MOOD_END: {
                    subtitle.textContent = "鬱鬱而終";
                    text.textContent = "下輩子對自己好點。多出去散散心，唔好把自己憋壞咗。";
                    title.textContent = "寄！";
                    break;
                }
                case STRENGTH_END: {
                    subtitle.textContent = "過勞死";
                    text.textContent = "居然能活活攰死咗，太強喇！";
                    title.textContent = "寄！";
                    break;
                }
                case SPIRIT_END: {
                    subtitle.textContent = "行屍走肉";
                    text.textContent = "冇精力做任何事喇。看似仲有一口氣，其實早就能埋咗喇。";
                    title.textContent = "寄！";
                    break;
                }
                case RISK_END: {
                    subtitle.textContent = "猝死";
                    text.textContent = "你壞事做盡，被天收咗。真系蒼天有眼。願你下輩子做個好人。";
                    title.textContent = "寄！";
                    break;
                }
                case ART_END: {
                    subtitle.textContent = "頓悟";
                    text.textContent = "臨近畢業，你突然發現眼前嘅一切不過系表象同幻覺。你毅然投入泥頭車嘅懷抱，轉生幻想鄉。";
                    title.textContent = "寄！";
                    break;
                }
                case SOC_END: {
                    subtitle.textContent = "提籃橋進修";
                    text.textContent = "大家都系度做假賬，偏偏就你畀抓咗。可能系敗人品嘅事做多咗？願你下輩子做個好人。";
                    title.textContent = "寄！";
                    break;
                }
                case ENG_END: {
                    subtitle.textContent = "背鍋俠";
                    text.textContent = "“你系安全員，唔抓你抓邊個？”“靠，我TM負責嘅系資訊安全！”";
                    title.textContent = "寄！";
                    break;
                }
                case SCI_END: {
                    subtitle.textContent = "實驗室爆炸";
                    text.textContent = "“師兄，呢個燒杯喺冒泡誒。”“啊？”";
                    title.textContent = "寄！";
                    break;
                }
                case MED_END: {
                    subtitle.textContent = "醫鬧";
                    text.textContent = "“庸醫，受死啦！”“我只不過系路過嘅實習生，你唔好過嚟啊。”";
                    title.textContent = "寄！";
                    break;
                }
                case GUAKE_END: {
                    subtitle.textContent = "退學通知書";
                    text.textContent = "你補考後仍有五門或以上課程唔合格。根據我校學生管理規定，對你做退學處理。就算你有異議，都唔允許申訴。（教務處）";
                    title.textContent = "寄！";
                    break;
                }
                case PERFECT_END: {
                    subtitle.textContent = "圓滿落幕";
                    text.textContent = "考研工作兩手抓。既拿到名校嘅研究生offer，又能進大廠。人生跟開咗掛一樣。";
                    title.textContent = "完美通關";
                    break;
                }
                case BAOYAN_END: {
                    subtitle.textContent = "保送研究生";
                    text.textContent = "三年嘅努力有咗回報。以夢為馬，不負韶華。";
                    title.textContent = "未來可期";
                    break;
                }
                case KAOYAN_END: {
                    subtitle.textContent = "考上研究生";
                    text.textContent = "順利從大學畢業，下學期繼續讀研究生。真系可喜可賀。";
                    title.textContent = "未來可期";
                    break;
                }
                case GONGZUO3_END:
                case GONGZUO2_END:
                    subtitle.textContent = "搵到工作";
                    text.textContent = "畢業後有地方去喇，正式成為社會人。";
                    title.textContent = "未來可期";
                    break;
                case BIYE_SHIYE_END: {
                    subtitle.textContent = "畢業即失業";
                    text.textContent = "大學四年順利度過，但之後只能當家裏蹲喇。";
                    title.textContent = "未來可寄";
                    break;
                }
                case GONGZUO1_END: {
                    subtitle.textContent = "黑作坊牛馬";
                    text.textContent = "不如高中直接進廠，少走四年彎路。";
                    title.textContent = "生不如死";
                    break;
                }
                case DANBIYE_END: {
                    subtitle.textContent = "單證戰士";
                    text.textContent = "畢業喇，但冇完全畢業。其實……學位證冇咁重要？";
                    title.textContent = "未來可寄";
                    break;
                }
                case JIEYE_END: {
                    subtitle.textContent = "大學結業";
                    text.textContent = "甚至冇能畢業。說好嘅大學寬進嚴出呢？";
                    title.textContent = "未來可寄";
                    break;
                }
                case XSH_END: {
                    subtitle.textContent = "學生會長";
                    text.textContent = "成為咗呢所學校嘅最高權力者。已經別無所求喇。";
                    title.textContent = "隱藏結局";
                    break;
                }
                case GGZ_END: {
                    subtitle.textContent = "沉迷頁游";
                    text.textContent = "氪到全服第一，強大無需多言。";
                    title.textContent = "隱藏結局";
                    break;
                }
                case NOBEL_END: {
                    subtitle.textContent = "諾獎得主";
                    text.textContent = "成為第一個諾貝爾數學獎得主。你就系創造歷史嘅人！";
                    title.textContent = "隱藏結局";
                    break;
                }
            }
            document.body.appendChild(mainpage);



        }




        function setEnddataPage(player, endflag) {

            document.body.innerHTML = githubCorner;

            let fflag = endflag;
            if (endflag === BAOYAN_END) {
                if (flagBaoyan3) {
                    fflag = BAOYAN3_END;
                } else if (flagBaoyan2) {
                    fflag = BAOYAN2_END;
                } else if (flagBaoyan1) {
                    fflag = BAOYAN1_END;
                }
            }
            if (endflag === KAOYAN_END) {
                if (flagKaoYan3) {
                    fflag = KAOYAN3_END;
                } else if (flagKaoYan2) {
                    fflag = KAOYAN2_END;
                } else if (flagKaoYan1) {
                    fflag = KAOYAN1_END;
                }
            }
            let rank = end2rank(fflag);  //獲得結局的評價等級


            let mainpage = document.createElement("div");

            let title = document.createElement("h1");
            title.textContent = "結算頁";

            let container = document.createElement("div");

            let button = document.createElement("button");
            button.textContent = "選擇通關特典";

            let endrankdiv = endRecordDiv(rank);

            let scorelist = document.createElement("ul");

            let wealthLi = document.createElement("li");
            let univLi = document.createElement("li");
            let intelligenceLi = document.createElement("li");
            let horizonLi = document.createElement("li");
            let financeLi = document.createElement("li");
            let battleLi = document.createElement("li");
            let endLi = document.createElement("li");

            scorelist.appendChild(wealthLi);
            scorelist.appendChild(univLi);
            scorelist.appendChild(intelligenceLi);
            scorelist.appendChild(horizonLi);
            scorelist.appendChild(financeLi);
            scorelist.appendChild(battleLi);
            scorelist.appendChild(endLi);
            container.appendChild(scorelist);


            let wealthspan = wealth2RatingSpan(player.wealth);
            wealthLi.appendChild(wealthspan);
            let univspan = univ2RatingSpan(player.univRank);
            univLi.appendChild(univspan);
            let intelspan = inte2RatingSpan(player.intelligence, endflag);
            intelligenceLi.appendChild(intelspan);
            let horspan = hor2RatingSpan(player.horizon);
            horizonLi.appendChild(horspan);
            let finspan = fin2RatingSpan(player.finance);
            financeLi.appendChild(finspan);
            let battlespan = battle2RatingSpan(player.battle);
            battleLi.appendChild(battlespan);
            let endspan = end2RatingSpan(endflag);
            endLi.appendChild(endspan);



            mainpage.appendChild(title);
            mainpage.appendChild(container);

            mainpage.appendChild(endrankdiv);
            mainpage.appendChild(button);

            mainpage.className = "enddata-page";
            title.className = "enddata-title";
            container.className = "enddata-container";
            endrankdiv.className = "enddata-rankdiv";
            button.className = "enddata-button";

            button.onclick = () => {
                //選擇通關特典重開
                if (rank >= bestRecord) {
                    bestRecord = rank;
                }
                setGiftPage(bestRecord);
            }

            document.body.appendChild(mainpage);


        }







        //通關特典

        function setGiftPage(rank) {
            //根據上一輪結局評價，給予部分通關特典
            let maindiv = document.createElement("div");
            maindiv.className = "gift-page";

            let title = document.createElement("h2");
            title.textContent = "選擇一項通關特典";
            title.className = "gift-title";
            if (rank >= A_END_RANK) {
                title.textContent = "歷史最高評價達到A以上，可以選擇兩項特典";
            }

            let button = document.createElement("button");
            button.className = "gift-button";
            button.textContent = "繼承通關特典，再來一局！";
            let giftcontainer = document.createElement("div");
            giftcontainer.className = "gift-container";

            let currentGiftlist = ["one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten"];
            let currentGiftDess = ["ich", "ni", "sann", "shi", "go", "roku", "nana", "hachi", "kyuu", "jyuu"];

            switch (rank) {
                case S_END_RANK: {
                    currentGiftlist = SrankGiftTexts;
                    currentGiftDess = SrankGiftDess;
                    break;
                }
                case A_END_RANK: {
                    currentGiftlist = ArankGiftTexts;
                    currentGiftDess = ArankGiftDess;
                    break;
                }
                case B_END_RANK: {
                    currentGiftlist = BrankGiftTexts;
                    currentGiftDess = BrankGiftDess;
                    break;
                }
                case C_END_RANK: {
                    currentGiftlist = CrankGiftTexts;
                    currentGiftDess = CrankGiftDess;
                    break;
                }
                case D_END_RANK: {
                    currentGiftlist = DrankGiftTexts;
                    currentGiftDess = DrankGiftDess;
                    break;
                }
                default: {
                    currentGiftlist = ErankGiftTexts;
                    currentGiftDess = ErankGiftDess;
                    break;
                }
            }

            let selectedgifts = [];

            for (let i = 0; i < currentGiftlist.length; i++) {
                let gdiv = document.createElement("div");
                let span1 = document.createElement("span");
                let span2 = document.createElement("span");
                gdiv.className = "gift-item";
                gdiv.appendChild(span1);
                gdiv.appendChild(span2);
                span1.textContent = currentGiftlist[i];
                span1.className = gift2SpanClassname(currentGiftlist[i]);
                span2.textContent = currentGiftDess[i];

                gdiv.addEventListener("click", function () {
                    if (span1.textContent === giftLowrank) {
                        return;
                    }
                    if (this.classList.contains("done")) {
                        let index = selectedgifts.indexOf(span1.textContent);
                        if (index !== -1) {
                            selectedgifts.splice(index, 1);
                        }
                        this.classList.toggle("done");
                        return;
                    }
                    if (selectedgifts.length >= 2) {
                        alert("最多選擇兩項特典");
                        return;
                    }
                    if (selectedgifts.length >= 1 && rank < A_END_RANK) {
                        alert("最多選擇一項特典");
                        return;
                    }
                    this.classList.toggle("done");
                    selectedgifts.push(span1.textContent);
                })
                giftcontainer.appendChild(gdiv);
            }


            button.onclick = () => {
                if (selectedgifts.length < 2 && rank >= A_END_RANK) {
                    alert("歷史最佳達到A以上，請選擇兩項特典");
                    return;
                }
                if (selectedgifts.length < 1) {
                    alert("請選擇一項特典");
                    return;
                }
                if (selectedgifts.length === 1) {
                    resetGame(selectedgifts[0], giftnone);
                }
                if (selectedgifts.length === 2) {
                    resetGame(selectedgifts[0], selectedgifts[1]);
                }
            }



            maindiv.appendChild(title);
            maindiv.appendChild(giftcontainer);
            maindiv.appendChild(button);

            document.body.innerHTML = "";
            //document.body.innerHTML = githubCorner;
            document.body.appendChild(maindiv);

        }


        //重置遊戲
        function resetGame(giftstring1, giftstring2) {
            //初始化與遊戲進度相關的全局變量

            flagPinKunBuZhu = false;  //貧困補助
            flagXueShengHui = false; //學生會
            flagGuGuZhen = false;   //氪金頁游
            flagNobel = false;    //諾獎相關事件
            eventPhase = 0;     //記錄各事件進展階段

            cetBase = 0;  //通過英語四級的基數
            shixiBase = 0;  //找到實習的基數
            flagCet = false;  //標誌是否通過四級
            flagShixi = false;  //標誌是否有實習經歷
            flagRongYu = false;  //判斷是否有（校級）榮譽

            numFailedExam = 0;  //表示掛過多少科
            numCurrentFail = 0;  //這學期多少門考試沒通過
            flagJuanWang = false;  //與通關特典有關
            totalGPAArray = [];  //數組，用於儲存考試成績。元素是0-400的績點，不是百分製成績。

            specialDone = false;  //用於判斷當前學期，是否已發生特殊事件
            jobpageDone = false; //用於表示第四年的求職計劃頁是否已顯示
            flagQiuzhi = false;  //判斷玩家是否投簡歷出去
            globalVocDivPointer = null;  //用來傳參的一個全局指針，沒實際含義
            flagGradeWarning = false;  //判斷是否觸發過學業警告，目前還沒用到

            kaoyanBase = 0;  //考研分基數
            lunwenBase = 0;   //畢業論文基數
            flagBaoyan3 = false; //名校保研
            flagBaoyan2 = false;  //一般學校保研
            flagBaoyan1 = false;  //辣雞學校保研
            flagKaoYan3 = false; //名校考研
            flagKaoYan2 = false; //一般校考研
            flagKaoYan1 = false;  //一志願考研失敗

            flagBaoyanEnd = false;
            flagKaoshangYan = false;  //考上研
            flagGongzuo3 = false;  //好工作
            flagGongzuo2 = false; //一般的工作
            flagGongzuo1 = false; //爛工作
            flagXuewei = false;  //畢業證+學位證
            flagDanbiye = false;  //單畢業證
            flagJieye = false;  //結業
            isEnd = false;  //非正常死亡


            // 初始化玩家資訊。尚未實裝的功能用TBD表示。
            //分別是 姓名、性別、家境、心情、體力、精力、智商、眼界、財商、幸運、風險、資金、年級、所上大學排名（初始值100）、專業代碼（初始值0）、學期規劃輪次（用於跟蹤學期規劃決斷次數、期末考試成績基礎隨機下限）、戰鬥力（初始值5）、學期（取值0-8，初始為0）、上學期績點、總績點
            let my = new Player("TBD", "TBD", 0, 100, 100, 100, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 5, 0, 0, 0);
            //通關特典
            //隨機給出玩家初始屬性。計算通關特典加成。
            initializePlayerBuild(my, giftstring1, giftstring2);
            //上大學前
            setMajorPage(my);
        }

        const githubCorner = `<a href="https://github.com/lingch16/UnivSimulator" target="_blank" class="github-corner" title="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#333; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
        </a>`
    </script>
</body>

</html>