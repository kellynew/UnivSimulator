<!DOCTYPE html>
<html lang="zh-cmn">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script>//部分数值不在游戏中使用


        const TBDGPA = 999;   //每到新学期，将总成绩单里的当前学期绩点改为--
        //绩点相关数据
        const A = 0;
        const ALLimit = 90;
        const Aminus = 1;
        const AminusLLimit = 85;
        const Bplus = 2;
        const BplusLLimit = 82;
        const B = 3;
        const BLLimit = 78;
        const Bminus = 4;
        const BminusLLimit = 75;
        const Cplus = 5;
        const CplusLLimit = 71;
        const C = 6;
        const CLLimit = 66;
        const Cminus = 7;
        const CminusLLimit = 62;
        const D = 8;
        const DLLimit = 60;
        const Dminus = 9;
        const F = 10;
        const gradeNumber = 11;
        //从A到F，共11个成绩等级

        //专业相关

        //人文大类
        const ART_MAJOR = 11;  //专业代码
        const ART_NUM = 6;  //每学期课程数
        const ART_DIFF = 10;  //难度系数，难度系数越大，期末考越简单。难度系数可以取正值，也可以取负值。
        const artMajorCode = 11;  //专业代码
        const artMajorText = "人文类专业";  //专业名称
        const artMajorCourseNum = 6;  //每学期课程数
        const artTotalCourseNum = 46;  //大二、大三，每学期多一门课。即 6x8+4=52，大四下学期写毕业论文，没课。再减掉6是46。
        //社科大类
        const SOCIAL_MAJOR = 22;
        const SOCIAL_NUM = 7;
        const SOCIAL_DIFF = 5;
        const socialMajorCode = 22;
        const socialMajorText = "经管法等社科专业";
        const socialMajorCourseNum = 7;
        const socialTotalCourseNum = 53;
        //工科大类
        const ENGINEER_MAJOR = 33;
        const ENGINEER_NUM = 7;
        const ENGINEER_DIFF = 0;
        const engineerMajorCode = 33;
        const engineerMajorText = "新工科类专业";
        const engineerMajorCourseNum = 7;
        const engineerTotalCourseNum = 53;
        //理科大类
        const SCIENCE_MAJOR = 44;
        const SCIENCE_NUM = 5;
        const SCIENCE_DIFF = -10;
        const scienceMajorCode = 44;
        const scienceMajorText = "基础科学";
        const scienceMajorCourseNum = 5;
        const scienceTotalCourseNum = 39;
        //医科大类
        const MEDICAL_MAJOR = 55;
        const MEDICAL_NUM = 8;
        const MEDICAL_DIFF = -15;    //计划修改此处数值，怎么改还没想好
        const medicalMajorCode = 55;
        const medicalMajorText = "医科专业";
        const medicalMajorCourseNum = 8;
        const medicalTotalCourseNum = 60;


        //不同等级的学期规划限制
        const MONEY_M_LIMIT = 1000;
        const MONEY_H_LIMIT = 2000;
        const MONEY_EX_LIMIT = 10000;
        const HORIZON_M_LIMIT = 6;
        const HORIZON_H_LIMIT = 13;
        const HORIZON_EX_LIMIT = 24;

        //特殊事件代码。不同事件的代码应区分开。
        //一部分代码不以CODE开头，但也是事件代码。彼此取值不能重复。
        const CODE_PIN_KUN = 1234;
        const CODE_XUE_SHENG_HUI = 2345;
        const CODE_GU_GU = 3456;
        const CODE_NOBEL = 4567;
        const CODE_GUOJIANG = 5678;
        const CODE_LIZHI = 5578;
        const CODE_GONGZUO = 2222;
        const BAOYAN_GOOD = 6789;
        const BAOYAN_BAD = 9876;
        const TIAOJI_GOOD = 3344;
        const TIAOJI_BAD = 4433;
        const CODE_XSH1 = 23451;
        const CODE_XSH2 = 23452;
        const CODE_XSH3 = 23453;
        const CODE_GGZ1 = 34567;
        const CODE_GGZ2 = 34568;
        const CODE_GGZ3 = 34569;
        const CODE_NOBEL1 = 45671;
        const CODE_NOBEL2 = 45672;
        const CODE_NOBEL3 = 45673;

        //一些事件的绩点、战力、智力限制
        const GUOJIANG_LIMIT = 370; //拿国奖的gpa下限
        const LIZHI_LIMIT = 330;    //拿励志的gpa下限
        const XUEYE_LIMIT = 300;    //学业奖学金gpa下限
        const P1_BATTLE_LIMIT = 10; //第一阶段事件 战力要求
        const P2_BATTLE_LIMIT = 15;
        const P3_BATTLE_LIMIT = 22;
        const P1_IQ_LIMIT = 15;
        const P2_IQ_LIMIT = 12;
        const P3_IQ_LIMIT = 9;



        //通关特典
        const giftnone = "占位符";
        const giftLowrank = "提升通关评价，解锁更多特典";
        const giftemptystr = "";
        //E评价
        const GIFT_E_RANK = 5;
        const giftAttr1 = "铁树枝干";
        const giftAttr1des = "（全属性随机下限+2）";
        const giftLuck1 = "幸运挂饰";
        const giftLuck1des = "(幸运值+2）";
        const giftBattle1 = "玩具拳套";
        const giftBattle1des = "（战斗力+2）";
        const ErankGiftTexts = [giftAttr1, giftLuck1, giftBattle1, giftLowrank, giftLowrank, giftLowrank, giftLowrank, giftLowrank, giftLowrank, giftLowrank];
        const ErankGiftDess = [giftAttr1des, giftLuck1des, giftBattle1des, giftemptystr, giftemptystr, giftemptystr, giftemptystr, giftemptystr, giftemptystr, giftemptystr];
        //D评价
        const GIFT_D_RANK = 6;
        const giftInt1 = "智力斗篷";
        const giftInt1des = "（智力随机下限+6）";
        const giftHor1 = "望远镜";
        const giftHor1des = "（眼界随机下限+6）";
        const giftFin1 = "资本家手杖";
        const giftFin1des = "（财商随机下限+6）";
        const giftWea1 = "全面脱贫";
        const giftWea1des = "（家境随机下限+6）";
        const DrankGiftTexts = [giftAttr1, giftLuck1, giftBattle1, giftInt1, giftHor1, giftFin1, giftWea1, giftLowrank, giftLowrank, giftLowrank];
        const DrankGiftDess = [giftAttr1des, giftLuck1des, giftBattle1des, giftInt1des, giftHor1des, giftFin1des, giftWea1des, giftemptystr, giftemptystr, giftemptystr];
        //C评价
        const GIFT_C_RANK = 7;
        const giftAttr2 = "贵族圆环";
        const giftAttr2des = "（全属性随机下限+4）";
        const giftLuck2 = "空灵吊坠";
        const giftLuck2des = "（幸运值+5）";
        const giftBattle2 = "攻击之爪";
        const giftBattle2des = "（战斗力+5）";
        const CrankGiftTexts = [giftAttr1, giftLuck1, giftBattle1, giftInt1, giftHor1, giftFin1, giftWea1, giftAttr2, giftLuck2, giftBattle2];
        const CrankGiftDess = [giftAttr1des, giftLuck1des, giftBattle1des, giftInt1des, giftHor1des, giftFin1des, giftWea1des, giftAttr2des, giftLuck2des, giftBattle2des];
        //B评价
        const GIFT_B_RANK = 8;
        const giftWeaex = "地主家的傻儿子";
        const giftWeaexdes = "（家境拉满、战斗力+5，智力随机上限-8）";
        const giftMoney = "暴发户";
        const giftMoneydes = "（家境贫困，但开局金钱+25000）";
        const giftExam = "卷王";
        const giftExamdes = "（大幅提升期末考试成绩）";
        const BrankGiftTexts = [giftInt1, giftHor1, giftFin1, giftWea1, giftAttr2, giftLuck2, giftBattle2, giftWeaex, giftMoney, giftExam];
        const BrankGiftDess = [giftInt1des, giftHor1des, giftFin1des, giftWea1des, giftAttr2des, giftLuck2des, giftBattle2des, giftWeaexdes, giftMoneydes, giftExamdes];
        //A评价
        const GIFT_A_RANK = 9;
        const giftAttr3 = "国王头冠";
        const giftAttr3des = "（全属性随机下限+6）";
        const ArankGiftTexts = [giftInt1, giftHor1, giftFin1, giftAttr2, giftLuck2, giftBattle2, giftWeaex, giftMoney, giftExam, giftAttr3];
        const ArankGiftDess = [giftInt1des, giftHor1des, giftFin1des, giftAttr2des, giftLuck2des, giftBattle2des, giftWeaexdes, giftMoneydes, giftExamdes, giftAttr3des];
        //S评价
        const GIFT_S_RANK = 10;
        const giftExceed = "超越极限";
        const giftExceeddes = "（全属性随机上限+7）";
        const giftLuck3 = "幸运女神的庇佑";
        const giftLuck3des = "（幸运值+12）";
        const SrankGiftTexts = [giftHor1, giftAttr2, giftLuck2, giftBattle2, giftWeaex, giftMoney, giftExam, giftAttr3, giftExceed, giftLuck3];
        const SrankGiftDess = [giftHor1des, giftAttr2des, giftLuck2des, giftBattle2des, giftWeaexdes, giftMoneydes, giftExamdes, giftAttr3des, giftExceeddes, giftLuck3des];

        //结局的评价等级
        const S_END_RANK = 10;
        const A_END_RANK = 9;
        const B_END_RANK = 8;
        const C_END_RANK = 7;
        const D_END_RANK = 6;
        const E_END_RANK = 5;

        //结局代码。所有以END结尾的，数值要区分开，不能重复
        const MOOD_END = 333;
        const STRENGTH_END = 444;
        const SPIRIT_END = 555;
        const RISK_END = 666;
        const GUAKE_END = 777;
        const BAOYAN_END = 888;
        const KAOYAN_END = 222;
        const BAOYAN1_END = 8881;
        const BAOYAN2_END = 8882;
        const BAOYAN3_END = 8883;
        const KAOYAN1_END = 2221;
        const KAOYAN2_END = 2222;
        const KAOYAN3_END = 2223;
        const BIYE_SHIYE_END = 12; //毕业即失业，要求双证齐全且没有工作、没有学上
        const GONGZUO3_END = 23;
        const GONGZUO2_END = 22;
        const GONGZUO1_END = 21;
        const PERFECT_END = 1333; //考研3+工作3
        const DANBIYE_END = 1434; //单毕业证、没工作
        const JIEYE_END = 1444;  //结业
        const XSH_END = 1354;
        const GGZ_END = 1453;
        const NOBEL_END = 4513;
        //各专业坏结局
        const ART_END = 3412;
        const SOC_END = 3413;
        const ENG_END = 3414;
        const SCI_END = 3415;
        const MED_END = 3416;




        //记录一些全局变量。
        //这里的变量基本都用来储存单局数据，或作某些重要事件的判断。开始新一局游戏时，应重置它们的值。

        //特殊事件flag
        let flagPinKunBuZhu = false;  //贫困补助
        let flagXueShengHui = false; //学生会
        let flagGuGuZhen = false;   //氪金页游
        let flagNobel = false;    //诺奖相关事件
        let eventPhase = 0;     //记录各事件进展阶段

        //假期事件相关
        let cetBase = 0;  //通过英语四级的基数
        let shixiBase = 0;  //找到实习的基数
        let flagCet = false;  //标志是否通过四级
        let flagShixi = false;  //标志是否有实习经历
        let flagRongYu = false;  //判断是否有（校级）荣誉

        //期末考试相关
        let numFailedExam = 0;  //表示挂过多少科
        let numCurrentFail = 0;  //这学期多少门考试没通过
        let flagJuanWang = false;  //与通关特典有关
        let totalGPAArray = [];  //数组，用于储存考试成绩。元素是0-400的绩点，不是百分制成绩。

        //常规流程控制
        let specialDone = false;  //用于判断当前学期，是否已发生特殊事件
        let jobpageDone = false; //用于表示第四年的求职计划页是否已显示
        let flagQiuzhi = false;  //判断玩家是否投简历出去
        let globalVocDivPointer = null;  //用来传参的一个全局指针，没实际含义
        let flagGradeWarning = false;  //判断是否触发过学业警告，目前还没用到

        //考研、毕业论文通过率计算
        let kaoyanBase = 0;  //考研分基数
        let lunwenBase = 0;   //毕业论文基数
        let flagBaoyan3 = false; //名校保研
        let flagBaoyan2 = false;  //一般学校保研
        let flagBaoyan1 = false;  //辣鸡学校保研
        let flagKaoYan3 = false; //名校考研
        let flagKaoYan2 = false; //一般校考研
        let flagKaoYan1 = false;  //一志愿考研失败

        //结局相关flag
        let flagBaoyanEnd = false;
        let flagKaoshangYan = false;  //考上研
        let flagGongzuo3 = false;  //好工作
        let flagGongzuo2 = false; //一般的工作
        let flagGongzuo1 = false; //烂工作
        let flagXuewei = false;  //毕业证+学位证
        let flagDanbiye = false;  //单毕业证
        let flagJieye = false;  //结业
        let isEnd = false;  //非正常死亡




        //历史最佳记录
        //!!!!跨局保存，开始新游戏时不置零。
        let bestRecord = 0;  
    </script>
    <script>//大学相关

        class Univ {
            constructor(name, text, rank, tier, intelligence, horizon, finance, risk, pressure, fee, majorCode, exbuild) {
                this.name = name;   //大学校名
                this.text = text;   //大学描述
                this.rank = rank;   //大学排名
                this.tier = tier;   //大学梯队
                this.intelligence = intelligence;   //学年结束时对智力的加成
                this.horizon = horizon;          //学年结束时对眼界的加成
                this.finance = finance;           //学年结束时对财商的加成
                this.risk = risk;             //学年结束时增加风险度
                this.pressure = pressure;     //内卷度，与期末考相关
                this.fee = fee;               //大学学费
                this.majorCode = majorCode;   //大学特色专业
                this.exbuild = exbuild;       //大学特色加成
            }
            //不同档次学校给玩家不同加成，每年年底计算一次。
            update(currentPlayer) {
                currentPlayer.intelligence += this.intelligence;
                currentPlayer.horizon += this.horizon;
                currentPlayer.finance += this.finance;
                currentPlayer.risk += this.risk;
                //大学特色加成
                //如果玩家选择该校特色专业，则享受加成
                if (this.majorCode === currentPlayer.major) {
                    currentPlayer.intelligence += this.exbuild;
                    currentPlayer.horizon += this.exbuild;
                    currentPlayer.finance += this.exbuild;
                }
            }
        }

        const rank1Univ = new Univ("北京的大学", "简称北大，各项指标都很强劲。大学里的最强王者。", 1, 0, 4, 4, 4, 2, 5, 6000, 0, 0);
        const rank2Univ = new Univ("上海的大学", "沪滨屹立东南冠，实力不容小觑。", 2, 1, 3, 4, 4, 2, 4, 6500, 0, 0);
        const rank3Univ = new Univ("浙江的大学", "简称浙大，top3大学，省内巨无霸。", 3, 1, 4, 3, 4, 3, 4, 6500, 0, 0);
        const rank4Univ = new Univ("南京的大学", "简称南大，学风正，当之无愧的第一梯队。", 4, 1, 4, 3, 3, 3, 4, 6000, 0, 0);
        const rank5Univ = new Univ("某财经大学", "社科类专业实力强劲。", 5, 2, 2, 3, 3, 2, 3, 8000, socialMajorCode, 1);
        const rank6Univ = new Univ("某科技大学", "只有科学没有技术，理科实力强劲。", 6, 2, 3, 2, 2, 3, 4, 6500, scienceMajorCode, 1);
        const rank7Univ = new Univ("某医科大学", "学校的附属医院近期成功晋升三甲综合医院。", 7, 2, 3, 2, 1, 3, 4, 6500, medicalMajorCode, 1);
        const rank8Univ = new Univ("某师范大学", "学校优先发展纯文科，人文大类是业界翘楚。", 8, 2, 2, 2, 2, 2, 3, 7000, artMajorCode, 1);
        const rank9Univ = new Univ("某工业大学", "学校以工科起家，近期在向新工科转型。", 9, 2, 2, 2, 2, 3, 4, 7000, engineerMajorCode, 1);
        const rank10Univ = new Univ("中等偏上的大学", "比较均衡，学费也是中等偏上的。", 10, 3, 2, 2, 2, 2, 2, 8000, 0, 0);
        const rank11Univ = new Univ("某考研神校", "只要学不死，就往死里学。", 11, 3, 3, 1, 1, 4, 3, 7500, 0, 0);
        const rank12Univ = new Univ("坐落在大城市的大学", "唯一的优点是眼界开阔些。", 12, 3, 1, 2, 1, 2, 2, 8500, 0, 0);
        const rank13Univ = new Univ("普通的大学", "能力只有平均值的渣渣，学费却不便宜。", 13, 4, 1, 1, 1, 1, 1, 9000, 0, 0);
        const rankexUniv = new Univ("辣鸡大学", "不如不上的烂学校", 20, 5, 0, 0, 0, 1, 0, 10000, 0, 0);

        const goodUniv = [rank1Univ, rank2Univ, rank3Univ, rank4Univ];
        const fairUniv = [rank5Univ, rank6Univ, rank7Univ, rank8Univ, rank9Univ];
        const poorUniv = [rank10Univ, rank11Univ, rank12Univ, rank13Univ];
        //为防止未知bug出现，把以上数组复制一遍
        const goodUnivList = [rank1Univ, rank2Univ, rank3Univ, rank4Univ];
        const fairUnivList = [rank5Univ, rank6Univ, rank7Univ, rank8Univ, rank9Univ];
        const poorUnivList = [rank10Univ, rank11Univ, rank12Univ, rank13Univ];

        const univList = [rank1Univ, rank2Univ, rank3Univ, rank4Univ, rank5Univ, rank6Univ, rank7Univ, rank8Univ, rank9Univ, rank10Univ, rank11Univ, rank12Univ, rank13Univ, rankexUniv];


    </script>
    <script>//状态栏

        const statusBanner = {
            strengthSpan: document.createElement("span"),
            moodSpan: document.createElement("span"),
            spiritSpan: document.createElement("span"),
            intelligenceSpan: document.createElement("span"),
            horizonSpan: document.createElement("span"),
            moneySpan: document.createElement("span"),
            strspan1: document.createElement("span"),
            strspan2: document.createElement("span"),
            moospan1: document.createElement("span"),
            moospan2: document.createElement("span"),
            spispan1: document.createElement("span"),
            spispan2: document.createElement("span"),
            intspan1: document.createElement("span"),
            intspan2: document.createElement("span"),
            horspan1: document.createElement("span"),
            horspan2: document.createElement("span"),
            monspan1: document.createElement("span"),
            monspan2: document.createElement("span"),
            strT: "体力：",
            mooT: "心情：",
            spiT: "精力：",
            intT: "智力：",
            horT: "眼界：",
            monT: "金钱：",
            createDiv: function (player) {
                //初始化
                this.strspan1.textContent = this.strT;
                this.moospan1.textContent = this.mooT;
                this.spispan1.textContent = this.spiT;
                this.intspan1.textContent = this.intT;
                this.horspan1.textContent = this.horT;
                this.monspan1.textContent = this.monT;

                this.strspan2.textContent = player.strength.toString();
                this.moospan2.textContent = player.mood.toString();
                this.spispan2.textContent = player.spirit.toString();
                this.intspan2.textContent = "***";
                this.horspan2.textContent = "***";
                this.monspan2.textContent = player.money.toString();

                this.strengthSpan.appendChild(this.strspan1);
                this.strengthSpan.appendChild(this.strspan2);
                this.moodSpan.appendChild(this.moospan1);
                this.moodSpan.appendChild(this.moospan2);
                this.spiritSpan.appendChild(this.spispan1);
                this.spiritSpan.appendChild(this.spispan2);
                this.intelligenceSpan.appendChild(this.intspan1);
                this.intelligenceSpan.appendChild(this.intspan2);
                this.horizonSpan.appendChild(this.horspan1);
                this.horizonSpan.appendChild(this.horspan2);
                this.moneySpan.appendChild(this.monspan1);
                this.moneySpan.appendChild(this.monspan2);

                this.strengthSpan.className = "status-span";
                this.moodSpan.className = "status-span";
                this.spiritSpan.className = "status-span";
                this.intelligenceSpan.className = "status-span";
                this.horizonSpan.className = "status-span";
                this.moneySpan.className = "status-span";

                let div = document.createElement("div");
                div.appendChild(this.strengthSpan);
                div.appendChild(this.moodSpan);
                div.appendChild(this.spiritSpan);
                div.appendChild(this.intelligenceSpan);
                div.appendChild(this.horizonSpan);
                div.appendChild(this.moneySpan);
                div.className = "statusBar";

                this.strspan2.className = "plain-status-span";
                this.moospan2.className = "plain-status-span";
                this.spispan2.className = "plain-status-span";
                this.intspan2.className = "plain-status-span";
                this.horspan2.className = "plain-status-span";
                this.monspan2.className = "plain-status-span";

                return div;
            },
            updateDiv: function (player) {
                this.strspan2.textContent = player.strength.toString();
                this.moospan2.textContent = player.mood.toString();
                this.spispan2.textContent = player.spirit.toString();
                this.monspan2.textContent = player.money.toString();
                if (player.strength < 10) {
                    this.strspan2.className = "warning-status-span";
                } else {
                    this.strspan2.className = "plain-status-span";
                }
                if (player.mood < 10) {
                    this.moospan2.className = "warning-status-span";
                } else {
                    this.moospan2.className = "plain-status-span";
                }
                if (player.spirit < 10) {
                    this.spispan2.className = "warning-status-span";
                } else {
                    this.spispan2.className = "plain-status-span";
                }
                if (player.money < 500) {
                    this.monspan2.className = "warning-status-span";
                } else {
                    this.monspan2.className = "plain-status-span";
                }
                //达到一定条件时，显示智力、眼界数值
                if (player.intelligence > 10 && player.horizon > 15) {
                    this.intspan2.textContent = player.intelligence.toString();
                } else {
                    this.intspan2.textContent = "***";
                }
                if (player.intelligence > 5 && player.horizon > 20) {
                    this.horspan2.textContent = player.horizon.toString();
                } else {
                    this.horspan2.textContent = "***";
                }

            }
        }

    </script>
    <script>//学期规划、特殊事件

        //学期规划
        class schoolPlan {
            constructor(text, description, moneyCost, moodCost, strengthCost, spiritCost, intelligenceBonus, horizonBonus, financeBonus, examBase, battle, risk, luck) {
                this.text = text;
                this.description = description;
                this.moneyCost = moneyCost;
                this.moodCost = moodCost;
                this.strengthCost = strengthCost;
                this.spiritCost = spiritCost;
                this.intelligenceBonus = intelligenceBonus;
                this.horizonBonus = horizonBonus;
                this.financeBonus = financeBonus;
                this.examBase = examBase;
                this.battle = battle;
                this.risk = risk;
                this.luck = luck;
            }

            //根据具体事件，消耗或恢复体力、心情、体力等
            //统一用加法。消耗体力的事件，事件中strength用负数表示。
            updateAttr(player) {
                player.mood += this.moodCost;
                player.spirit += this.spiritCost;
                player.strength += this.strengthCost;
                player.money += this.moneyCost;
                player.intelligence += this.intelligenceBonus;
                player.horizon += this.horizonBonus;
                player.finance += this.financeBonus;
                player.examBase += this.examBase;
                player.battle += this.battle;
                player.risk += this.risk;
                player.luck += this.luck;
                //体力、精力、心情上限100
                if (player.mood >= 100) {
                    player.mood = 100;
                }
                if (player.spirit >= 100) {
                    player.spirit = 100;
                }
                if (player.strength >= 100) {
                    player.strength = 100;
                }
                //风险不能降到0以下
                if (player.risk <= 0) {
                    player.risk = 0;
                }
                //幸运值最高20
                if (player.luck >= 20) {
                    player.luck = 20;
                }
                //更新状态栏的各项数值
                statusBanner.updateDiv(player);

                //在这里加入考研、找工作、写毕业论文相关判定。
                if (this.text === splanQiuZhao.text) {
                    flagQiuzhi = true;
                    let x = seekJob(player, 10);
                    if (x === 3) {
                        flagGongzuo3 = true;
                    } else if (x === 2) {
                        flagGongzuo2 = true;
                    } else if (x === 1) {
                        flagGongzuo1 = true;
                    }
                }
                if (this.text === splanChunZhao.text) {
                    flagQiuzhi = true;
                    let x = seekJob(player, 5);
                    if (x === 3) {
                        flagGongzuo3 = true;
                    } else if (x === 2) {
                        flagGongzuo2 = true;
                    } else if (x === 1) {
                        flagGongzuo1 = true;
                    }
                }
                if (this.text === splanKaoYan.text) {
                    kaoyanBase += 30;
                }
                if (this.text === splanGuanXi.text) {
                    kaoyanBase += 100;
                }
                if (this.text === splanLunWen.text) {
                    lunwenBase += 10;
                }
                if (this.text === splanMaiLunWen.text) {
                    lunwenBase += 50;
                }
            }
        };

        //根据眼界值不同，显示不同规划

        //数值参考：
        //1低级决断 = 25状态
        //1中级决断 = 40状态
        //1高级决断 = 100状态
        //1其它属性 = 50状态 = 2000金钱
        //1智力 = 1.5其它属性
        //1属性 = -4风险
        //1examBase = 5状态

        //1决断 约等于 25状态

        //投入1低级决断，产出状态值期望5+15+5=25。
        const splanFaDai = new schoolPlan("发呆", "小幅恢复心情、精力，较大幅恢复体力。", 0, GRI(4, 6), GRI(12, 17), GRI(4, 6), 0, 0, 0, 0, 0, 0, 0);
        const splanJuanJiDian = new schoolPlan("卷绩点", "消耗心情、精力，小幅消耗体力。提高期末考试成绩（仅限本学期）。", 0, -GRI(8, 12), -GRI(4, 6), -GRI(8, 12), 0, 0, 0, GRI(8, 12), 0, 0, 0);
        const splanDaGong = new schoolPlan("兼职打工", "小幅消耗心情、精力，较大幅度消耗体力。赚取两千块左右的零花钱。", GRI(1500, 2500), -GRI(4, 6), -GRI(12, 17), -GRI(4, 6), 0, 0, 0, 0, 0, 0, 0);
        const splanLiCai = new schoolPlan("闲钱理财", "消耗心情、精力，小幅消耗体力。小幅提升财商。", GRI(0, 100), -GRI(8, 12), -GRI(4, 6), -GRI(8, 12), 0, 0, GRI(1, 2), 0, 0, 0, 0);
        const splanDuiXian = new schoolPlan("和网友对线", "小幅消耗心情、精力，小幅提升战斗力。", 0, -GRI(4, 6), 0, -GRI(4, 6), 0, 0, 0, 0, GRI(1, 2), GRI(1, 2), 0);
        const lowSplanList = [splanFaDai, splanJuanJiDian, splanDaGong, splanLiCai, splanDuiXian];

        //1决断 约等于 40状态
        const splanLvYou = new schoolPlan("旅游", "花一千块钱左右。小幅消耗体力，恢复心情、精力。小幅提升眼界。", -GRI(800, 1200), GRI(8, 12), -GRI(4, 6), GRI(8, 12), 0, GRI(1, 2), 0, 0, 0, 0, 0);
        const splanBaoBan = new schoolPlan("报培训班", "花一千块钱左右。小幅消耗心情、精力，小幅提升智力。", -GRI(800, 1200), -GRI(4, 6), 0, -GRI(4, 6), GRI(1, 2), 0, 0, 0, 0, 0, 0);
        const splanXunXin = new schoolPlan("寻衅滋事", "花一千块钱左右。小幅消耗体力、精力，提高战斗力。", -GRI(800, 1200), 0, -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0, GRI(1, 3), GRI(1, 3), 0);
        const splanMaiDaAn = new schoolPlan("买答案", "花一千块钱左右找任课老师买答案，大幅提高期末考试成绩。", -GRI(800, 1200), 0, 0, 0, 0, 0, 0, GRI(18, 22), 0, GRI(2, 4), 0);
        //投入1中级决断、8+8=16点状态（总计56点状态），产出1200金钱（折合30状态）、0.5眼界（折合25状态）
        const splanZiMeiTi = new schoolPlan("做自媒体", "消耗心情、精力，可能赚可能亏。或许能提升眼界。", GRI(-1600, 4000), -GRI(6, 10), 0, -GRI(6, 10), 0, GRI(0, 1), 0, 0, 0, 0, 0);
        const middleSplanList = [splanLvYou, splanBaoBan, splanXunXin, splanMaiDaAn, splanZiMeiTi];

        //1决断 约等于 100状态
        const splanTangPing = new schoolPlan("躺平", "啥都不干，较大幅度恢复心情、精力、体力。也许会有好事发生。", 0, GRI(12, 17), GRI(12, 17), GRI(12, 17), 0, 0, 0, 0, 0, -GRI(1, 2), GRI(1, 2));
        const splanHeiKe = new schoolPlan("威胁学霸做替考", "极大幅提高期末考试成绩。", 0, 0, 0, 0, 0, 0, 0, GRI(25, 35), 0, GRI(3, 5), 0);
        const splanChaoGu = new schoolPlan("炒股", "大概率亏很多，较大幅度提升财商。", GRI(-3600, 400), 0, 0, 0, 0, 0, GRI(2, 4), 0, 0, 0, 0);
        const splanLianAi = new schoolPlan("谈恋爱", "花两千块左右，大幅消耗体力，恢复心情、精力。较大幅度提升眼界。", -GRI(1500, 2500), GRI(8, 12), -GRI(17, 23), GRI(8, 12), 0, GRI(2, 4), 0, 0, 0, 0, 0);
        const splanGanRao = new schoolPlan("不让室友学习", "消耗体力，提高自己的期末成绩，较大幅度提高战斗力。但是会变笨。", 0, 0, -GRI(8, 12), 0, -GRI(1, 2), 0, 0, GRI(8, 12), GRI(2, 4), GRI(2, 4), 0);
        const highSplanList = [splanTangPing, splanHeiKe, splanChaoGu, splanLianAi, splanGanRao];

        //1决断 约等于 400状态
        const splanGeJiuCai = new schoolPlan("操纵金融市场", "割散户韭菜，一次就能赚一万左右，极大幅提高财商和战斗力。但可能会发生不好的事。", GRI(8000, 12000), 0, 0, 0, 0, 0, GRI(4, 6), 0, GRI(4, 6), GRI(18, 22), 0);
        const splanTiKao = new schoolPlan("黑进教务系统", "期末成绩拉满，顺便勒索学校两千块钱，极大幅提高战斗力。但说不定会遭报应。", 2000, 0, 0, 0, 0, 0, 0, 100, GRI(4, 6), GRI(18, 22), 0);
        const splanChanHui = new schoolPlan("忏悔", "向地球OL管理员坦白罪过，祈求宽恕。捐出五千块钱，大幅消耗体力、精力、心情。", -5000, -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 0, 0, 0, -GRI(23, 25), GRI(5, 7));
        const splanKeYan = new schoolPlan("做科研", "消耗体力、精力、心情，极大幅度增加智力，还能拿两千块钱左右的补助。", GRI(1800, 2200), -GRI(8, 12), -GRI(8, 12), -GRI(8, 12), GRI(4, 6), 0, 0, 0, 0, 0, 0);
        const splanJiuYe = new schoolPlan("做市场调研", "消耗体力，极大幅度增加求职成功率，还能提高财商。", 0, 0, -GRI(8, 12), 0, 0, GRI(4, 6), GRI(1, 3), 0, 0, 0, GRI(1, 2));  //眼界与求职成功率正相关
        const splanDuJia = new schoolPlan("去豪华酒店度假", "花一万块钱，体力、精力、心情全部恢复到满状态。较大幅度增加幸运值。", -10000, 200, 200, 200, 0, 0, 0, 0, 0, 0, GRI(4, 6));
        const exSplanList = [splanGeJiuCai, splanTiKao, splanChanHui, splanKeYan, splanJiuYe, splanDuJia];

        //零体力、零金钱时，返回特殊规划
        const splanBanZhuan = new schoolPlan("搬砖", "搭进去半条命，挣几千块钱。", GRI(3000, 5000), -GRI(35, 45), -GRI(35, 45), -GRI(35, 45), 0, 0, 0, 0, 0, 0, 0);
        const zeroStrengthPlans = lowSplanList;
        const zeroMoneyPlans = [splanBanZhuan, splanLvYou, splanBaoBan, splanChaoGu, splanLianAi];

        //大四学年涉及考研、就业、写毕业论文等，适用特殊的一组规划
        const splanJYFudao = new schoolPlan("听就业辅导讲座", "花五千块钱，听职场前辈传授人生经验。或许比自己闷头投简历强。（较大幅度增加求职成功率。）", -5000, 0, 0, 0, 0, GRI(2, 4), 0, 0, 0, 0, 0);    //求职成功率与眼界正相关
        const splanXiuZheng = new schoolPlan("休整", "花点小钱，吃好喝好休息好。（花一两千块钱，大幅恢复体力、精力、心情。）", -GRI(1500, 2500), GRI(17, 23), GRI(17, 23), GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanQiuZhao = new schoolPlan("秋招投简历", "一口气投十份简历出去，总能拿到offer吧？（投出十份简历，大幅消耗精力。）", 0, 0, 0, -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanKaoYan = new schoolPlan("复习考研", "大幅消耗体力、精力、心情，小幅提升考研成绩。", 0, -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanGuanXi = new schoolPlan("找关系，买今年的考研题", "花五千块买原题，考研稳如老狗。但只要平时认真复习，现在不找关系也能考上吧？", -5000, 0, 0, 0, 0, 0, 0, 0, 0, GRI(38, 42), 0);
        const splanChunZhao = new schoolPlan("春招投简历", "说不定秋招投的简历已经出结果了。但保险起见，还是接着投吧。（投出五份简历，大幅消耗精力。）", 0, 0, 0, -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanLunWen = new schoolPlan("准备毕业论文", "总得毕业吧？不然四年学白上了。（大幅消耗体力、精力、心情，提高毕业答辩通过率。）", 0, -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0);
        const splanMaiLunWen = new schoolPlan("买毕业论文", "只要价格合适，愿意写本科毕业论文的一抓一大把。干嘛非得自己写？（花两万块钱，大幅提高毕业答辩通过率。）", -20000, 0, 0, 0, 0, 0, 0, 0, 0, GRI(46, 54), 0);
        const DaSiShangSplanList = [splanQiuZhao, splanKaoYan, splanXiuZheng, splanJYFudao, splanGuanXi];  //大四上plan
        //因为后续处理中，涉及钱不够禁止选择相关选项的操作。此数组各计划顺序不能调换。
        const DaSiXiaSplanList = [splanChunZhao, splanLunWen, splanXiuZheng, splanJYFudao, splanMaiLunWen]; //同样，这里各计划顺序不能调换。



        //特殊事件


        class specialEvent {
            constructor(text, description, moneyCost, moodCost, strengthCost, spiritCost, intelligenceBonus, financeBonus, battle, risk, code, examBase) {
                this.text = text;
                this.description = description;
                this.moneyCost = moneyCost;
                this.moodCost = moodCost;
                this.strengthCost = strengthCost;
                this.spiritCost = spiritCost;
                this.intelligenceBonus = intelligenceBonus;
                this.financeBonus = financeBonus;
                this.battle = battle;
                this.risk = risk;
                this.code = code; //事件识别码
                this.examBase = examBase;
            }

            //根据具体事件，消耗或恢复体力、心情、体力等
            //统一用加法。消耗体力的事件，事件中strength用负数表示。
            updateAttr(player) {
                player.mood += this.moodCost;
                player.spirit += this.spiritCost;
                player.strength += this.strengthCost;
                player.money += this.moneyCost;
                player.intelligence += this.intelligenceBonus;
                player.finance += this.financeBonus;
                player.risk += this.risk;
                player.battle += this.battle;
                player.examBase += this.examBase;

                if (player.mood >= 100) {
                    player.mood = 100;
                }
                if (player.spirit >= 100) {
                    player.spirit = 100;
                }
                if (player.strength >= 100) {
                    player.strengh = 100;
                }
                if (player.risk <= 0) {
                    player.risk = 0;
                }
                //更新状态栏的各项数值
                statusBanner.updateDiv(player);
            }
        };

        //贫困生相关事件
        const seventPinKunRenDing = new specialEvent("家境贫寒，认定了贫困生资格", "拿到2000块钱补助。如果成绩优秀，还有机会评上励志奖学金。", 2000, 0, 0, 0, 0, 0, 0, 0, CODE_PIN_KUN, 0);
        const seventPinKunBuZhu = new specialEvent("贫困补助到账", "拿到两千块钱。但是要强制参加活动，还要完善一些证明材料，稍微有一点麻烦。（小幅消耗心情、精力、体力。）", 2000, -GRI(4, 6), -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0, 0, 0);
        const seventPinKunXueYe = new specialEvent("学业奖学金", "最普罗大众的奖学金，没啥好说的。和贫困生补助加起来，能有四千块钱。", 4000, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventLiZhi = new specialEvent("励志奖学金", "评上励志奖学金，手头宽裕不少。和贫困生补助加起来，足足七千块呢。", 7000, 0, 0, 0, 0, 0, 0, 0, CODE_LIZHI, 0);
        const seventPinKunGuoJiang = new specialEvent("拿到国家奖学金", "拿到八千块钱。再加上今年两千的贫困生补助，到手一共一万块。既有面子又有里子。", 10000, 0, 0, 0, 0, 0, 0, 0, CODE_GUOJIANG, 0);

        //奖学金事件
        const seventXueYe = new specialEvent("学业奖学金", "只要努力学习，就能拿到的奖学金。不需要天赋。奖金只有区区两千块，还不够一个月花的。", 2000, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventGuoJiang = new specialEvent("拿到国家奖学金", "学校没设置其它花里胡哨的荣誉，国奖到顶。它证明你学业上无敌了——顺便还给你八千块钱。", 8000, 0, 0, 0, 0, 0, 0, 0, CODE_GUOJIANG, 0);

        //学生会事件
        const seventXueShengHui = new specialEvent("加入了学生会", "说不定会有好事发生。有学生会经历，将来找工作也方便一些。但入会面试有些麻烦，还要做一份很正式的简历，花了不少时间。（小幅消耗心情、精力、体力。）", 0, -GRI(4, 6), -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0, CODE_XUE_SHENG_HUI, 0);
        //命名规则：route Xueshenghui (phase) 1
        const rXsh1 = new specialEvent("出任校会部长", "当上了办公室副主任（正部长级）。校学生会的中流砥柱。既要在一线干活，又要搞好部门内团队建设。今天请学弟学妹吃饭，花掉不少大洋。但心情变好了。", -GRI(800, 1299), GRI(8, 12), 0, 0, 0, 0, 0, 0, CODE_XSH1, 0);
        const rXsh2 = new specialEvent("挤进校会主席团", "作为主席团成员兼任办公室主任，属于副主席级高干。每周都要开工作会议怼人。战斗力较大幅度提升了。", 0, 0, 0, 0, 0, 0, 3, 0, CODE_XSH2, 0);
        const rXsh3 = new specialEvent("成为学生会长", "校会一把手，整个学校都在肩上扛着，位高权重。跳出三界外，不在五行中。直接成为人生赢家。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_XSH3, 0);
        const rListXsh = [rXsh1, rXsh2, rXsh3];

        //课金页游事件
        const seventGuGuZhen = new specialEvent("发现一款课金页游", "有什么非玩不可的理由吗？骗课不说，还越玩越气。（课了五百块、小幅降低心情。）", -500, -GRI(4, 6), 0, 0, 0, 0, 0, 0, CODE_GU_GU, 0);
        const rGGZ1 = new specialEvent("入围排行榜", "往页游里课金，不知不觉课到全服前一百了。（刚说完又课了两千进去。）", -2000, 0, 0, 0, 0, 0, 0, 0, CODE_GGZ1, 0);
        const rGGZ2 = new specialEvent("挤进全服前十", "卧槽，居然课到全服前十了。少说也砸了五千块进去吧？", -5000, 0, 0, 0, 0, 0, 0, 0, CODE_GGZ2, 0);
        const rGGZ3 = new specialEvent("页游登顶", "砸了两万进去，总算站上排行榜第一的位置了。大学？那是啥？有课金页游就够了。", -20000, 0, 0, 0, 0, 0, 0, 0, CODE_GGZ3, 0);
        const rListGGZ = [rGGZ1, rGGZ2, rGGZ3];

        //诺奖事件
        const seventNobel = new specialEvent("生死看淡，不服就干", "sb网友叫嚣着公园单挑。你无所畏惧，对方反倒怂了。真爽。（恢复心情、大幅提升战斗力）", 0, GRI(8, 12), 0, 0, 0, 0, GRI(2, 4), GRI(3, 4), CODE_NOBEL, 0);
        const rNobel1 = new specialEvent("崭露头角", "你天天在网上对线，发现别人都是sb。突然，你转念一想。也许，并不是别人傻，而是你太聪明了。（增加战斗力。）", 0, 0, 0, 0, 0, 0, GRI(1, 3), 0, CODE_NOBEL1, 0);
        const rNobel2 = new specialEvent("证明了哥德巴赫猜想", "你苦思冥想，终于证明出哥德巴赫猜想。你找到数学系的老师，他却说你是民科。你感到很气愤。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_NOBEL2, 0);
        const rNobel3 = new specialEvent("获得诺贝尔奖", "经过一年努力，你又解决了许多数学难题。你的辩论技巧有所提升，用物理手段说服了数学院所有老师。数学院学术委员会研究决定，授予你诺贝尔数学奖。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_NOBEL3, 0);
        const rListNobel = [rNobel1, rNobel2, rNobel3];

        //三条特殊路线的前置事件数组
        //命名规则：special event 前置
        const seQianZhi = [seventXueShengHui, seventGuGuZhen, seventNobel];



        //大四相关事件。
        //主要是将文字消息提示给用户，相关数据处理在别的地方进行。
        const seventBaoyanGood = new specialEvent("预录取", "推免系统开放，被研究生学校的老师催着填了他们。一分耕耘一分收获，总算有学上了。", 0, 0, 0, 0, 0, 0, 0, 0, BAOYAN_GOOD, 0);
        const seventBaoyanBad = new specialEvent("咕咕咕", "推免系统卡顿，研究生学校说他们没名额了。煮熟的鸭子飞了，还有这种操作？（大幅降低心情、精力。）", 0, -GRI(17, 23), 0, -GRI(17, 23), 0, 0, 0, 0, BAOYAN_BAD, 0);
        const seventTiaojiGood = new specialEvent("调剂上岸", "调剂去了一所辣鸡大学。算了，有书念总比没有好。", 0, 0, 0, 0, 0, 0, 0, 0, TIAOJI_GOOD, 0);
        const seventTiaojiBad = new specialEvent("调剂失败", "见鬼，就没一所大学要我？（心情变差了。）", 0, -GRI(25, 35), 0, 0, 0, 0, 0, 0, TIAOJI_BAD, 0);
        const seventGongzuo3 = new specialEvent("令人心动的offer", "名企管培生，在写字楼上班的职场精英。有望两年内晋升中层领导，五年跻身高管序列。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_GONGZUO, 0);
        const seventGongzuo2 = new specialEvent("差强人意的offer", "工作枯燥乏味，工资也就那样，附近房租却不低。走一步看一步吧。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_GONGZUO, 0);
        const seventGongzuo1 = new specialEvent("黑作坊offer", "郊区黑作坊两班倒，比牛马还牛马。一定是你上辈子修来的福报。", 0, 0, 0, 0, 0, 0, 0, 0, CODE_GONGZUO, 0);
        const seventGongzuo0 = new specialEvent("颗粒无收", "找了一整年工作，却没有任何一家公司要你。认命吧。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);

        const seventKeGaiDasi = new specialEvent("严抓毕设质量", "为迎接教育部门检查，校领导要求提升本科学位论文质量，加强论文评审工作。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventShiJuanDasi = new specialEvent("放放水啦", "毕业答辩前夕，班上一位同学试图一跃解千愁。院领导连夜开会，要求论文答辩放水，防止类似事件再次发生。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 0);


        //其它特殊事件

        //负面事件。根据风险值，概率触发。
        const seventMaiBi = new specialEvent("买笔", "有人上门推销，自称是经济系毕业班学生，在做社会实践，要你买他的笔。一看就是骗子。你揍了他一顿，不得不赔他医药费。（损失一笔钱，大幅消耗体力、精力、心情，小幅提升战斗力。）", -GRI(1500, 2500), -GRI(17, 23), -GRI(17, 23), -GRI(17, 23), 0, 0, 1, 1, 0, 0);
        const seventKeGai = new specialEvent("教学质量", "连续好几届学生反映，期末考试太简单、没有区分度。任课老师痛定思痛，狠抓教学质量，顺便加大期末考试难度。（降低本学期期末考试成绩。）", 0, 0, 0, 0, 0, 0, 0, 0, 0, -GRI(8, 12));
        const seventChaoJia = new specialEvent("寝室矛盾", "因为寝室卫生问题，跟室友大打出手。双方都很不爽。（大幅降低心情、精力，提高战斗力。）", 0, -GRI(17, 23), 0, -GRI(17, 23), 0, 0, GRI(1, 3), GRI(4, 5), 0, 0);
        const seventXueHan = new specialEvent("血汗工厂", "被辅导员卖去血汗工厂打工。搭进去半条命，却只拿到几百块劳务费。", GRI(400, 600), 0, -GRI(40, 60), 0, 0, 0, 0, 0, 0, 0);
        const seventHengHuo = new specialEvent("飞来横祸", "上学路上被板砖砸到脑袋。乍看上去没问题，但说不定会落下后遗症。（可能小幅降低智力）", 0, 0, 0, 0, -GRI(0, 2), 0, 0, 0, 0, 0);
        const badSeventList = [seventMaiBi, seventKeGai, seventChaoJia, seventXueHan, seventHengHuo];
        //极端负面事件
        const seventZhaPian = new specialEvent("AI诈骗", "有人用AI大模型生成视频，冒充你的辅导员让你打钱。血亏一万块不说，心情也变差了。", -10000, -GRI(17, 23), 0, 0, 0, 0, 0, 0, 0, 0);
        const seventXiaDu = new specialEvent("饮水机下毒", "室友往饮水机里放慢性毒药。你偶尔感到不舒服，但没想太多。不知不觉中变傻了。（极大幅度降低智商、财商）", 0, 0, 0, 0, -GRI(4, 6), -GRI(4, 6), 0, 0, 0, 0);
        const seventJueWang = new specialEvent("绝望", "学校发布就业报告。你仔细阅读，发现你们学院的本科就业率只有个位数。你绝望了。", 0, -100, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventChuanXiao = new specialEvent("被骗进传销窝点", "你的好朋友要带你一起发财。你同意了，结果被骗到传销窝点。你耗尽全部体力，总算找到机会逃出来。", 0, 0, -100, 0, 0, 0, 0, 0, 0, 0);
        const seventDiuShuJu = new specialEvent("电脑坏了", "你的创新项目即将结项答辩，结果做好的文件打不开了。你拆下硬盘，去电脑城找人恢复数据，又被骗了一笔钱。（精力清空。）", -GRI(1500, 2500), 0, 0, -100, 0, 0, 0, 0, 0, 0);
        const vbadSeventList = [seventZhaPian, seventXiaDu, seventJueWang, seventChuanXiao, seventDiuShuJu];


        //正面事件 根据幸运值，概率触发。
        const seventJianQian = new specialEvent("捡钱", "上学路上捡到一个钱包，里面有几千块钱。真走运。", GRI(2000, 4000), 0, 0, 0, 0, 0, 0, 0, 0, 0);
        const seventJiangzuo = new specialEvent("听讲座", "听了一场经济学讲座。学到不少经济知识，还收到一个小礼物。（获得几百块钱，提升财商。）", GRI(400, 600), 0, 0, 0, 0, GRI(1, 3), 0, 0, 0, 0);
        const seventShiJuan = new specialEvent("往年试卷", "意外地入手一份去年的期末考试卷。虽然无法确定真假，但看着像那么回事。（提升期末考试成绩）", 0, 0, 0, 0, 0, 0, 0, 0, 0, GRI(8, 12));
        const seventJingSai = new specialEvent("竞赛获奖", "参加学校举办的知识竞赛，意外获奖。感觉突然变聪明了？（恢复心情、精力，小幅提升智商。）", 0, GRI(8, 12), 0, GRI(8, 12), 1, 0, 0, 0, 0, 0);
        const seventPoCai = new specialEvent("破财消灾", "丢了一百块钱，或许是什么好兆头。（略微降低负面事件发生概率。）", -100, 0, 0, 0, 0, 0, 0, -GRI(3, 5), 0, 0);
        const goodSeventList = [seventJianQian, seventJiangzuo, seventShiJuan, seventJingSai, seventPoCai];
        //给更强buff的正面事件
        const seventManJi = new specialEvent("满分预定", "你完成了老师布置的大作业。老师很满意，让你向全班同学作报告，并当场宣布你期末满分。", 0, 0, 0, 0, 0, 0, 0, 0, 0, 100);
        const seventZhanLi = new specialEvent("战力爆表", "上课时遭到恐怖袭击。你临危不乱，利用教室桌椅做掩护，徒手制服三名持枪的恐怖分子。战斗力极大幅度上升，还得到了五千块奖金。", 5000, 0, 0, 0, 0, 0, GRI(4, 6), 0, 0, 0);
        const seventXianRen = new specialEvent("仙人抚顶", "梦中受智慧之神点拨，洞察万物之理。智商极大幅度上升。", 0, 0, 0, 0, GRI(4, 6), 0, 0, 0, 0, 0);
        const seventYinHang = new specialEvent("和行长吃饭", "你的二代室友和银行行长吃饭，顺便拉你凑数。你听到不少内幕消息，理财观念被刷新。（财商极大幅度提升。）", 0, 0, 0, 0, 0, GRI(4, 6), 0, 0, 0, 0);
        const seventXinPing = new specialEvent("心平气和", "调理阴阳，达到天人合一的境界。身心都得到休息，与世无争。", 0, GRI(40, 60), GRI(40, 60), GRI(40, 60), 0, 0, 0, -GRI(8, 12), 0, 0);
        const vgoodSeventList = [seventManJi, seventZhanLi, seventXianRen, seventYinHang, seventXinPing];


        //随机数方法
        function GRI(min, max) {
            if (min >= max) {
                return max;
            }  //这个判断可能是多余的
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }
    </script>
    <script>//一些简单的计算函数。
        //注意，部分函数涉及对全局变量的访问与修改。


        //生成min和max之间的随机整数，包括min和max。最大不超过max
        function getRandomInteger(min, max) {
            if (min >= max) {
                return max;
            }  //这个判断可能是多余的
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        //随机给出玩家初始属性。可以选择通关特典，获得特殊加成
        function initializePlayerBuild(currentPlayer, giftstr1, giftstr2) {
            //不启用任何特典的情况下，四项属性取0-10之间的随机数。
            let wl = 0;  //wealth lower limit
            let wu = 10;
            let il = 0;
            let iu = 10;
            let hl = 0;
            let hu = 10;
            let fl = 0;
            let fu = 10;
            currentPlayer.money = 0;
            //通关特典giftExam，涉及期末考试相关计算。由于作为玩家属性的examBase每学期都被置零，这里不做修改。在期末考试部分做修改。此处只设置一个flag。
            if (giftstr1 === giftExam || giftstr2 === giftExam) {
                flagJuanWang = true;
            }
            switch (giftstr1) {
                case giftAttr1: {
                    wl += 2;
                    il += 2;
                    hl += 2;
                    fl += 2;
                    break;
                }
                case giftLuck1: {
                    currentPlayer.luck += 2;
                    break;
                }
                case giftBattle1: {
                    currentPlayer.battle += 2;
                    break;
                }
                case giftInt1: {
                    il += 6;
                    break;
                }
                case giftHor1: {
                    hl += 6;
                    break;
                }
                case giftFin1: {
                    fl += 6;
                    break;
                }
                case giftWea1: {
                    wl += 6;
                    break;
                }
                case giftAttr2: {
                    wl += 4;
                    il += 4;
                    hl += 4;
                    fl += 4;
                    break;
                }
                case giftLuck2: {
                    currentPlayer.luck += 5;
                    break;
                }
                case giftBattle2: {
                    currentPlayer.battle += 5;
                    break;
                }
                case giftWeaex: {
                    wl += 10;
                    currentPlayer.battle += 5;
                    iu -= 8;
                    break;
                }
                case giftMoney: {
                    wu -= 7;
                    currentPlayer.money += 25000;
                    break;
                }
                case giftAttr3: {
                    wl += 6;
                    il += 6;
                    hl += 6;
                    fl += 6;
                    break;
                }
                case giftExceed: {
                    wu += 7;
                    iu += 7;
                    hu += 7;
                    fu += 7;
                    break;
                }
                case giftLuck3: {
                    currentPlayer.luck += 12;
                    break;
                }
                default:
                    break;
            }
            switch (giftstr2) {
                case giftAttr1: {
                    wl += 2;
                    il += 2;
                    hl += 2;
                    fl += 2;
                    break;
                }
                case giftLuck1: {
                    currentPlayer.luck += 2;
                    break;
                }
                case giftBattle1: {
                    currentPlayer.battle += 2;
                    break;
                }
                case giftInt1: {
                    il += 6;
                    break;
                }
                case giftHor1: {
                    hl += 6;
                    break;
                }
                case giftFin1: {
                    fl += 6;
                    break;
                }
                case giftWea1: {
                    wl += 6;
                    break;
                }
                case giftAttr2: {
                    wl += 4;
                    il += 4;
                    hl += 4;
                    fl += 4;
                    break;
                }
                case giftLuck2: {
                    currentPlayer.luck += 5;
                    break;
                }
                case giftBattle2: {
                    currentPlayer.battle += 5;
                    break;
                }
                case giftWeaex: {
                    wl += 10;
                    currentPlayer.battle += 5;
                    iu -= 8;
                    break;
                }
                case giftMoney: {
                    wu -= 7;
                    currentPlayer.money += 25000;
                    break;
                }
                case giftAttr3: {
                    wl += 6;
                    il += 6;
                    hl += 6;
                    fl += 6;
                    break;
                }
                case giftExceed: {
                    wu += 7;
                    iu += 7;
                    hu += 7;
                    fu += 7;
                    break;
                }
                case giftLuck3: {
                    currentPlayer.luck += 12;
                    break;
                }
                default:
                    break;
            }

            currentPlayer.wealth = getRandomInteger(wl, wu);
            currentPlayer.intelligence = getRandomInteger(il, iu);
            currentPlayer.horizon = getRandomInteger(hl, hu);
            currentPlayer.finance = getRandomInteger(fl, fu);
            //初始金钱为100乘家境平方，再加1000。即，初始金钱在1000-11000范围变动。
            currentPlayer.money += 100 * currentPlayer.wealth * currentPlayer.wealth + 2000;
            //家境对财商的加成。取整数。
            currentPlayer.finance += Math.floor(currentPlayer.wealth / 2);
            //注意，启用超越极限特典的情况下，家境、智力值可能突破10。高考填志愿、结算等页面应做相应处理。
            return;
        }

        //阻止用户选择超过三项
        function checkCollegeSelections(checkbox, selectedCheckboxes) {
            if (checkbox.checked) {
                // 如果选中，添加到选中列表
                if (selectedCheckboxes.length >= 3) {
                    // 如果选择的数量已达到限制，取消选中
                    checkbox.checked = false;
                    alert("最多选择三项！");
                    return;
                }
                selectedCheckboxes.push(checkbox);
            } else {
                // 如果取消选中，从选中列表中移除
                let index = selectedCheckboxes.indexOf(checkbox);
                if (index !== -1) {
                    selectedCheckboxes.splice(index, 1);
                }
            }
        }

        //给填志愿页各大学选项加描述
        function appendUnivtext(li, name, text) {
            let div1 = document.createElement("div");
            let div2 = document.createElement("div");
            div1.className = "apply-univname";
            div2.className = "apply-univtext"
            div1.textContent = name;
            div2.textContent = text;
            li.appendChild(div1);
            li.appendChild(div2);
            return;
        }


        //从给定的规划组中随机选出count个规划
        function selectRandomPlans(plansArray, count) {
            let selectedPlans = [];
            let usedIndices = new Set();

            while (selectedPlans.length < count) {
                let index = Math.floor(Math.random() * plansArray.length);
                // 确保不会重复选择相同的计划
                if (!usedIndices.has(index)) {
                    usedIndices.add(index);
                    selectedPlans.push(plansArray[index]);
                }
            }
            return selectedPlans;
        }
        //期末考试相关计算

        //该函数返回一个数组。数组每个元素都是0-100的整数，代表考试成绩。数组长度代表一共考多少门课。
        function calFinalExam(inte, base, univ, eNum, luck) {
            //分数取值范围在0-100，相关属性提高随机下限。
            let lLimit = base + luck + inte * 6 + 10 * univ.tier;

            let final = [];
            //对每门课分别做判定
            for (let i = 0; i < eNum; i++) {
                //如果下限超过100，则判定为满分。
                let result = 0;
                if (lLimit >= 100) {
                    result = 100;
                } else {
                    result = getRandomInteger(lLimit, 100);
                }
                //根据学校的竞争激烈度，对最终分数做调整
                result -= 2 * univ.pressure;
                //负数的情况下，调整为0分。
                if (result < 0) {
                    result = 0;
                }
                //如果挂科，根据幸运值给一次补救机会。
                if (result < 60) {
                    let z = getRandomInteger(0, 20);
                    if (z <= luck) {
                        result = 60;
                    }
                }
                final.push(result);
            }
            return final;
        }
        //计算绩点。注意，该函数返回一个0-400的整数。显示给用户时，应先乘0.01
        function calExamGPA(exam) {
            //复制数组
            let gpa = [];
            let sum = 0;
            for (let i = 0; i < exam.length; i++) {
                gpa.push(exam[i]);
            }

            //百分制成绩换算成绩点。保留两位小数，即取0-400的整数。
            for (let i = 0; i < gpa.length; i++) {
                if (gpa[i] >= 90) {
                    gpa[i] = 400;
                } else if (gpa[i] >= 85) {
                    gpa[i] = 370;
                } else if (gpa[i] >= 82) {
                    gpa[i] = 330;
                } else if (gpa[i] >= 78) {
                    gpa[i] = 300;
                } else if (gpa[i] >= 75) {
                    gpa[i] = 270;
                } else if (gpa[i] >= 71) {
                    gpa[i] = 230;
                } else if (gpa[i] >= 66) {
                    gpa[i] = 200;
                } else if (gpa[i] >= 62) {
                    gpa[i] = 170;
                } else if (gpa[i] >= 60) {
                    gpa[i] = 130;
                } else {
                    gpa[i] = 0;
                }

                sum += gpa[i];
            }

            let result = Math.floor(sum / gpa.length);
            return result;
        }
        function score2GPA(score) {
            //把百分制成绩数组换算成GPA数组
            let gpa = [];
            for (let i = 0; i < score.length; i++) {
                gpa.push(score[i]);
            }
            for (let i = 0; i < gpa.length; i++) {
                if (gpa[i] >= 90) {
                    gpa[i] = 400;
                } else if (gpa[i] >= 85) {
                    gpa[i] = 370;
                } else if (gpa[i] >= 82) {
                    gpa[i] = 330;
                } else if (gpa[i] >= 78) {
                    gpa[i] = 300;
                } else if (gpa[i] >= 75) {
                    gpa[i] = 270;
                } else if (gpa[i] >= 71) {
                    gpa[i] = 230;
                } else if (gpa[i] >= 66) {
                    gpa[i] = 200;
                } else if (gpa[i] >= 62) {
                    gpa[i] = 170;
                } else if (gpa[i] >= 60) {
                    gpa[i] = 130;
                } else {
                    gpa[i] = 0;
                }
            }
            return gpa;
        }
        function gpaArray2GPA(array) {
            //计算平均绩点
            let sum = 0;
            for (let i = 0; i < array.length; i++) {
                sum += array[i];
            }
            let result = Math.floor(sum / array.length);
            return result;
        }

        //计算四级得分
        function calCetScore(player) {
            let base = (player.intelligence + player.luck) * 20 + cetBase + 235 - (player.univRank * 10);
            //数值参考： 智商10、大学排名第一，随机下限正好是425
            if (base >= 710) {
                return 710;
            }
            if (base < 0) {
                base = 0;
            }
            let score = getRandomInteger(base, 710);
            return score;
        }

        //计算实习
        //3： 好实习 2：一般的实习  1：差实习 0：没找到
        function calShixi(player) {
            let base = player.horizon + player.finance + player.battle + shixiBase + player.luck - player.univRank;

            switch (player.majorCode) {
                case ART_MAJOR:
                    base -= 10;
                    break;
                case SOCIAL_MAJOR:
                case ENGINEER_MAJOR:
                    base += 5;
                    break;
                case MEDICAL_MAJOR:
                    base -= 5;   //增加游戏难度
                    //base += 10;           
                    break;
                default:
                    break;
            }

            if (base > 100) {
                return 3;
            }
            let x1 = getRandomInteger(base, 100);
            let x2 = getRandomInteger(base, 100);
            let x3 = getRandomInteger(base, 100);

            if (x1 > 90 || x2 > 90 || x3 > 90) {
                return 3;
            }
            if (x1 > 80 || x2 > 80 || x3 > 80) {
                return 2;
            }
            if (x1 > 60 || x2 > 60 || x3 > 60) {
                return 1;
            }
            return 0;
        }

        //计算保研
        //3：保上顶尖名校  2：保一般的学校  1：保差的学校  0：没有
        function calBaoYan(player) {
            if (!flagShixi) {
                return 0;
            }
            let base = player.horizon + player.battle + player.finance + (player.luck + player.intelligence) * 2 - player.univRank * 3;

            switch (player.majorCode) {
                case ART_MAJOR:
                    base -= 20;
                    break;
                case MEDICAL_MAJOR:
                    //base += 5;
                    base -= 10;   //增加游戏难度
                    break;
                case SCIENCE_MAJOR:
                    base += 10;
                    break;
                default:
                    base -= 5;
                    break;
            }

            if (base > 100) {
                return 3;
            }

            let x1 = getRandomInteger(base, 100);
            let x2 = getRandomInteger(base, 100);
            let x3 = getRandomInteger(base, 100);

            if (x1 > 90 || x2 > 90 || x3 > 90) {
                return 3;
            }
            if (x1 > 80 || x2 > 80 || x3 > 80) {
                return 2;
            }
            if (x1 > 60 || x2 > 60 || x3 > 60) {
                return 1;
            }
            return 0;
        }

        //计算考研
        //3表示考上好学校，2表示考上一般学校，1表示达到国家线，0表示没达到国家线。
        function calKaoYan(player) {
            let base = kaoyanBase + (player.intelligence + player.luck + player.battle - player.univRank) * 5;
            if (base >= 500) {
                return 3;
            }

            if (base >= 300 || player.univRank <= 4) {
                base -= 100;
                let z = getRandomInteger(base, 500);
                if (z > 400) {
                    return 3;
                }
                return 1;
            }

            if (player.univRank === 11) {
                base += 50; //考研神校特殊加成
            }

            let y = getRandomInteger(base, 500);

            if (y > 350) {
                return 2;
            }
            return 0;
        }

        //考研调剂计算
        function tiaojiShangan(player) {
            let base = (player.horizon + player.finance) * 2 + player.battle + player.luck;
            let z = getRandomInteger(0, 100);
            if (base > z)
                return true;
            let y = getRandomInteger(0, 35);
            if (y <= player.luck) {
                return true;
            }
            return false;
        }

        //找工作计算
        //3表示好工作，2表示一般工作，1表示差工作，0表示没找到。
        function seekJob(player, count) {
            //找工作主要和眼界有关
            let m = getRandomInteger(0, 50);
            if (m <= player.luck) {
                return 3;
            }

            let y = player.horizon * 3 + player.finance + player.intelligence + player.battle + player.luck + 100 - (player.univRank * 10);

            if (flagShixi) {
                y += 100;
            }
            if (flagCet) {
                y += 50;
            }
            if (flagRongYu) {
                y += 50;
            }

            switch (player.majorCode) {
                case ENGINEER_MAJOR:
                    y += 70;
                    break;
                case MEDICAL_MAJOR:
                    //y += 50;
                    y -= 30;   //增加游戏难度
                    break;
                case SOCIAL_MAJOR:
                case SCIENCE_MAJOR:
                    y += 30;
                    break;
                default:
                    break;
            }

            if (player.univRank <= 4) {
                for (let i = 0; i < count; i++) {
                    let z = getRandomInteger(0, 4000);
                    if (y > z) {
                        return 3;
                    }
                }
                return 0;
            }
            if (player.univRank === 20) {
                return 1;
            }

            for (let i = 0; i < count; i++) {
                let j = getRandomInteger(0, 100);
                if (j > 60) {
                    let z = getRandomInteger(0, 4000);
                    if (y > z) {
                        return 3;
                    }
                } else if (j > 30) {
                    let z = getRandomInteger(0, 2500);
                    if (y > z) {
                        return 2;
                    }
                } else {
                    let z = getRandomInteger(0, 1000);
                    if (y > z) {
                        return 1;
                    }
                }
            }
            return 0;

        }

        //毕业论文计算
        function calLunwen(player) {
            let base = lunwenBase + player.intelligence + player.battle - player.univRank;
            switch (player.majorCode) {
                case ART_MAJOR:
                    base += ART_DIFF;
                    break;
                case SOCIAL_MAJOR:
                    base += SOCIAL_DIFF;
                    break;
                case ENGINEER_MAJOR:
                    base += ENGINEER_DIFF;
                    break;
                case SCIENCE_MAJOR:
                    base += SCIENCE_DIFF;
                    break;
                case MEDICAL_MAJOR:
                    base += MEDICAL_DIFF;
                    break;
            }
            if (base >= 100) {
                return 100;
            }
            let z = getRandomInteger(base, 100);

            if (z < 60) {
                let x = getRandomInteger(0, 30);
                if (x <= player.luck) {
                    return 60;
                }
            }
            return z;
        }






        //游戏结算页相关
        function wealth2RatingSpan(wealth) {
            //输入表示家境的0-10的数，返回一个带有样式的span
            let spanname = document.createElement("span");
            spanname.textContent = "家境：";
            let spanrating = document.createElement("span");


            if (wealth === 10) {
                spanrating.textContent = wealth.toString() + "    中产";
                spanrating.className = "attr-rating-A";
            } else if (wealth >= 7) {
                spanrating.textContent = wealth.toString() + "    小康";
                spanrating.className = "attr-rating-B";
            } else if (wealth >= 4) {
                spanrating.textContent = wealth.toString() + "    温饱";
                spanrating.className = "attr-rating-C";
            } else {
                spanrating.textContent = wealth.toString() + "    贫困";
                spanrating.className = "attr-rating-D";
            }
            if (wealth > 10) {
                spanrating.textContent = wealth.toString() + "    富裕";
                spanrating.className = "attr-rating-S";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function univ2RatingSpan(univrank) {
            let univ = univList.find(un => un.rank === univrank);
            let spanname = document.createElement("span");
            spanname.textContent = "就读院校：";
            let spanrating = document.createElement("span");

            if (univrank === 1) {
                spanrating.textContent = univ.name + "    顶尖";
                spanrating.className = "attr-rating-S";
            } else if (univrank <= 4) {
                spanrating.textContent = univ.name + "    一流";
                spanrating.className = "attr-rating-A";
            } else if (univ.rank <= 8) {
                spanrating.textContent = univ.name + "    省重点";
                spanrating.className = "attr-rating-B";
            } else if (univ.rank <= 11) {
                spanrating.textContent = univ.name + "    普通";
                spanrating.className = "attr-rating-C";
            } else if (univ.rank === 12) {
                spanrating.textContent = univ.name + "    不太行";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = univ.name + "    辣鸡";
                spanrating.className = "attr-rating-E";
            }
            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function inte2RatingSpan(intelligence, endflag) {
            let spanname = document.createElement("span");
            spanname.textContent = "智力：";
            let spanrating = document.createElement("span");

            if (intelligence > 30) {
                spanrating.textContent = intelligence.toString() + "    超凡";
                spanrating.className = "attr-rating-S";
            } else if (intelligence > 25) {
                spanrating.textContent = intelligence.toString() + "    天才";
                spanrating.className = "attr-rating-A";
            } else if (intelligence > 20) {
                spanrating.textContent = intelligence.toString() + "    聪明";
                spanrating.className = "attr-rating-B";
            } else if (intelligence > 15) {
                spanrating.textContent = intelligence.toString() + "    普通";
                spanrating.className = "attr-rating-C";
            } else if (intelligence > 10) {
                spanrating.textContent = intelligence.toString() + "    愚笨";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = intelligence.toString() + "    制杖";
                spanrating.className = "attr-rating-E";
            }

            if (endflag === NOBEL_END) {
                spanrating.textContent = "***" + "    不可说";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function hor2RatingSpan(horizon) {
            let spanname = document.createElement("span");
            spanname.textContent = "眼界：";
            let spanrating = document.createElement("span");

            if (horizon >= 40) {
                spanrating.textContent = horizon.toString() + "    弥纶天地";
                spanrating.className = "attr-rating-S";
            } else if (horizon >= 30) {
                spanrating.textContent = horizon.toString() + "    高瞻远瞩";
                spanrating.className = "attr-rating-A";
            } else if (horizon >= 25) {
                spanrating.textContent = horizon.toString() + "    见多识广";
                spanrating.className = "attr-rating-B";
            } else if (horizon >= 20) {
                spanrating.textContent = horizon.toString() + "    普通";
                spanrating.className = "attr-rating-C";
            } else if (horizon >= 10) {
                spanrating.textContent = horizon.toString() + "    目光短浅";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = horizon.toString() + "    井底之蛙";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function fin2RatingSpan(finance) {
            let spanname = document.createElement("span");
            spanname.textContent = "财商：";
            let spanrating = document.createElement("span");

            if (finance >= 35) {
                spanrating.textContent = finance.toString() + "    世界级投资家";
                spanrating.className = "attr-rating-S";
            } else if (finance >= 30) {
                spanrating.textContent = finance.toString() + "    专业投资者";
                spanrating.className = "attr-rating-A";
            } else if (finance >= 25) {
                spanrating.textContent = finance.toString() + "    投机客";
                spanrating.className = "attr-rating-B";
            } else if (finance >= 20) {
                spanrating.textContent = finance.toString() + "    公墓经理";
                spanrating.className = "attr-rating-C";
            } else if (finance >= 10) {
                spanrating.textContent = finance.toString() + "    韭菜";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = finance.toString() + "    不会数钱";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function battle2RatingSpan(battle) {
            let spanname = document.createElement("span");
            spanname.textContent = "战斗力：";
            let spanrating = document.createElement("span");

            if (battle >= 25) {
                spanrating.textContent = battle.toString() + "    战神";
                spanrating.className = "attr-rating-S";
            } else if (battle >= 20) {
                spanrating.textContent = battle.toString() + "    王者";
                spanrating.className = "attr-rating-A";
            } else if (battle >= 15) {
                spanrating.textContent = battle.toString() + "    校霸";
                spanrating.className = "attr-rating-B";
            } else if (battle >= 10) {
                spanrating.textContent = battle.toString() + "    寝室扛把子";
                spanrating.className = "attr-rating-C";
            } else if (battle > 5) {
                spanrating.textContent = battle.toString() + "    打过架";
                spanrating.className = "attr-rating-D";
            } else {
                spanrating.textContent = battle.toString() + "    只有5的渣渣";
                spanrating.className = "attr-rating-E";
            }

            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function end2RatingSpan(endflag) {
            let spanname = document.createElement("span");
            spanname.textContent = "结局：";
            let spanrating = document.createElement("span");

            if (endflag === MOOD_END || endflag === STRENGTH_END || endflag === SPIRIT_END || endflag === RISK_END || endflag === GUAKE_END) {
                spanrating.textContent = "中道崩殂" + "    E";
                spanrating.className = "attr-rating-E";
            }
            if (endflag === ART_END || endflag === SOC_END || endflag === ENG_END || endflag === SCI_END || endflag === MED_END) {
                spanrating.textContent = "倒在毕业前夕" + "    E";
                spanrating.className = "attr-rating-E";
            }
            if (endflag === BAOYAN_END) {
                if (flagBaoyan3) {
                    spanrating.textContent = "名校保研" + "    A";
                    spanrating.className = "attr-rating-A";
                } else if (flagBaoyan2) {
                    spanrating.textContent = "保研" + "    B";
                    spanrating.className = "attr-rating-B";
                } else {
                    spanrating.textContent = "辣鸡学校保研" + "    C";
                    spanrating.className = "attr-rating-D";
                }
            }
            if (endflag === KAOYAN_END) {
                if (flagKaoYan3) {
                    spanrating.textContent = "名校研究生" + "    A";
                    spanrating.className = "attr-rating-A";
                } else if (flagKaoYan2) {
                    spanrating.textContent = "读研" + "    B";
                    spanrating.className = "attr-rating-B";
                } else {
                    spanrating.textContent = "辣鸡学校读研" + "    C";
                    spanrating.className = "attr-rating-D";
                }
            }
            if (endflag === PERFECT_END) {
                spanrating.textContent = "天选之子" + "    S";
                spanrating.className = "attr-rating-S";
            }
            if (endflag === GONGZUO3_END) {
                spanrating.textContent = "职场精英" + "    A";
                spanrating.className = "attr-rating-A";
            }
            if (endflag === GONGZUO2_END) {
                spanrating.textContent = "平凡的上班族" + "    B";
                spanrating.className = "attr-rating-B";
            }
            if (endflag === BIYE_SHIYE_END) {
                spanrating.textContent = "毕业即失业" + "    C";
                spanrating.className = "attr-rating-C"
            }
            if (endflag === DANBIYE_END) {
                spanrating.textContent = "单证战士" + "    D";
                spanrating.className = "attr-rating-D";
            }
            if (endflag === GONGZUO1_END) {
                spanrating.textContent = "黑作坊牛马" + "    D";
                spanrating.className = "attr-rating-D";
            }
            if (endflag === JIEYE_END) {
                spanrating.textContent = "大学结业" + "    D";
                spanrating.className = "attr-rating-D";
            }
            if (endflag === XSH_END) {
                spanrating.textContent = "学生会长" + "    S";
                spanrating.className = "attr-rating-S";
            }
            if (endflag === GGZ_END) {
                spanrating.textContent = "沉迷页游" + "    S";
                spanrating.className = "attr-rating-S";
            }
            if (endflag === NOBEL_END) {
                spanrating.textContent = "诺奖得主" + "    S";
                spanrating.className = "attr-rating-S";
            }



            let span = document.createElement("span");
            span.appendChild(spanname);
            span.appendChild(spanrating);
            return span;
        }
        function end2rank(endflag) {
            let rank = 0;
            switch (endflag) {
                case NOBEL_END:
                case GGZ_END:
                case XSH_END:
                case PERFECT_END:
                    rank = S_END_RANK;
                    break;
                case GONGZUO3_END:
                case BAOYAN3_END:
                case KAOYAN3_END:
                    rank = A_END_RANK;
                    break;
                case BAOYAN2_END:
                case KAOYAN2_END:
                case GONGZUO2_END:
                    rank = B_END_RANK;
                    break;
                case BAOYAN1_END:
                case BIYE_SHIYE_END:
                case KAOYAN1_END:
                    rank = C_END_RANK;
                    break;
                case GONGZUO1_END:
                case DANBIYE_END:
                case JIEYE_END:
                    rank = D_END_RANK;
                    break;
                default:
                    rank = E_END_RANK;
            }
            return rank;
        }
        function endrank2string(rank) {
            switch (rank) {
                case S_END_RANK:
                    return "S";
                case A_END_RANK:
                    return "A";
                case B_END_RANK:
                    return "B";
                case C_END_RANK:
                    return "C";
                case D_END_RANK:
                    return "D";
                case E_END_RANK:
                    return "E";
                default:
                    return "--";
            }
        }
        function endRecordDiv(rank) {
            let div = document.createElement("div");
            let div1 = document.createElement("div");
            let div2 = document.createElement("div");

            let span1 = document.createElement("span");
            let span2 = document.createElement("span");
            let span3 = document.createElement("span");
            let span4 = document.createElement("span");

            div1.appendChild(span1);
            div1.appendChild(span2);
            div2.appendChild(span3);
            div2.appendChild(span4);
            div.appendChild(div1);
            div.appendChild(div2);

            span1.textContent = "历史最佳：";
            span2.textContent = "  " + endrank2string(bestRecord);
            span3.textContent = "本局评价：";
            span4.textContent = "  " + endrank2string(rank);
            if (rank > bestRecord) {
                span4.textContent += "（新纪录）";
            }
            switch (bestRecord) {
                case S_END_RANK:
                    span2.className = "end-rating-S";
                    break;
                case A_END_RANK:
                    span2.className = "end-rating-A";
                    break;
                case B_END_RANK:
                    span2.className = "end-rating-B";
                    break;
                case C_END_RANK:
                    span2.className = "end-rating-C";
                    break;
                case D_END_RANK:
                    span2.className = "end-rating-D";
                    break;
                case E_END_RANK:
                default:
                    span2.className = "end-rating-E";
                    break;
            }
            switch (rank) {
                case S_END_RANK:
                    span4.className = "end-rating-S";
                    break;
                case A_END_RANK:
                    span4.className = "end-rating-A";
                    break;
                case B_END_RANK:
                    span4.className = "end-rating-B";
                    break;
                case C_END_RANK:
                    span4.className = "end-rating-C";
                    break;
                case D_END_RANK:
                    span4.className = "end-rating-D";
                    break;
                case E_END_RANK:
                default:
                    span4.className = "end-rating-E";
                    break;
            }
            return div;

        }
        function appendGifttext(li, text, description, rank) {
            let span1 = document.createElement("span");
            let span2 = document.createElement("span");
            span1.textContent = text;
            span2.textContent = description;
            if (rank === GIFT_S_RANK) {
                span1.className = "gift-rating-S";
            }
            if (rank === GIFT_A_RANK) {
                span1.className = "gift-rating-A";
            }
            if (rank === GIFT_B_RANK) {
                span1.className = "gift-rating-B";
            }
            if (rank === GIFT_C_RANK) {
                span1.className = "gift-rating-C";
            }
            if (rank === GIFT_D_RANK) {
                span1.className = "gift-rating-D";
            }
            if (rank === GIFT_E_RANK) {
                span1.className = "gift-rating-E";
            }
            li.appendChild(span1);
            li.appendChild(span2);
            //或许一般不会用id传参，大概有更合适的写法
            li.id = text;
            return;
        }

        //该函数接受一个字符串表示的特典，返回作为classname的字符串
        function gift2SpanClassname(giftstr) {
            switch (giftstr) {
                case giftInt1:
                case giftHor1:
                case giftFin1:
                case giftWea1:
                    return "gift-rating-D";
                case giftAttr2:
                case giftLuck2:
                case giftBattle2:
                    return "gift-rating-C";
                case giftWeaex:
                case giftMoney:
                case giftExam:
                    return "gift-rating-B";
                case giftAttr3:
                    return "gift-rating-A";
                case giftExceed:
                case giftLuck3:
                    return "gift-rating-S";
                default:
                    return "gift-rating-E";
            }
        } 
    </script>
    <script>

        //储存玩家本轮游戏数据
        class Player {
            constructor(name, gender, wealth, mood, strength, spirit, intelligence, horizon, finance, luck, risk, money, year, univRank, major, round, examBase, battle, semester, cgpa, tgpa) {
                this.name = name;			//姓名，由玩家自选
                this.gender = gender;			//性别，由玩家自选
                this.wealth = wealth;			//财富，与初始金钱、生活费挂钩
                this.mood = mood;			//心情，心情好才想干活
                this.strength = strength;		//体力
                this.spirit = spirit;			//精力
                this.intelligence = intelligence;	//智商
                this.horizon = horizon;			//眼界
                this.finance = finance;			//财商，与赚钱相关
                this.luck = luck;			//幸运，可以增加事件判定成功的机率
                this.risk = risk;			//初始为0，为正值时增加暴毙概率
                this.money = money;			//玩家的钱
                this.year = year;			//记录玩家现在上大学第几年  
                this.univRank = univRank;		//记录玩家上什么大学
                this.major = major;			//专业
                this.round = round;			//学期规划轮次
                this.examBase = examBase;		//期末考试成绩随机下限
                this.battle = battle;			//战斗力
                this.semester = semester;		//学期
                this.cgpa = cgpa;			//上学期绩点，请注意，绩点统一用0-400的数表示
                this.tgpa = tgpa;			//总绩点
            }
        }


        //各显示栏

        //标题。随游戏推进，切换学年、学期显示
        const titleBanner = {
            title: document.createElement("h1"),
            div: document.createElement("div"),

            createDiv: function () {
                this.title.textContent = "大一上学期";
                this.div.className = "mTitle";
                this.div.appendChild(this.title);
                return this.div;
            },

            updateDiv: function (player) {
                switch (player.year) {
                    case 1: {
                        titleBanner.title.textContent = "大一";
                        break;
                    }
                    case 2: {
                        titleBanner.title.textContent = "大二";
                        break;
                    }
                    case 3: {
                        titleBanner.title.textContent = "大三";
                        break;
                    }
                    case 4: {
                        titleBanner.title.textContent = "大四";
                        break;
                    }
                };
                if (player.semester % 2 === 1) {
                    titleBanner.title.textContent += "上学期";
                } else {
                    titleBanner.title.textContent += "下学期";
                }
            }
        }

        //重要事件记录栏
        const eventRecord = {
            title: document.createElement("h3"),
            list: document.createElement("div"),

            createDiv: function () {
                this.title.textContent = "重要事件记录";
                this.list.innerHTML = ""; //初始化时置零
                let div = document.createElement("div");
                div.appendChild(this.title);
                div.appendChild(this.list);
                div.className = "sidebar";
                return div;
            },

            updateDiv: function (msg) {
                let para = document.createElement("p");
                para.textContent = msg + "！";
                this.list.appendChild(para);
            }
        }



        //特殊事件栏
        const specialEventList = {
            title: document.createElement("h3"),
            div1: document.createElement("div"),
            div2: document.createElement("div"),
            div: document.createElement("div"),
            okbutton: document.createElement("button"),
            cplayer: null,

            createDiv: function (player) {
                //初始化
                this.title.className = "sevent-title";
                this.title.textContent = "发生特殊事件！"
                this.div1.className = "sevent-para1";
                this.div2.className = "sevent-para2";
                this.div.className = "sevent-container";
                this.okbutton.className = "sevent-button";
                this.okbutton.textContent = "知道了";
                this.cplayer = player;

                this.div.appendChild(this.title);
                this.div.appendChild(this.div1);
                this.div.appendChild(this.div2);
                this.div.appendChild(this.okbutton);

                this.okbutton.onclick = () => {
                    specialEventList.div.style.display = "none";

                    if (eventPhase === 4) {
                        if (flagXueShengHui) {
                            setGameover(player, XSH_END);
                        }
                        if (flagGuGuZhen) {
                            setGameover(player, GGZ_END);
                        }
                        if (flagNobel) {
                            setGameover(player, NOBEL_END);
                        }
                        return;
                    }

                    if (flagBaoyanEnd) {
                        setGameover(specialEventList.cplayer, BAOYAN_END);
                        return;
                    }

                    testEnd(specialEventList.cplayer);
                    if (isEnd)
                        return;

                    schoolTodoList.showPlan(specialEventList.cplayer);
                }

                this.div.style.display = "none";
                return this.div;
            },

            showDiv: function (player) {
                //展示
                let ev = specialEventList.getEvent(player);
                specialEventList.div1.textContent = ev.text;
                specialEventList.div2.textContent = ev.description;
                ev.updateAttr(player);
                specialDone = true;


                //一些特殊事件在这做额外处理，updateAttr函数不涉及

                if (ev.code === CODE_PIN_KUN) {
                    flagPinKunBuZhu = true;
                    eventRecord.updateDiv(seventPinKunRenDing.text);
                }
                if (ev.code === CODE_XUE_SHENG_HUI) {
                    flagXueShengHui = true;
                    eventPhase = 1;
                    eventRecord.updateDiv(seventXueShengHui.text);
                }
                if (ev.code === CODE_GU_GU) {
                    flagGuGuZhen = true;
                    eventPhase = 1;
                    eventRecord.updateDiv(seventGuGuZhen.text);
                }
                if (ev.code === CODE_NOBEL) {
                    flagNobel = true;
                    eventPhase = 1;
                    eventRecord.updateDiv(seventNobel.text);
                }
                if (ev.code === CODE_GUOJIANG || ev.code === CODE_LIZHI) {
                    flagRongYu = true;
                    eventRecord.updateDiv(seventGuoJiang.text);
                }

                if (ev.code === CODE_XSH1 || ev.code === CODE_GGZ1 || ev.code === CODE_NOBEL1) {
                    eventPhase = 2;
                }

                if (ev.code === CODE_XSH2 || ev.code === CODE_GGZ2 || ev.code === CODE_NOBEL2) {
                    eventPhase = 3;
                }

                if (ev.code === CODE_XSH3 || ev.code === CODE_GGZ3 || ev.code === CODE_NOBEL3) {
                    eventPhase = 4;
                }

                if (ev.code === CODE_XSH1) {
                    eventRecord.updateDiv(rXsh1.text);
                }
                if (ev.code === CODE_XSH2) {
                    eventRecord.updateDiv(rXsh2.text);
                }
                if (ev.code === CODE_XSH3) {
                    eventRecord.updateDiv(rXsh3.text);
                }

                if (ev.code === CODE_GGZ1) {
                    eventRecord.updateDiv(rGGZ1.text);
                }
                if (ev.code === CODE_GGZ2) {
                    eventRecord.updateDiv(rGGZ2.text);
                }
                if (ev.code === CODE_GGZ3) {
                    eventRecord.updateDiv(rGGZ3.text);
                }

                if (ev.code === CODE_NOBEL1) {
                    eventRecord.updateDiv(rNobel1.text);
                }
                if (ev.code === CODE_NOBEL2) {
                    eventRecord.updateDiv(rNobel2.text);
                }
                if (ev.code === CODE_NOBEL3) {
                    eventRecord.updateDiv(rNobel3.text);
                }
                if (ev.code === BAOYAN_GOOD) {
                    eventRecord.updateDiv("推免成功");
                    flagBaoyanEnd = true;
                }
                if (ev.code === BAOYAN_BAD) {
                    eventRecord.updateDiv("推免失败");
                }
                if (ev.code === TIAOJI_GOOD) {
                    eventRecord.updateDiv("调剂成功");
                    flagKaoshangYan = true;
                }
                if (ev.code === TIAOJI_BAD) {
                    eventRecord.updateDiv("调剂失败");
                    flagKaoshangYan = false;
                }
                if (ev.code === CODE_GONGZUO) {
                    eventRecord.updateDiv("找到工作了");
                }

                specialEventList.div.style.display = "flex";

            },

            getEvent: function (player) {
                //随机获取当前事件

                //找工作事件
                if (player.semester === 8 && player.round > 2) {
                    if (flagGongzuo3) {
                        return seventGongzuo3;
                    }
                    if (flagGongzuo2) {
                        return seventGongzuo2;
                    }
                    if (flagGongzuo1) {
                        return seventGongzuo1;
                    }
                    return seventGongzuo0;
                }

                //判定特殊路线后续剧情
                if (player.semester % 2 === 1) {
                    switch (eventPhase) {
                        case 1: {
                            if (player.year === 4) {
                                break;
                            }
                            if (flagXueShengHui && player.battle >= P1_BATTLE_LIMIT) {
                                return rXsh1;
                            }
                            if (flagNobel && player.intelligence <= P1_IQ_LIMIT && player.battle >= P1_BATTLE_LIMIT) {
                                return rNobel1;
                            }
                            if (flagGuGuZhen && player.money >= 2000 && player.battle >= P1_BATTLE_LIMIT) {
                                return rGGZ1;
                            }
                            break;
                        }
                        case 2: {
                            if (player.year === 4) {
                                break;
                            }
                            if (flagXueShengHui && player.battle >= P2_BATTLE_LIMIT) {
                                return rXsh2;
                            }
                            if (flagNobel && player.battle >= P2_BATTLE_LIMIT && player.intelligence <= P2_IQ_LIMIT) {
                                return rNobel2;
                            }
                            if (flagGuGuZhen && player.battle >= P2_BATTLE_LIMIT && player.money >= 5000) {
                                return rGGZ2;
                            }
                            break;
                        }
                        case 3: {
                            if (flagXueShengHui && player.battle >= P3_BATTLE_LIMIT) {
                                return rXsh3;
                            }
                            if (flagNobel && player.battle >= P3_BATTLE_LIMIT && player.intelligence <= P3_IQ_LIMIT) {
                                return rNobel3;
                            }
                            if (flagGuGuZhen && player.battle >= P3_BATTLE_LIMIT && player.money >= 20000) {
                                return rGGZ3;
                            }
                            break;
                        }
                    };
                }

                //再判定大四上学期特殊事件
                if (player.semester === 7) {
                    //保研事件
                    if (flagBaoyan2 || flagBaoyan1) {
                        if (numFailedExam > 0) {
                            return seventBaoyanBad;
                        }
                        return seventBaoyanGood;
                    } else if (flagBaoyan3) {
                        if (player.univRank >= 9 || !flagRongYu || numFailedExam > 0) {
                            return seventBaoyanBad;
                        }
                        return seventBaoyanGood;
                    }
                }

                //判定大四下学期特殊事件
                if (player.semester === 8) {
                    //考研调剂事件
                    if (flagKaoYan1) {
                        if (tiaojiShangan(player)) {
                            return seventTiaojiGood;
                        } else {
                            return seventTiaojiBad;
                        }

                    }
                }


                //大一上学期，先判定奖学金相关事件
                if (player.year === 1 && player.wealth <= 3 && player.semester % 2 === 1) {
                    //第一年、家境值不超过3，获得贫困补助
                    return seventPinKunRenDing;
                } else if (flagPinKunBuZhu && player.year > 1 && player.semester % 2 === 1) {  //补助、奖学金事件，都仅在上半学期触发
                    //贫困生资格的情况下，依次判定 国奖+贫困补助； 励志+贫困补助； 贫困补助
                    //为简化程序计算，用以往学期总绩点代替上学年绩点
                    if (player.tgpa > GUOJIANG_LIMIT) {
                        return seventPinKunGuoJiang;
                    } else if (player.tgpa > LIZHI_LIMIT) {
                        return seventLiZhi;
                    } else if (player.tgpa > XUEYE_LIMIT) {
                        return seventPinKunXueYe;
                    } else {
                        return seventPinKunBuZhu;
                    };
                } else if (player.year > 1 && player.semester % 2 === 1 && player.tgpa > GUOJIANG_LIMIT) {
                    return seventGuoJiang;
                } else if (player.year > 1 && player.semester % 2 === 1 && player.tgpa > XUEYE_LIMIT) {
                    return seventXueYe;
                }

                //没有获得奖学金的情况下，继续各结局路线相关事件判定
                if (player.year === 1 && player.semester % 2 === 1) {
                    //第一年时随机给出各路线前置事件，不发生其它随机事件。
                    let z = getRandomInteger(0, 2);
                    return seQianZhi[z];
                }


                //如果没进入重要路线，则判定发生哪些随机事件。

                let a = getRandomInteger(0, 100);
                if (a > 50 + player.risk - player.luck) {
                    let b = getRandomInteger(0, 200);
                    if (b < player.risk) {
                        let c = getRandomInteger(0, 4); //随机事件列表都是五个五个一组
                        return vbadSeventList[c];
                    } else {
                        let c = getRandomInteger(0, 4);
                        //大四下学期不发生绩点相关事件
                        if (badSeventList[c] === seventKeGai && player.semester === 8) {
                            lunwenBase -= 10;
                            return seventKeGaiDasi;
                        }
                        return badSeventList[c];
                    }
                } else {
                    let b = getRandomInteger(0, 100);
                    if (b < player.luck) {
                        let c = getRandomInteger(0, 4);
                        //大四下学期不发生绩点相关事件
                        if (player.semester === 8 && c === 0) {
                            let d = getRandomInteger(1, 4);
                            return vgoodSeventList[d];
                        }
                        return vgoodSeventList[c];
                    } else {
                        let c = getRandomInteger(0, 4);
                        //大四下学期不发生绩点相关事件
                        if (goodSeventList[c] === seventShiJuan && player.semester === 8) {
                            lunwenBase += 20;
                            return seventShiJuanDasi;
                        }
                        return goodSeventList[c];
                    }
                }


            }

        }
        //学期规划栏
        const schoolTodoList = {

            title: document.createElement("h3"),

            button1: document.createElement("button"),
            button2: document.createElement("button"),
            button3: document.createElement("button"),
            button4: document.createElement("button"),
            button5: document.createElement("button"),

            des1: document.createElement("p"),
            des2: document.createElement("p"),
            des3: document.createElement("p"),
            des4: document.createElement("p"),
            des5: document.createElement("p"),

            bfbox1: document.createElement("div"),
            bfbox2: document.createElement("div"),
            bfbox3: document.createElement("div"),
            bfbox4: document.createElement("div"),
            bfbox5: document.createElement("div"),

            div: document.createElement("div"),
            //以下两个用来传参
            cplans: zeroStrengthPlans,
            cplayer: null,


            createDiv: function () {
                //初始化
                this.cplans = zeroStrengthPlans;
                this.cplayer = null;

                //button没有checked属性，不好传参，索性写五个函数
                this.button1.addEventListener("click", schoolTodoList.updateAttrB1);
                this.button2.addEventListener("click", schoolTodoList.updateAttrB2);
                this.button3.addEventListener("click", schoolTodoList.updateAttrB3);
                this.button4.addEventListener("click", schoolTodoList.updateAttrB4);
                this.button5.addEventListener("click", schoolTodoList.updateAttrB5);

                this.button1.className = "splan-button";
                this.bfbox1.className = "splan-buttonbox";

                this.button2.className = "splan-button";
                this.bfbox2.className = "splan-buttonbox";

                this.button3.className = "splan-button";
                this.bfbox3.className = "splan-buttonbox";

                this.button4.className = "splan-button";
                this.bfbox4.className = "splan-buttonbox";

                this.button5.className = "splan-button";
                this.bfbox5.className = "splan-buttonbox";

                this.title.className = "splan-title";

                this.bfbox1.appendChild(this.button1);
                this.bfbox1.appendChild(this.des1);
                this.bfbox2.appendChild(this.button2);
                this.bfbox2.appendChild(this.des2);
                this.bfbox3.appendChild(this.button3);
                this.bfbox3.appendChild(this.des3);
                this.bfbox4.appendChild(this.button4);
                this.bfbox4.appendChild(this.des4);
                this.bfbox5.appendChild(this.button5);
                this.bfbox5.appendChild(this.des5);

                this.div.appendChild(this.title);
                this.div.appendChild(this.bfbox1);
                this.div.appendChild(this.bfbox2);
                this.div.appendChild(this.bfbox3);
                this.div.appendChild(this.bfbox4);
                this.div.appendChild(this.bfbox5);

                this.div.className = "splan-container";
                this.div.style.display = "none";

                return this.div;
            },

            showPlan: function (player) {

                schoolTodoList.cplayer = player;

                if (schoolTodoList.cplayer.round > 2 && schoolTodoList.cplayer.semester === 8 && !jobpageDone) {
                    if (flagQiuzhi) {
                        //跳转特殊事件找工作界面
                        schoolTodoList.div.style.display = "none";
                        jobpageDone = true;
                        specialEventList.showDiv(player);
                        return;
                    }
                }


                //每学期可以做三次规划。拟通过player的属性控制
                if (schoolTodoList.cplayer.round > 2) {
                    schoolTodoList.cplayer.round = 0;
                    schoolTodoList.div.style.display = "none";
                    transPage.showDiv();
                    return;
                }

                //做完第一次规划后，进入特殊事件环节
                if (schoolTodoList.cplayer.round === 1 && !specialDone) {
                    schoolTodoList.div.style.display = "none";
                    specialEventList.showDiv(player);
                    return;
                }

                testEnd(schoolTodoList.cplayer);
                if (isEnd)
                    return;

                schoolTodoList.button1.disabled = false;
                schoolTodoList.button2.disabled = false;
                schoolTodoList.button3.disabled = false;
                schoolTodoList.button4.disabled = false;
                schoolTodoList.button5.disabled = false;

                schoolTodoList.title.textContent = "接下来要做什么？（本学期第" + (schoolTodoList.cplayer.round + 1).toString() + "/3次规划）";

                schoolTodoList.div.style.display = "flex";

                schoolTodoList.cplans = schoolTodoList.getPlans();

                schoolTodoList.button1.textContent = schoolTodoList.cplans[0].text;
                schoolTodoList.des1.textContent = schoolTodoList.cplans[0].description;
                schoolTodoList.button2.textContent = schoolTodoList.cplans[1].text;
                schoolTodoList.des2.textContent = schoolTodoList.cplans[1].description;
                schoolTodoList.button3.textContent = schoolTodoList.cplans[2].text;
                schoolTodoList.des3.textContent = schoolTodoList.cplans[2].description;
                schoolTodoList.button4.textContent = schoolTodoList.cplans[3].text;
                schoolTodoList.des4.textContent = schoolTodoList.cplans[3].description;
                schoolTodoList.button5.textContent = schoolTodoList.cplans[4].text;
                schoolTodoList.des5.textContent = schoolTodoList.cplans[4].description;

                if (schoolTodoList.cplans === zeroStrengthPlans) {
                    schoolTodoList.button2.disabled = true;
                    schoolTodoList.button3.disabled = true;
                    schoolTodoList.button4.disabled = true;
                    schoolTodoList.button5.disabled = true;

                    schoolTodoList.des2.textContent = "没有体力了，啥都干不动。";
                    schoolTodoList.des3.textContent = "没有体力了，啥都干不动。";
                    schoolTodoList.des4.textContent = "没有体力了，啥都干不动。";
                    schoolTodoList.des5.textContent = "没有体力了，啥都干不动。";
                }

                if (schoolTodoList.cplans === zeroMoneyPlans) {
                    schoolTodoList.button2.disabled = true;
                    schoolTodoList.button3.disabled = true;
                    schoolTodoList.button4.disabled = true;
                    schoolTodoList.button5.disabled = true;

                    schoolTodoList.des2.textContent = "赚钱要紧";
                    schoolTodoList.des3.textContent = "赚钱要紧";
                    schoolTodoList.des4.textContent = "赚钱要紧";
                    schoolTodoList.des5.textContent = "赚钱要紧";
                }

                //对大四上、大四下规划的特殊处理
                if (schoolTodoList.cplans === DaSiShangSplanList) {
                    if (schoolTodoList.cplayer.money < 5000) {
                        schoolTodoList.button4.disabled = true;
                        schoolTodoList.button5.disabled = true;
                        schoolTodoList.des4.textContent = "你钱够吗？";
                        schoolTodoList.des5.textContent = "你钱够吗？";
                    }
                    if (schoolTodoList.cplayer.money < 2000) {
                        schoolTodoList.button3.disabled = true;
                        schoolTodoList.des3.textContent = "你钱够吗？";
                    }
                }

                if (schoolTodoList.cplans === DaSiXiaSplanList) {
                    if (schoolTodoList.cplayer.money < 20000) {
                        schoolTodoList.button5.disabled = true;
                        schoolTodoList.des5.textContent = "你钱够吗？";
                    }
                    if (schoolTodoList.cplayer.money < 5000) {
                        schoolTodoList.button4.disabled = true;
                        schoolTodoList.des4.textContent = "你钱够吗？";
                    }
                    if (schoolTodoList.cplayer.money < 2000) {
                        schoolTodoList.button3.disabled = true;
                        schoolTodoList.des3.textContent = "你钱够吗？";
                    }
                }

            },

            updateAttrB1: function () {
                (schoolTodoList.cplans[0]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB2: function () {
                (schoolTodoList.cplans[1]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB3: function () {
                (schoolTodoList.cplans[2]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB4: function () {
                (schoolTodoList.cplans[3]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            updateAttrB5: function () {
                (schoolTodoList.cplans[4]).updateAttr(schoolTodoList.cplayer);
                statusBanner.updateDiv(schoolTodoList.cplayer);
                schoolTodoList.cplayer.round++;
                schoolTodoList.showPlan(schoolTodoList.cplayer);
            },

            getPlans: function () {

                let chosenPlans = [];

                if (this.cplayer.horizon > HORIZON_EX_LIMIT && this.cplayer.money >= MONEY_EX_LIMIT) {
                    let npm = selectRandomPlans(middleSplanList, 2);
                    let nph = selectRandomPlans(highSplanList, 2);
                    let npex = selectRandomPlans(exSplanList, 1);

                    npm.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    nph.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    chosenPlans.push(npex[0]);
                } else if (this.cplayer.horizon > HORIZON_H_LIMIT && this.cplayer.money >= MONEY_H_LIMIT) {

                    let npl = selectRandomPlans(lowSplanList, 2);
                    let npm = selectRandomPlans(middleSplanList, 2);
                    let nph = selectRandomPlans(highSplanList, 1);

                    npl.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    npm.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    chosenPlans.push(nph[0]);
                } else if (this.cplayer.horizon > HORIZON_M_LIMIT && this.cplayer.money >= MONEY_M_LIMIT) {

                    let npl = selectRandomPlans(lowSplanList, 3);
                    let npm = selectRandomPlans(middleSplanList, 2);

                    npl.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    npm.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                } else {
                    let npl = selectRandomPlans(lowSplanList, 4);
                    let npm = selectRandomPlans(middleSplanList, 1);

                    npl.forEach(function (element) {
                        chosenPlans.push(element);
                    });
                    chosenPlans.push(npm[0]);
                }

                if (this.cplayer.strength <= 0) {
                    return zeroStrengthPlans;
                }

                if (this.cplayer.money <= 0) {
                    return zeroMoneyPlans;
                }

                if (this.cplayer.semester === 7) {
                    return DaSiShangSplanList;
                }

                if (this.cplayer.semester === 8) {
                    return DaSiXiaSplanList;
                }

                return chosenPlans;
            }
        }
        //期末考试成绩界面
        const examReport = {
            title: document.createElement("h3"),
            subtitle: document.createElement("h4"),
            para1: document.createElement("p"),
            para2: document.createElement("p"),
            para3: document.createElement("p"),
            para4: document.createElement("p"),
            submit: document.createElement("button"),
            div: document.createElement("div"),
            text1: "本学期，你选修了",
            text2: "门课。成绩分别为：",
            text3: "你通过了",
            text4: "门课，挂了",
            text5: "门课。",
            text6: "你本学期的绩点为：",
            textTBD: "--",
            cplayer: null,

            createDiv: function (player) {
                //初始化
                this.cplayer = player;
                this.title.textContent = "期末考试成绩单";
                this.subtitle.textContent = "大一上学期";
                this.para1.textContent = this.text1 + this.textTBD + this.text2;
                this.para2.textContent = this.textTBD;
                this.para3.textContent = this.text3 + this.textTBD + this.text4 + this.textTBD + this.text5;
                this.para4.textContent = this.text6 + this.textTBD;
                this.submit.textContent = "收到";
                this.submit.onclick = () => {
                    this.div.style.display = "none";
                    //先处理游戏结束的情况
                    if (player.semester === 8) {
                        if (flagXuewei) {
                            //双证齐全的情况
                            //按结局从好到坏依次判定
                            if (flagGongzuo3 && flagKaoYan3) {
                                setGameover(examReport.cplayer, PERFECT_END);
                            } else if (flagGongzuo3) {
                                setGameover(examReport.cplayer, GONGZUO3_END);
                            } else if (flagKaoYan3) {
                                setGameover(examReport.cplayer, KAOYAN_END);
                            } else if (flagKaoYan2) {
                                setGameover(examReport.cplayer, KAOYAN_END);
                            } else if (flagGongzuo2) {
                                setGameover(examReport.cplayer, GONGZUO2_END);
                            } else if (flagKaoYan1 && flagKaoshangYan) {
                                setGameover(examReport.cplayer, KAOYAN_END);
                            } else if (!flagGongzuo1) {
                                setGameover(examReport.cplayer, BIYE_SHIYE_END);
                            } else {
                                setGameover(examReport.cplayer, GONGZUO1_END);
                            }
                        } else if (flagDanbiye) {
                            //单证。按结局从好到坏依次判定
                            if (flagGongzuo1) {
                                setGameover(examReport.cplayer, GONGZUO1_END);
                            } else {
                                setGameover(examReport.cplayer, DANBIYE_END);
                            }
                        } else {
                            //结业
                            setGameover(examReport.cplayer, JIEYE_END);
                        }
                        return;
                    }
                    setVacationPage(this.cplayer, globalVocDivPointer);
                }
                this.div.appendChild(this.title);
                this.div.appendChild(this.subtitle);
                this.div.appendChild(this.para1);
                this.div.appendChild(this.para2);
                this.div.appendChild(this.para3);
                this.div.appendChild(this.para4);
                this.div.appendChild(this.submit);

                this.div.style.display = "none";
                this.div.className = "exam-container";
                this.title.className = "exam-title";
                this.subtitle.className = "exam-subtitle";
                this.para1.className = "exam-para";
                this.para2.className = "exam-para";
                this.para3.className = "exam-para";
                this.para4.className = "exam-para";
                this.submit.className = "exam-button";
                return this.div;
            },

            showGraduateDiv: function (player) {
                examReport.title.textContent = "毕业答辩";
                examReport.subtitle.textContent = "大四下学期";
                if (numFailedExam <= 2) {
                    examReport.para1.textContent = "毕业答辩满分100分。经专家讨论，你的得分是：";
                    let sc = calLunwen(player);
                    examReport.para2.textContent = sc.toString();
                    if (sc < 60) {
                        flagDanbiye = true;  //毕业证单证
                        examReport.para3.textContent = "没通过毕业答辩，拿不到学位证！";
                        if ((flagKaoshangYan || flagGongzuo3 || flagGongzuo2) && !flagGongzuo1) {
                            this.para4.textContent = "没有学位证，考研、找工作的事也黄了……";
                        } else if (flagGongzuo1) {
                            this.para4.textContent = "黑作坊老板答应你，没有学位证也能去上班。真是不幸中的万幸。";
                        } else {
                            this.para4.textContent = "转念一想，你既没考上研究生，也没找到工作。拿不到学位证对你没任何影响。你释然了。";
                        }
                    } else {
                        flagXuewei = true;   //毕业证+学位证
                        examReport.para3.textContent = "答辩委员会同意授予你学士学位。";
                        if (flagKaoshangYan || flagGongzuo3 || flagGongzuo2) {
                            this.para4.textContent = "前途一片光明！";
                        } else if (flagGongzuo1) {
                            this.para4.textContent = "收拾收拾去当牛马吧。";
                        } else {
                            this.para4.textContent = "毕业即失业，但好歹毕业证学位证都拿到手了。";
                        }
                    }
                } else {
                    flagJieye = true;   //结业证
                    examReport.para1.textContent = "你惊奇地发现，答辩名单上没你名字！";
                    examReport.para2.textContent = "你打电话问辅导员，才知道自己因为挂科太多，根本就没进入答辩流程。";
                    examReport.para3.textContent = "事后，你拿到了结业证书";
                    if (flagKaoshangYan || flagGongzuo3 || flagGongzuo2) {
                        this.para4.textContent = "只拿到结业证，考上的研、找到的工作都黄了。";
                    } else if (flagGongzuo1) {
                        this.para4.textContent = "好在黑作坊老板不挑，只有结业证也能去当牛马。";
                    } else {
                        this.para4.textContent = "好在你本来就一事无成，毕不毕业都一样。";
                    }
                }
                this.div.style.display = "flex";
            },

            updateDiv: function (player) {
                //最后一学期是毕业论文
                if (player.semester === 8) {
                    examReport.showGraduateDiv(player);
                    return;
                }

                //计算期末考试成绩
                //先查询玩家上的哪所大学。rank与大学一一对应，用rank查。
                let univ = univList.find(un => un.rank === player.univRank);
                //再计算期末考多少门课、考试基础难度。和专业、年级有关。
                let exNum = 0;
                let exbase = player.examBase;
                switch (player.major) {
                    case ART_MAJOR: {
                        exNum = ART_NUM;
                        exbase += ART_DIFF;
                        break;
                    }
                    case SOCIAL_MAJOR: {
                        exNum = SOCIAL_NUM;
                        exbase += SOCIAL_DIFF;
                        break;
                    }
                    case ENGINEER_MAJOR: {
                        exNum = ENGINEER_NUM;
                        exbase += ENGINEER_DIFF;
                        break;
                    }
                    case SCIENCE_MAJOR: {
                        exNum = SCIENCE_NUM;
                        exbase += SCIENCE_DIFF;
                        break;
                    }
                    case MEDICAL_MAJOR: {
                        exNum = MEDICAL_NUM;
                        exbase += MEDICAL_DIFF;
                        break;
                    }
                }

                //大二、大三时，多加一门课
                if (player.year === 2 || player.year === 3) {
                    exNum++;
                }
                //一年增加两点智力的情况下，对考试下限修正是+10。
                if (player.univRank <= 4) {
                    exbase -= (player.year - 1) * 20;
                } else if (player.univRank <= 8) {
                    exbase -= (player.year - 1) * 15;
                } else {
                    exbase -= (player.year - 1) * 10;
                }
                //通关特典加成
                if (flagJuanWang) {
                    exbase += 30;
                }
                //为方便后续补考程序，将更新后的exbase再传回去
                player.examBase = exbase;
                let score = calFinalExam(player.intelligence, exbase, univ, exNum, player.luck);
                //score是一个数组。数组元素是0-100的数，代表每门课考多少分；数组长度是考试门数。
                let gpa = calExamGPA(score);
                //该函数接受一个以0-100计分的数组，计算每门课绩点，再返回一个0-400的数表示平均绩点。
                let cNum = score.length;
                switch (player.year) {
                    case 1: {
                        this.subtitle.textContent = "大一";
                        break;
                    }
                    case 2: {
                        this.subtitle.textContent = "大二";
                        break;
                    }
                    case 3: {
                        this.subtitle.textContent = "大三";
                        break;
                    }
                    case 4: {
                        this.subtitle.textContent = "大四";
                        break;
                    }
                };
                if (player.semester % 2 === 0) {
                    this.subtitle.textContent += "下学期";
                } else {
                    this.subtitle.textContent += "上学期";
                };
                let sText = "";

                for (let i = 0; i < cNum; i++) {
                    //百分制成绩换算成各等级
                    if (score[i] >= ALLimit) {
                        sText += "A";
                    } else if (score[i] >= AminusLLimit) {
                        sText += "A-";
                    } else if (score[i] >= BplusLLimit) {
                        sText += "B+";
                    } else if (score[i] >= BLLimit) {
                        sText += "B";
                    } else if (score[i] >= BminusLLimit) {
                        sText += "B-";
                    } else if (score[i] >= CplusLLimit) {
                        sText += "C+";
                    } else if (score[i] >= CLLimit) {
                        sText += "C";
                    } else if (score[i] >= CminusLLimit) {
                        sText += "C-";
                    } else if (score[i] >= DLLimit) {
                        sText += "D";
                    } else {
                        sText += "F";
                    }
                    if (i < score.length - 1) {
                        sText += "，";
                    } else {
                        sText += "。";
                    }
                };

                let pCourse = score.filter(element => element >= 60);
                let pNum = pCourse.length;
                let fCourse = score.filter(element => element < 60);
                let fNum = fCourse.length;
                let sgpa = (0.01 * gpa).toFixed(2);

                numCurrentFail = fNum;
                let gpaarray = score2GPA(score);
                for (let i = 0; i < score.length; i++) {
                    totalGPAArray.push(gpaarray[i]);
                }
                let tgpa = gpaArray2GPA(totalGPAArray);  //之前学期总绩点
                this.para1.textContent = this.text1 + cNum.toString() + this.text2;
                this.para2.textContent = sText;
                this.para3.textContent = this.text3 + pNum.toString() + this.text4 + fNum.toString() + this.text5;
                this.para4.textContent = this.text6 + sgpa.toString();
                gradeReport.updateDiv(gpa, tgpa, player.major, pNum);
                player.cgpa = gpa;
                player.tgpa = tgpa;
                this.div.style.display = "flex";
            }
        }
        //挂科补考栏
        const examResit = {
            title: document.createElement("h3"),
            div1: document.createElement("div"),
            div2: document.createElement("div"),
            div3: document.createElement("div"),
            button: document.createElement("button"),
            div: document.createElement("div"),
            done: false,  //表示补考前、补考后
            cplayer: null,

            createDiv: function (player) {
                this.cplayer = player;
                this.div1.innerHTML = "";
                this.div2.innerHTML = "";
                this.div3.innerHTML = "";
                this.title.textContent = "开学补考";
                this.button.textContent = "点我开始补考";

                this.button.onclick = () => {
                    //补考后
                    if (examResit.done) {
                        examResit.done = false;
                        examResit.button.textContent = "点我开始补考";
                        examResit.div1.innerHTML = "";
                        examResit.div2.innerHTML = "";
                        examResit.div3.innerHTML = "";
                        examResit.div.style.display = "none";
                        //跳转到学期规划界面。因为这是新学期的开头，所以学年、学期等数据不在此变更。
                        examResit.cplayer.examBase = 0;
                        schoolTodoList.showPlan(examResit.cplayer);
                        return;
                    }
                    //补考前
                    let exnum = numCurrentFail;
                    numCurrentFail = 0;
                    let exbase = examResit.cplayer.examBase;
                    exbase += 5;
                    examResit.cplayer.examBase = 0;
                    let univ = univList.find(un => un.rank === (examResit.cplayer).univRank);
                    let inte = examResit.cplayer.intelligence;
                    let luck = examResit.cplayer.luck;

                    let score = calFinalExam(inte, exbase, univ, exnum, luck);
                    let pCourse = score.filter(element => element >= 60);
                    let pNum = pCourse.length;
                    let fCourse = score.filter(element => element < 60);
                    let fNum = fCourse.length;

                    examResit.div2.textContent = pNum.toString() + "门课补考后合格，成绩记录变更为“P”。";
                    if (fNum > 0) {
                        examResit.div2.textContent += fNum.toString() + "门课仍然不合格，维持“F”的记录。";
                    };

                    //更新成绩记录
                    let j = 0;
                    for (let i = 0; i < totalGPAArray.length; i++) {
                        if (j >= pNum) {
                            break;
                        }
                        //补考通过pNum门课，将成绩记录里pNum门不合格的课改为补考合格
                        if (totalGPAArray[i] === 0) {
                            totalGPAArray[i] = 100;  // 补考合格P对应绩点1.00
                            j++;
                        }
                    }

                    let tgpa = gpaArray2GPA(totalGPAArray);

                    //处理挂科的学业警告
                    if (fNum > 0) {
                        //第一次挂科
                        if (numFailedExam === 0 && fNum <= 2) {
                            gradeReport.appendWarning("挂科了，失去保研资格！");
                        } else if (numFailedExam <= 2 && numFailedExam + fNum > 2) {
                            //第一次触发学业预警
                            gradeReport.appendWarning("你挂了超过两门课，触发学业预警。挂五门课即退学，务必端正学习态度。");
                        }
                        numFailedExam += fNum;
                        if (numFailedExam >= 5) {
                            //挂科太多，直接结束游戏
                            setGameover(examResit.cplayer, GUAKE_END);
                        }
                    }

                    gradeReport.updateDiv(TBDGPA, tgpa, player.major, pNum);
                    examResit.div3.textContent = "总成绩单已更新，请自行查看。"
                    examResit.button.textContent = "知道了";
                    examResit.done = true;
                }

                this.div.appendChild(this.title);
                this.div.appendChild(this.div1);
                this.div.appendChild(this.div2);
                this.div.appendChild(this.div3);
                this.div.appendChild(this.button);
                this.div.className = "resit-container";
                this.title.className = "resit-title";
                this.div1.className = "resit-div";
                this.div2.className = "resit-div";
                this.div3.className = "resit-div";
                this.button.className = "resit-button";

                examResit.div.style.display = "none";
                return this.div;

            },

            updateDiv: function () {
                //补考时已进入新学期
                let exnum = numCurrentFail;
                this.div1.textContent = "你上学期挂了" + exnum.toString() + "门课。"
                examResit.div.style.display = "flex";
            }


        }
        //学年总结
        const yearReport = {
            title: document.createElement("h3"),
            div1: document.createElement("div"),
            div2: document.createElement("div"),
            div3: document.createElement("div"),
            div4: document.createElement("div"),
            button: document.createElement("button"),
            div: document.createElement("div"),
            cplayer: null,

            createDiv: function (player) {
                this.cplayer = player;
                this.title.textContent = "学年总结";
                this.button.textContent = "开启新学年";
                this.div.appendChild(this.title);
                this.div.appendChild(this.div1);
                this.div.appendChild(this.div2);
                this.div.appendChild(this.div3);
                this.div.appendChild(this.div4);
                this.div.appendChild(this.button);
                this.div.style.display = "none";

                this.button.onclick = () => {
                    yearReport.cplayer.year++;
                    yearReport.cplayer.semester++;
                    gradeReport.updateDiv(TBDGPA, yearReport.cplayer.tgpa, yearReport.cplayer.major, 0);
                    titleBanner.updateDiv(yearReport.cplayer);
                    yearReport.div.style.display = "none";
                    if (numCurrentFail > 0) {
                        examResit.updateDiv();
                    } else {
                        yearReport.cplayer.examBase = 0;
                        schoolTodoList.showPlan(yearReport.cplayer);
                    }
                }
                this.div.className = "yearr-container";
                this.title.className = "yearr-title";
                this.div1.className = "yearr-div";
                this.div2.className = "yearr-div";
                this.div3.className = "yearr-div";
                this.div4.className = "yearr-div";
                this.button.className = "yearr-button";

                return this.div;
            },

            updateDiv: function () {
                //此函数同时更新各项数据
                let univ = univList.find(un => un.rank === (yearReport.cplayer).univRank);
                //计算学校给玩家的年度加成
                univ.update(yearReport.cplayer);
                yearReport.div1.textContent = "一年过去，增长了不少知识。（基础属性提升。）";

                //计算收支
                let fac = yearReport.cplayer.finance;  //财商提供的收入系数
                if (fac > 50) {
                    fac = 50;
                }
                if (fac < 0) {
                    fac = 0;
                }

                //财商提供的理财收入
                let fmoney = Math.floor(0.01 * fac * yearReport.cplayer.money);
                fmoney += fac * 500;

                //家里给的生活费
                let wmoney = yearReport.cplayer.wealth * yearReport.cplayer.wealth * 100;

                let income = fmoney + wmoney - univ.fee;

                this.div2.textContent = "被动理财收入" + fmoney.toString() + "元（与财商、现有资金相关），家里给的生活费" + wmoney.toString() + "元（与家境有关），学费" + univ.fee.toString() + "元。";
                this.div3.textContent = "净收支" + income.toString() + "元。";

                yearReport.cplayer.money += income;

                this.div4.textContent = "明年也要继续努力。";

                statusBanner.updateDiv(yearReport.cplayer);
                yearReport.div.style.display = "flex";

            }
        }
        //过渡界面
        const tranKeyframes = [
            { transform: "rotate(0) scale(1)" },
            { transform: "rotate(360deg) scale(0)" },
        ];
        const tranParams = {
            duration: 1000,
            iteration: 1,
        };
        const transPage = {
            rotDiv: document.createElement("div"),
            text1: document.createElement("div"),
            text2: document.createElement("div"),
            cplayer: null,  //用来传参
            isrunning: false,  //避免动画出错

            createDiv: function (player) {
                let div = document.createElement("div");
                this.text1.textContent = "11";
                this.text2.textContent = "22";
                this.text1.className = "trans-text";
                this.text2.className = "trans-text";
                this.rotDiv.appendChild(this.text1);
                this.rotDiv.appendChild(this.text2);
                this.rotDiv.addEventListener("click", transPage.rotate);
                div.appendChild(this.rotDiv);
                this.rotDiv.className = "trans-container";
                this.rotDiv.style.display = "none";
                this.cplayer = player;
                this.isrunning = false;
                return div;
            },

            showDiv: function () {
                this.text1.textContent = "考试周到了";
                this.text2.textContent = "点我开始期末考试";
                this.rotDiv.style.display = "flex";
                //最后一学期写毕业论文，不上课。
                if (transPage.cplayer.semester === 8) {
                    this.text1.textContent = "终于写完毕业论文了";
                    this.text2.textContent = "点我开始毕业答辩";
                }
            },

            rotate: function () {
                if (transPage.isrunning) {
                    return;
                }
                //检测浏览器是否支持
                if ("animate" in document.body) {
                    transPage.isrunning = true;
                    transPage.rotDiv.animate(tranKeyframes, tranParams).finished.then(() => {
                        //等动画结束后，执行后续操作
                        transPage.rotDiv.style.display = "none"; //隐藏本页面
                        transPage.isrunning = false;
                        if (transPage.cplayer.semester === 8) {
                            examReport.showGraduateDiv(transPage.cplayer);
                            return;
                        }
                        examReport.updateDiv(transPage.cplayer);
                    }).catch((error) => {
                        console.error("动画出错：", error);
                        transPage.isrunning = false;
                        alert("哎呀，出错啦。请再试一遍。");
                    });
                } else {
                    //处理不支持动画的情况
                    console.log("浏览器不支持动画，直接跳过");
                    transPage.rotDiv.style.display = "none";
                    transPage.isrunning = false;
                    if (transPage.cplayer.semester === 8) {
                        examReport.showGraduateDiv(transPage.cplayer);
                        return;
                    }
                    examReport.updateDiv(transPage.cplayer);
                }
            }
        }


        //总成绩单
        const gradeReport = {
            title: document.createElement("h3"),
            currentGPA: document.createElement("p"), //本学期GPA
            totalGPA: document.createElement("p"), //总GPA
            failCourse: document.createElement("p"), //挂科数
            passCourse: document.createElement("p"), //已修课程数
            gradeWarning: document.createElement("div"), //相关警告

            currentGPAText1: "本学期绩点：",
            currentGPANum: 0,
            totalGPAText1: "总学分绩：",
            totalGPANum: 0,
            failCourseText1: "挂科数：",
            failCourseNum: 0,
            passCourseText1: "已通过课程数：",
            passCourseNum: 0,
            textTBD: "--",

            createDiv: function (major) {
                this.title.textContent = "成绩单";

                //考虑到多周目游戏里，相关值可能被改变。调用该函数初始化时，应将相关值置零。
                this.currentGPANum = 0;
                this.totalGPANum = 0;
                this.failCourseNum = 0;
                this.passCourseNum = 0;
                this.gradeWarning.innerHTML = "";

                this.currentGPA.textContent = this.currentGPAText1 + this.textTBD;
                this.totalGPA.textContent = this.totalGPAText1 + this.textTBD;
                this.failCourse.textContent = this.failCourseText1 + this.failCourseNum.toString();
                this.passCourse.textContent = this.passCourseText1 + this.passCourseNum.toString();

                switch (major) {
                    case artMajorCode: {
                        this.passCourse.textContent += ("/" + artTotalCourseNum.toString());
                        break;
                    }
                    case socialMajorCode: {
                        this.passCourse.textContent += ("/" + socialTotalCourseNum.toString());
                        break;
                    }
                    case engineerMajorCode: {
                        this.passCourse.textContent += ("/" + engineerTotalCourseNum.toString());
                        break;
                    }
                    case scienceMajorCode: {
                        this.passCourse.textContent += ("/" + scienceTotalCourseNum.toString());
                        break;
                    }
                    case medicalMajorCode: {
                        this.passCourse.textContent += ("/" + medicalTotalCourseNum.toString());
                        break;
                    }
                    default:
                        break;
                };

                let div = document.createElement("div");
                div.appendChild(this.title);
                div.appendChild(this.currentGPA);
                div.appendChild(this.totalGPA);
                div.appendChild(this.failCourse);
                div.appendChild(this.passCourse);
                div.appendChild(this.gradeWarning);
                div.className = "sidebar";
                return div;
            },

            updateDiv: function (cGPA, tGPA, major, pnum) {
                //cGPA表示当前学期GPA
                //tGPA表示总GPA
                this.currentGPA.textContent = this.currentGPAText1 + ((0.01 * cGPA).toFixed(2)).toString() + "/4.00";
                this.totalGPA.textContent = this.totalGPAText1 + ((0.01 * tGPA).toFixed(2)).toString() + "/4.00";
                this.failCourse.textContent = this.failCourseText1 + (numCurrentFail + numFailedExam).toString();
                gradeReport.passCourseNum += pnum;
                this.passCourse.textContent = this.passCourseText1 + (this.passCourseNum).toString();

                if (cGPA === TBDGPA) {
                    this.currentGPA.textContent = this.currentGPAText1 + this.textTBD;
                }

                switch (major) {
                    case artMajorCode: {
                        this.passCourse.textContent += ("/" + artTotalCourseNum.toString());
                        break;
                    }
                    case socialMajorCode: {
                        this.passCourse.textContent += ("/" + socialTotalCourseNum.toString());
                        break;
                    }
                    case engineerMajorCode: {
                        this.passCourse.textContent += ("/" + engineerTotalCourseNum.toString());
                        break;
                    }
                    case scienceMajorCode: {
                        this.passCourse.textContent += ("/" + scienceTotalCourseNum.toString());
                        break;
                    }
                    case medicalMajorCode: {
                        this.passCourse.textContent += ("/" + medicalTotalCourseNum.toString());
                        break;
                    }
                    default:
                        break;
                };

            },

            appendWarning: function (msg) {
                //学业警告信息
                let p = document.createElement("p");
                p.textContent = msg;
                this.gradeWarning.appendChild(p);
            }

        }

    </script>
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        ul li {
            list-style-type: none;
        }

        /*Github角标样式*/
        .github-corner {
            z-index: 999;
            position: sticky;
            top: 0;
        }


        /*欢迎页设置*/
        .welcome-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .welcome-flex {
            text-align: center;
        }

        .wfirst {
            font-size: 2em;
            margin-bottom: 40px;
        }

        .wsecond {
            font-size: 1.5em;
            margin-bottom: 80px;
        }

        .wbutton {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 2em;
            cursor: pointer;
            border-radius: 5px;
        }



        /*选专业页设置*/
        .major-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .major-title {
            font-size: 1.5em;
            margin-bottom: 20px;

        }

        .major-rgroup {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin-bottom: 20px;
        }

        .major-ritem {
            font-size: 1.5em;
            display: flex;
            align-items: center;
            margin-bottom: 25px;
        }


        .major-page input {

            border-radius: 50%;
            width: 16px;
            height: 16px;

            border: 2px solid #999;
            transition: 0.2s all linear;
            margin-right: 5px;

            position: relative;
        }

        .major-page input:checked {
            border: 6px solid black;
        }

        .major-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
        }

        /*填志愿页设置*/
        .apply-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .apply-title {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .apply-container {
            display: flex;
            flex-direction: column;
        }

        .apply-univname {
            font-size: 1.2em;
        }

        .apply-univtext {
            margin-top: 5px;
        }

        .apply-univcontainer {
            display: flex;
            flex-direction: column;
            margin-bottom: 15px;
            background-color: rgb(242, 241, 233);
            border: 1px solid rgb(200, 233, 245);
            /* 普通的边框 */
            border-width: 2px;
            /* 边框宽度 */
            border-style: solid;
            /* 边框样式 */
            border-radius: 5px;
            /* 边框圆角 */
        }

        .apply-univcontainer.done {
            background-color: lightblue;
            border-color: red;
        }





        /*
    .apply-description {
      font-size: 1.5em;
      margin-bottom: 20px;
    }
    
    .apply-univ {
      font-size: 1em;
      margin-bottom: 15px;
      display: flex;
      flex-direction: column;
      width: 40%;
      background-color: beige;
    }
    
    .apply-univ-label {
      font-size: 1.2em;
      height: 65%;
    }
    */

        .apply-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 0.9em;
            cursor: pointer;
            border-radius: 5px;
            margin-top: 20px;
        }

        /*录取页设置*/
        .admission-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .admission-title {
            font-size: 1.7em;
            margin-bottom: 35px;
        }

        .admission-txt {
            font-size: 1.3em;
            margin-bottom: 50px;
        }

        .admission-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }


        /*主页面*/




        .mTitle {
            text-align: center;
            padding: 20px;
            background-color: #f1f1f1;
        }

        .statusBar {
            overflow: hidden;
            background-color: #333;
            text-align: center;
            padding: 30px;
            position: sticky;
            top: 0;
        }

        .status-span {
            padding: 14px;
            color: white;
            white-space: nowrap;
            /* 避免状态栏在奇怪的地方换行  */
        }

        .plain-status-span {
            padding: 5px;
            font-weight: normal;
            color: white;
        }

        .warning-status-span {
            color: #FF6666;
            font-weight: bold;
        }

        .bcontainer {
            display: flex;
            flex-wrap: wrap;
        }

        .sidebar {
            width: 100%;
            /*显示在小屏幕上时为100%宽度*/
            background-color: #f1f1f1;
            padding: 15px;
            box-sizing: border-box;
            align-items: center;
            justify-content: center;
        }

        .ccontainer {
            width: 100%;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* 媒体查询：当屏幕宽度大于600px时，应用以下样式 */
        @media screen and (min-width: 600px) {
            .sidebar {
                width: 20%;
                /* 在大屏幕上侧边栏宽度为20% */
            }

            .ccontainer {
                width: 60%;
                /* 在大屏幕上内容宽度为60% */
            }

            .bcontainer {
                flex-direction: row;
            }
        }

        /* 学期规划界面 */
        .splan-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
        }

        .splan-title {
            font-size: 1.4em;
            margin-bottom: 25px;
        }

        .splan-buttonbox {
            align-items: center;
            justify-content: center;
            display: flex;
            flex-direction: column;
            font-size: 1em;
            margin-bottom: 15px;
            background-color: #333;
            color: white;
            text-align: center;
        }

        .splan-button {
            width: 75%;
            padding: 5px 5px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 特殊事件界面 */
        .sevent-container {
            padding: 15px;
            display: flex;
            flex-direction: column;
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .sevent-title {
            font-size: 1.3em;
            margin-bottom: 30px;
        }

        .sevent-para1 {
            padding: 15px;
            font-size: 1.3em;
            margin-bottom: 40px;
            background-color: #f1f1f1;
            width: 50%;
            text-align: center;
            justify-content: center;
            align-items: center;
        }

        .sevent-para2 {
            background-color: #f1f1f1;
            width: 50%;
            padding: 10px;
            text-align: center;
            margin-bottom: 30px;
            justify-content: center;
            align-items: center;
            line-height: 150%;
        }

        .sevent-button {
            padding: 5px;
            font-size: 1.2em;
            width: 30%;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 转场页  */
        .trans-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: lightyellow;
        }

        .trans-text {
            font-size: 1.3em;
            margin-bottom: 20px;
        }


        /* 期末考试页  */
        .exam-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f1f1f1;
        }

        .exam-title {
            font-size: 1.5em;
            margin-bottom: 15px;
        }

        .exam-subtitle {
            font-size: 1.2em;
            margin-bottom: 20px;
        }

        .exam-para {
            margin-bottom: 10px;
        }

        .exam-button {
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 假期事件页 */
        .vacation-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .vacation-title {
            font-size: 1.5em;
            margin-bottom: 25px;
        }

        .vacation-div1 {
            font-size: 1.3em;
            margin-bottom: 10px;
        }

        .vacation-div2 {
            margin-bottom: 20px;
            line-height: 150%;
        }

        .vacation-button {
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }

        /* 补考页 */
        .resit-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .resit-title {
            font-size: 1.5em;
            margin-bottom: 25px;
        }

        .vacation-div {
            margin-bottom: 10px;
        }

        .resit-button {
            margin-top: 35px;
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }







        /*  学年总结页  */
        .yearr-container {
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            background-color: #f1f1f1;
        }

        .yearr-title {
            font-size: 1.5em;
            margin-bottom: 30px;
        }

        .yearr-div {
            line-height: 150%;
            margin-bottom: 5px;
        }

        .yearr-button {
            padding: 10px;
            text-align: center;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
            background-color: lightgray;
        }




        /* 结局页相关  */

        .gameover-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .gameover-title {
            font-size: 2em;
            margin-bottom: 10px;
        }

        .gameover-subtitle {
            font-size: 1.5em;
            margin-bottom: 20px;
        }

        .gameover-container {
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        .gameover-button {
            margin-top: 30px;
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }



        /*  结算页相关   */

        .enddata-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .enddata-title {
            font-size: 2em;
            margin-bottom: 40px;
            text-align: center;
        }

        .enddata-container {
            margin-bottom: 10px;
            font-size: 1.2em;
            line-height: 150%;
        }

        .enddata-rankdiv {
            text-align: center;
            margin-bottom: 30px;
            font-size: 1.4em;
        }

        .enddata-button {
            padding: 10px 20px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1.2em;
            cursor: pointer;
            border-radius: 5px;
        }


        .attr-rating-S {
            color: red;
        }

        .attr-rating-A {
            color: gold;
        }

        .attr-rating-B {
            color: green;
        }

        .attr-rating-C {
            color: lightblue;
        }

        .attr-rating-D {
            color: darkblue;
        }

        .attr-rating-E {
            color: dimgrey;
        }

        .end-rating-S {
            color: red;
        }

        .end-rating-A {
            color: gold;
        }

        .end-rating-B {
            color: green;
        }

        .end-rating-C {
            color: lightblue;
        }

        .end-rating-D {
            color: darkblue;
        }

        .end-rating-E {
            color: dimgrey;
        }



        /* 通关特典页面  */

        .gift-page {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            background-color: #f7f7f7;
            padding: 20px;
        }

        .gift-rating-S {
            color: red;
        }

        .gift-rating-A {
            color: gold;
        }

        .gift-rating-B {
            color: lightgreen;
        }

        .gift-rating-C {
            color: lightblue;
        }

        .gift-rating-D {
            color: darkblue;
        }

        .gift-rating-E {
            color: black;
        }

        .gift-title {
            font-size: 1.5em;
            margin-bottom: 20px;
            text-align: center;
        }

        .gift-container {
            margin-bottom: 35px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .gift-item {
            padding: 10px;
            background: #9f9e9e;
            margin-bottom: 10px;
            border: 1px solid rgb(200, 233, 245);
            /* 普通的边框 */
            border-width: 2px;
            /* 边框宽度 */
            border-style: solid;
            /* 边框样式 */
            border-radius: 5px;
            /* 边框圆角 */
        }

        .gift-item.done {
            background: #5691ff;
            border-color: red;
        }

        .gift-button {
            padding: 10px;
            background-color: #333;
            color: white;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 1em;
            cursor: pointer;
            border-radius: 5px;
        }
    </style>

    <title>大学模拟器</title>
</head>

<body style="margin: 0; height: 100%">
    <a href="https://github.com/lingch16/UnivSimulator" target="_blank" class="github-corner"
        title="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250"
            style="fill:#333; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);"
            aria-hidden="true">
            <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
            <path
                d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2"
                fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
            <path
                d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z"
                fill="currentColor" class="octo-body"></path>
        </svg>
    </a>
    <div class="welcome-page">
        <div class="welcome-flex wfirst">
            <h1>高考终于出分了！</h1>
        </div>

        <div class="welcome-flex wsecond">
            <p>现在快来</p>
        </div>

        <div class="welcome-flex">
            <button id="startButton" class="wbutton" disabled>加载中...</button>
        </div>

    </div>


    <script>//选专业界面
        function setMajorPage(player) {

            //清空之前的页面
            document.body.innerHTML = "";
            //document.body.innerHTML = githubCorner;

            let title = document.createElement("h2");
            title.textContent = "选择一个喜欢的专业吧：";

            let majorTDiv = document.createElement("div");
            majorTDiv.appendChild(title);



            let optionArt = document.createElement("input");
            let optionSoc = document.createElement("input");
            let optionEng = document.createElement("input");
            let optionSci = document.createElement("input");
            let optionMed = document.createElement("input");
            let labelArt = document.createElement("label");
            let labelSoc = document.createElement("label");
            let labelEng = document.createElement("label");
            let labelSci = document.createElement("label");
            let labelMed = document.createElement("label");

            optionArt.type = "radio";
            optionArt.name = "majorChoose";
            optionArt.id = "choiceArt";
            optionArt.value = "art";

            optionSoc.type = "radio";
            optionSoc.name = "majorChoose";
            optionSoc.id = "choiceSoc";
            optionSoc.value = "soc";

            optionEng.type = "radio";
            optionEng.name = "majorChoose";
            optionEng.id = "choiceEng";
            optionEng.value = "eng";

            optionSci.type = "radio";
            optionSci.name = "majorChoose";
            optionSci.id = "choiceSci";
            optionSci.value = "sci";

            optionMed.type = "radio";
            optionMed.name = "majorChoose";
            optionMed.id = "choiceMed";
            optionMed.value = "med";

            labelArt.htmlFor = optionArt.id;
            labelSoc.htmlFor = optionSoc.id;
            labelEng.htmlFor = optionEng.id;
            labelSci.htmlFor = optionSci.id;
            labelMed.htmlFor = optionMed.id;

            labelArt.textContent = "纯文科（期末考试简单）";
            labelSoc.textContent = "经管法等社科类（比较均衡）";
            labelEng.textContent = "新工科类专业（好找工作）";
            labelSci.textContent = "基础科学（更容易保研）";
            labelMed.textContent = "医科专业（高难，建议二周目再选）";

            let majorGroupDiv = document.createElement("div");

            let majorItemDiv1 = document.createElement("div");
            let majorItemDiv2 = document.createElement("div");
            let majorItemDiv3 = document.createElement("div");
            let majorItemDiv4 = document.createElement("div");
            let majorItemDiv5 = document.createElement("div");

            majorItemDiv1.appendChild(optionArt);
            majorItemDiv1.appendChild(labelArt);

            majorItemDiv2.appendChild(optionSoc);
            majorItemDiv2.appendChild(labelSoc);

            majorItemDiv3.appendChild(optionEng);
            majorItemDiv3.appendChild(labelEng);

            majorItemDiv4.appendChild(optionSci);
            majorItemDiv4.appendChild(labelSci);

            majorItemDiv5.appendChild(optionMed);
            majorItemDiv5.appendChild(labelMed);

            let submit = document.createElement("button");
            submit.textContent = "确定";

            majorTDiv.className = "major-title";

            majorGroupDiv.className = "major-rgroup";

            majorItemDiv1.className = "major-ritem";
            majorItemDiv2.className = "major-ritem";
            majorItemDiv3.className = "major-ritem";
            majorItemDiv4.className = "major-ritem";
            majorItemDiv5.className = "major-ritem";

            majorGroupDiv.appendChild(majorItemDiv1);
            majorGroupDiv.appendChild(majorItemDiv2);
            majorGroupDiv.appendChild(majorItemDiv3);
            majorGroupDiv.appendChild(majorItemDiv4);
            majorGroupDiv.appendChild(majorItemDiv5);

            submit.className = "major-button";

            let majorPageDiv = document.createElement("div");
            majorPageDiv.appendChild(majorTDiv);
            majorPageDiv.appendChild(majorGroupDiv);
            majorPageDiv.appendChild(submit);
            majorPageDiv.className = "major-page";

            submit.onclick = () => {

                let choice = document.querySelector('input[name="majorChoose"]:checked');

                if (!choice) {
                    alert("请选择一个选项");
                    return;
                }

                switch (choice.value) {
                    case optionArt.value: {
                        player.major = artMajorCode;
                        break;
                    }
                    case optionSoc.value: {
                        player.major = socialMajorCode;
                        break;
                    }
                    case optionEng.value: {
                        player.major = engineerMajorCode;
                        break;
                    }
                    case optionSci.value: {
                        player.major = scienceMajorCode;
                        break;
                    }
                    case optionMed.value: {
                        player.major = medicalMajorCode;
                        player.risk += 10;    //增加游戏难度
                        break;
                    }
                }
                optionArt = null;
                optionSoc = null;
                optionEng = null;
                optionSci = null;
                optionMed = null;
                labelArt = null;
                labelSoc = null;
                labelEng = null;
                labelSci = null;
                labelMed = null;
                submit = null;
                div = null;
                setCollegeApplyPage(player);
            };

            document.body.appendChild(majorPageDiv);

        }

        //主程序
        function setUnivGame(my) {
            //页面布局
            let mainDiv = document.createElement("div");


            let mainTitle = titleBanner.createDiv();     //最上方的标题

            let statusDiv = statusBanner.createDiv(my);   //上方的状态栏，显示体力、心情、精力、金钱

            let eventDiv = eventRecord.createDiv();  //重要事件列表，靠左显示

            let centerContainer = document.createElement("div"); //中间的显示界面

            let schoolPlanDiv = schoolTodoList.createDiv();  //学期规划栏
            let specialeventDiv = specialEventList.createDiv(my);  //特殊事件栏
            let examContainer = examReport.createDiv(my);  //期末考试成绩显示栏
            let transDiv = transPage.createDiv(my); //转场动画页
            globalVocDivPointer = document.createElement("div"); //假期事件栏
            let examresitDiv = examResit.createDiv(my); //挂科开学补考页
            let yearrDiv = yearReport.createDiv(my);  //学年总结页

            centerContainer.appendChild(schoolPlanDiv);
            centerContainer.appendChild(specialeventDiv);
            centerContainer.appendChild(examContainer);
            centerContainer.appendChild(transDiv);
            centerContainer.appendChild(globalVocDivPointer);
            centerContainer.appendChild(examresitDiv);
            centerContainer.appendChild(yearrDiv);
            centerContainer.className = "ccontainer";

            let gradeDiv = gradeReport.createDiv(my.major); //总成绩单，靠右侧显示

            let bigContainer = document.createElement("div"); //标题、状态栏下面的全部
            bigContainer.className = "bcontainer";
            bigContainer.appendChild(eventDiv);
            bigContainer.appendChild(centerContainer);
            bigContainer.appendChild(gradeDiv);


            mainDiv.appendChild(mainTitle);
            mainDiv.appendChild(statusDiv);
            mainDiv.appendChild(bigContainer);

            document.body.appendChild(mainDiv);


            my.year = 1;
            my.semester = 1;

            //更新页面设置

            titleBanner.updateDiv(my);
            schoolTodoList.showPlan(my);




        }

        //录取通知书页
        function setAdmissionLetterPage(collegeRank, player) {

            let title = document.createElement("h2");
            let text = document.createElement("h3");
            let college = univList.find((univ) => univ.rank === collegeRank);

            if (collegeRank < rankexUniv.rank) {
                title.textContent = "恭喜！";
            } else {
                title.textContent = "你滑档了！";
            }
            text.textContent = "你被" + college.name + "录取了";

            let admissionDiv = document.createElement("div");
            admissionDiv.className = "admission-page";

            let atDiv = document.createElement("div");
            atDiv.className = "admission-title";
            let atxtDiv = document.createElement("div");
            atxtDiv.className = "admission-txt";

            atDiv.appendChild(title);
            atxtDiv.appendChild(text);

            let okButton = document.createElement("button");
            okButton.textContent = "点我开启大学生活";
            okButton.className = "admission-button";
            okButton.onclick = function () {

                document.body.removeChild(admissionDiv);
                admissionDiv = null;

                setUnivGame(player);

            }

            admissionDiv.appendChild(atDiv);
            admissionDiv.appendChild(atxtDiv);
            admissionDiv.appendChild(okButton);
            document.body.appendChild(admissionDiv);

        }

        //志愿填报页面
        function setCollegeApplyPage(currentPlayer) {
            //删除之前页面
            document.body.innerHTML = "";
            //document.body.innerHTML = githubCorner;

            let collegeApplyDiv = document.createElement("div");
            collegeApplyDiv.className = "apply-page";
            let applyContainer = document.createElement("div");
            applyContainer.className = "apply-container";

            let title = document.createElement("h2");
            title.textContent = "志愿填报"
            title.className = "apply-title";

            let description1 = document.createElement("h3");
            description1.className = "apply-description";

            switch (currentPlayer.intelligence) {
                case 10:
                    description1.textContent = "你的高考位次：省状元";
                    break;
                case 9:
                    description1.textContent = "你的高考位次：市状元";
                    break;
                case 8:
                    description1.textContent = "你的高考位次：万里挑一";
                    break;
                case 7:
                    description1.textContent = "你的高考分：顶尖高校提档线";
                    break;
                case 6:
                    description1.textContent = "你的高考成绩：全校第一";
                    break;
                case 5:
                    description1.textContent = "你的高考位次：百里挑一";
                    break;
                case 4:
                    description1.textContent = "你的高考成绩：班级前十";
                    break;
                case 3:
                    description1.textContent = "你的高考成绩：中等偏上";
                    break;
                case 2:
                    description1.textContent = "你的高考分：只有平均分";
                    break;
                case 1:
                    description1.textContent = "你的高考分：勉勉强强";
                    break;
                default:
                    description1.textContent = "你的高考分：不大理想";
                    break;
            }

            if (currentPlayer.intelligence > 10) {
                description1.textContent = "你的高考成绩：刷新历史记录";
            }


            let description2 = document.createElement("h3");
            description2.className = "apply-description";
            description2.textContent = "志愿规划师为你推荐了五所学校，按去年录取分数线从高到低的顺序，排列如下。请选择其中三所。"

            collegeApplyDiv.appendChild(title);
            collegeApplyDiv.appendChild(description1);
            collegeApplyDiv.appendChild(description2);

            //用随机生成的智商代替高考分数，作为填志愿的依据。填报成功失败与院校排名和智商有关。    
            //@HazukiKaguya：
            //优化志愿填报页面院校逻辑

            //第一梯队填报的第五个志愿从第二梯队中随机抽取；
            let tier1UnivList = [...goodUniv];
            tier1UnivList.push(fairUniv[getRandomInteger(0, 4)]);

            //第二梯队填报的第五个志愿从第三梯队中随机抽取，前四个志愿为第二梯队的五个随机删去一个；
            let fairRandomUnivList = [...fairUniv];
            fairRandomUnivList.splice(getRandomInteger(0, 4), 1);
            let tier2UnivList = [...fairRandomUnivList];
            tier2UnivList.push(poorUniv[getRandomInteger(0, 2)]); //poorUniv数组有四个元素，最后一个是tier4的学校。这里只在前三个tier3的学校间随机抽。

            //第三梯队填报的第一个志愿从第二梯队中随机抽取
            let tier3UnivList = [fairUniv[getRandomInteger(0, 4)]];
            tier3UnivList.push(...poorUniv);

            let currentUnivList = [];
            if (currentPlayer.intelligence >= 6) {
                currentUnivList = [...tier1UnivList];
            } else if (currentPlayer.intelligence >= 3) {
                currentUnivList = [...tier2UnivList];
            } else {
                currentUnivList = [...tier3UnivList];
            }


            let myCollege = [];
            let pass = [];

            //设置复选框
            let selectedunivnames = [];

            for (let i = 0; i < currentUnivList.length; i++) {
                let cdiv = document.createElement("div");
                let cdiv1 = document.createElement("div");
                let cdiv2 = document.createElement("div");
                cdiv.className = "apply-univcontainer";
                cdiv1.className = "apply-univname";
                cdiv2.className = "apply-univtext";
                cdiv1.textContent = currentUnivList[i].name;
                cdiv2.textContent = currentUnivList[i].text;
                cdiv.appendChild(cdiv1);
                cdiv.appendChild(cdiv2);
                applyContainer.appendChild(cdiv);
                cdiv.addEventListener("click", function () {
                    if (this.classList.contains("done")) {
                        let index = selectedunivnames.indexOf(cdiv1.textContent);
                        if (index !== -1) {
                            selectedunivnames.splice(index, 1);
                        }
                        this.classList.toggle("done");
                        return;
                    }
                    if (selectedunivnames.length >= 3) {
                        alert("最多选择三所学校");
                        return;
                    }
                    this.classList.toggle("done");
                    selectedunivnames.push(cdiv1.textContent);
                })
            }


            let submitButton = document.createElement("button");
            submitButton.textContent = "确定";
            submitButton.className = "apply-button";

            submitButton.onclick = () => {
                //获取选择项
                if (selectedunivnames.length < 3) {
                    alert("请选择三所学校");
                    return;
                }

                for (let i = 0; i < selectedunivnames.length; i++) {
                    let uv = univList.find(element => element.name === selectedunivnames[i]);
                    myCollege.push(uv);
                }
                if (myCollege.length === 3) {
                    //依次检查是否被录取
                    myCollege.sort(function (a, b) {
                        return a.rank - b.rank
                    });
                    for (let j = 0; j < myCollege.length; j++) {
                        let admissionProbability = currentPlayer.intelligence * 4 + myCollege[j].tier * 10 + myCollege[j].rank;
                        let testNumber = getRandomInteger(0, 100);  //获取0到100间的随机数
                        if (admissionProbability >= testNumber) {
                            pass.push(myCollege[j]);
                        }
                    }
                    if (pass.length === 0) {
                        currentPlayer.univRank = rankexUniv.rank;
                    } else {
                        currentPlayer.univRank = pass[0].rank;
                    }
                    //省、市状元不会滑档
                    if (currentPlayer.intelligence >= 10) {
                        currentPlayer.univRank = myCollege[0].rank;
                    }
                    if ((currentPlayer.intelligence === 9) && (currentPlayer.univRank !== myCollege[0].rank)) {
                        currentPlayer.univRank = myCollege[1].rank;
                    }
                    document.body.removeChild(collegeApplyDiv);
                    collegeApplyDiv = null;
                    setAdmissionLetterPage(currentPlayer.univRank, currentPlayer);
                } else {
                    myCollege = [];
                    pass = [];
                    alert("请选择三所学校");
                    return;
                }
            }

            collegeApplyDiv.appendChild(applyContainer);
            collegeApplyDiv.appendChild(submitButton);
            document.body.appendChild(collegeApplyDiv);
        }

        window.onload = function () {
            let btn = document.getElementById('startButton');
            btn.disabled = false;
            btn.textContent = '填志愿';
            btn.addEventListener("click", setGame);
        };


        //上大学前
        function setGame() {
            // 初始化玩家信息。尚未实装的功能用TBD表示。
            //分别是 姓名、性别、家境、心情、体力、精力、智商、眼界、财商、幸运、风险、资金、年级、所上大学排名（初始值100）、专业代码（初始值0）、学期规划轮次（用于跟踪学期规划决断次数、期末考试成绩基础随机下限）、战斗力（初始值5）、学期（取值0-8，初始为0）、上学期绩点、总绩点
            let my = new Player("TBD", "TBD", 0, 100, 100, 100, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 5, 0, 0, 0);
            //通关特典待实装
            //随机给出玩家初始属性。计算通关特典加成。
            initializePlayerBuild(my, giftnone, giftnone);
            //上大学前
            setMajorPage(my);
        }



        //假期页面
        function setVacationPage(my, div) {

            let title = document.createElement("h3");
            title.textContent = "假期事件";

            let div1 = document.createElement("div");
            let div2 = document.createElement("div");

            let button = document.createElement("button");
            button.textContent = "知道了";



            //根据是否挂科、年级学期等，显示各假期事件
            if (numCurrentFail > 0 && my.semester != 7 && my.semester != 2) {
                //挂科的情况下，显示复习补考界面
                //第七学期是考研事件，不能跳过。
                div1.textContent = "补考";
                div2.textContent = "挂科了，老老实实在家复习补考吧。（极大幅度消耗心情、精力、体力，提升补考通过率。）";
                my.examBase += 10;
                my.strength -= 25;
                my.spirit -= 25;
                my.mood -= 25;
            } else if (my.semester === 1) {
                div1.textContent = "准备四级考试";
                div2.textContent = "下学期可以考英语四级。要想保研，必须通过四级。将来考研、找工作，通过英语四级也是加分项。利用这个假期，好好准备吧。（消耗心情、精力、体力，大幅提升四级通过概率。）";
                cetBase = 200;
                my.strength -= 10;
                my.spirit -= 10;
                my.mood -= 10;
            } else if (my.semester === 2) {
                div1.textContent = "四级成绩发布";
                let score = calCetScore(my);
                if (score < 425) {
                    div2.textContent = "大学英语四级满分710，你考了" + score.toString() + "分。痛失保研资格。";
                    gradeReport.appendWarning("没通过四级，失去保研资格！");
                } else {
                    div2.textContent = "大学英语四级满分710，你考了" + score.toString() + "分。通过大学英语四级，未来一片光明。";
                    eventRecord.updateDiv("通过了英语四级");
                    flagCet = true;
                }
            } else if (my.semester === 3) {
                div1.textContent = "准备暑期实习";
                div2.textContent = "听说实习或项目经历很重要。虽说现在还是寒假，但凡事要趁早。现在不提前准备，暑假找不到就麻烦了。（消耗心情、精力、体力，大幅提升找到实习的概率。）";
                my.strength -= 10;
                my.spirit -= 10;
                my.mood -= 10;
                shixiBase = 20;
            } else if (my.semester === 4) {
                div1.textContent = "暑期实习";
                let sx = calShixi(my);
                if (sx === 3) {
                    div2.textContent = "找到一份非常好的实习，从中收获很多。不但能写进简历里，技能水平也实打实地提高了。（极大幅度提升眼界、财商、战斗力、智力。）";
                    my.horizon += 5;
                    my.finance += 5;
                    my.intelligence += 5;
                    my.battle += 5;
                    flagShixi = true;
                    eventRecord.updateDiv("实习经历get");
                } else if (sx === 2) {
                    div2.textContent = "找到一份实习。辛辛苦苦干了一暑假，累是累点，但确实有收获。（较大幅度提升眼界、财商，消耗体力。）";
                    my.horizon += 3;
                    my.finance += 3;
                    my.strength -= 10;
                    flagShixi = true;
                    eventRecord.updateDiv("实习经历get");
                } else if (sx === 1) {
                    div2.textContent = "只找到辣鸡实习。被辅导员忽悠去校友的黑心企业打白工，干了一暑假。除了张废纸一样的实习证明，啥都没拿到。（大幅消耗体力。）";
                    my.strength -= 20;
                    flagShixi = true;
                    eventRecord.updateDiv("实习经历get");
                } else {
                    div2.textContent = "投了十几份简历出去，全部石沉大海。一份像样的实习都没找到。心累。（大幅消耗心情、精力。）";
                    my.mood -= 20;
                    my.spirit -= 20;
                }
            } else if (my.semester === 5) {
                //分考研和保研两条线
                if (numFailedExam > 0 || !flagCet) {
                    div1.textContent = "复习考研";
                    div2.textContent = "离考研还有一年，你并不认为自己能坚持下来。但周围同学都开始准备了，你也只好加入考研大军。（较大幅度消耗体力、心情、精力，提升考研分数。）";
                    my.strength -= 15;
                    my.mood -= 15;
                    my.spirit -= 15;
                    kaoyanBase += 50;
                } else {
                    div1.textContent = "准备保研";
                    div2.textContent = "总之，先把简历改漂亮一点。再到网上找往年夏令营笔试题，随手做一做吧。（较大幅度提高智力。）";
                    my.intelligence += 3;
                }
            } else if (my.semester === 6) {
                //同样，分考研和保研两条线
                let tgpa = gpaArray2GPA(totalGPAArray);
                if (numFailedExam > 0 || !flagCet) {
                    div1.textContent = "复习考研";
                    div2.textContent = "离考研只剩半年不到，正是最后冲刺阶段。复习效率杠杠的。（大幅消耗体力、精力，大幅提升考研分数。）";
                    my.strength -= 20;
                    my.spirit -= 20;
                    kaoyanBase += 150;
                } else if (tgpa > 300) {
                    div1.textContent = "保研夏令营";
                    let by = calBaoYan(my);
                    if (by === 3) {
                        div2.textContent = "参加顶尖名校的夏令营，被评为优秀营员！和一堆神仙打架，费尽千辛万苦脱颖而出，前途一片光明。（大幅消耗精力。）";
                        my.spirit -= 20;
                        eventRecord.updateDiv("提前锁定名校研究生");
                        flagBaoyan3 = true;
                    } else if (by === 2) {
                        div2.textContent = "参加了一堆学校的保研夏令营，结果只拿到很一般学校的优营。为什么会这样呢？（大幅降低心情、精力。）";
                        my.spirit -= 20;
                        my.mood -= 20;
                        flagBaoyan2 = true;
                        eventRecord.updateDiv("大概能保研");
                    } else if (by === 1) {
                        div2.textContent = "几乎全部夏令营都一轮游了。别人都在等待面试，你笔试被刷直接先回去了。只有一所非常辣鸡的大学给你发offer。心态崩了。";
                        my.mood -= 50;
                        flagBaoyan1 = true;
                        eventRecord.updateDiv("能保研，但不如不保");
                    } else {
                        div2.textContent = "整个暑假都在外面跑，结果却颗粒无收，保研全拒得。你感到身心俱疲。";
                        my.mood -= 40;
                        my.strength -= 40;
                        my.spirit -= 40;
                    }
                } else {
                    div1.textContent = "转投考研";
                    div2.textContent = "绩点太低，怎么看都拿不到保研资格。你认清现实，抓紧时间复习考研。现在还来得及。（大幅消耗体力、精力、心情，较大幅度提高考研分数。）";
                    my.strength -= 20;
                    my.mood -= 20;
                    my.spirit -= 20;
                    kaoyanBase = 100;
                }
            } else {   //第七学期发生最后一个假期事件。  
                //保研提前进入结局，这里只有考研线
                let ky = calKaoYan(my);
                div1.textContent = "考研成绩公布";
                if (ky === 3) {
                    div2.textContent = "初试第一进面，怎么看都稳了。哪怕把老师揍一顿，都照样能读研究生。就是这么自信。";
                    eventRecord.updateDiv("考上了名校研究生");
                    flagKaoYan3 = true;
                    flagKaoYan2 = false;
                    flagKaoYan1 = false;
                    flagKaoshangYan = true;
                } else if (ky === 2) {
                    div2.textContent = "考得比想象中好。早知道能考这么高，就报更好的学校了。唉，知足常乐，有书读总比没有好。学校差就差点吧。";
                    eventRecord.updateDiv("考上研究生");
                    flagKaoYan2 = true;
                    flagKaoYan3 = false;
                    flagKaoyan1 = false;
                    flagKaoshangYan = true;
                } else if (ky === 1) {
                    div2.textContent = "考研初试没过线。这学校好恶心啊，压分压得忒狠。只能联系调剂了。（心情大幅降低。）";
                    my.mood -= 20;
                    flagKaoYan1 = true;
                    flagKaoYan3 = false;
                    flagKaoYan2 = false;
                    flagKaoshangYan = false;
                } else {
                    div2.textContent = "总分4开头，但只有两位数，联系调剂的功夫也省了。你自己都被整笑了。（恢复心情。）";
                    my.mood += 10;
                    flagKaoYan3 = false;
                    flagKaoYan2 = false;
                    flagKaoYan1 = false;
                    flagKaoshangYan = false;
                }

            }

            statusBanner.updateDiv(my);

            div.className = "vacation-container";
            title.className = "vacation-title";
            div1.className = "vacation-div1";
            div2.className = "vacation-div2";
            button.className = "vacation-button";

            div.appendChild(title);
            div.appendChild(div1);
            div.appendChild(div2);
            div.appendChild(button);

            button.onclick = () => {
                div.removeChild(title);
                div.removeChild(div1);
                div.removeChild(div2);
                div.removeChild(button);
                specialDone = false;
                testEnd(my);
                if (isEnd)
                    return;

                if (my.semester % 2 === 1) {
                    //上半学期，不显示学年总结。跳转至下一学期规划。挂科的情况下，先跳转补考页面
                    my.semester++;
                    gradeReport.updateDiv(TBDGPA, my.tgpa, my.major, 0);
                    titleBanner.updateDiv(my);
                    if (numCurrentFail > 0) {
                        //跳转补考页
                        examResit.updateDiv();
                        return;
                    } else {
                        //不挂科的情况下，直接跳转学期规划。此时因为numCurrentFail必为0，无需再置零
                        my.examBase = 0;
                        schoolTodoList.showPlan(my);
                        return;
                    }
                } else {
                    //跳转学年总结页
                    yearReport.updateDiv();
                    return;
                }

            }

        }

        //判断游戏是否结束

        function testEnd(player) {
            //依次计算心情、体力、精力
            let z = getRandomInteger(15, 100);
            let x = z - player.risk + player.battle + player.luck;
            let mood = player.mood;
            let strength = player.strength;
            let spirit = player.spirit;
            let endflag = 0;

            if (mood < 0 && mood + x < 0) {
                endflag = MOOD_END;
                isEnd = true;
            } else if (strength < 0 && strength + x < 0) {
                endflag = STRENGTH_END;
                isEnd = true;
            } else if (spirit < 0 && spirit + x < 0) {
                endflag = SPIRIT_END;
                isEnd = true;
            } else if (x < 0) {
                if (player.year === 4) {
                    switch (player.major) {
                        case artMajorCode:
                            endflag = ART_END;
                            break;
                        case socialMajorCode:
                            endflag = SOC_END;
                            break;
                        case engineerMajorCode:
                            endflag = ENG_END;
                            break;
                        case scienceMajorCode:
                            endflag = SCI_END;
                            break;
                        case medicalMajorCode:
                            endflag = MED_END;
                            break;
                    }
                } else {
                    endflag = RISK_END;
                }
                isEnd = true;
            }

            setGameover(player, endflag);
            return;
        }

        //显示结局画面
        function setGameover(my, endflag) {

            if (endflag === 0) {
                return;
            }

            document.body.innerHTML = githubCorner;

            let mainpage = document.createElement("div");
            mainpage.className = "gameover-page";

            let title = document.createElement("h1");
            let titleContainer = document.createElement("div");
            titleContainer.className = "gameover-title";

            titleContainer.appendChild(title);

            let subtitle = document.createElement("h3");
            let subtitleContainer = document.createElement("div");
            subtitleContainer.appendChild(subtitle);
            subtitleContainer.className = "gameover-subtitle";

            let text = document.createElement("p");
            let textContainer = document.createElement("div");
            textContainer.appendChild(text);
            textContainer.className = "gameover-container";

            let button = document.createElement("button");
            button.textContent = "点我进入结算页";
            button.className = "gameover-button";

            button.onclick = () => {
                setEnddataPage(my, endflag);
            }

            mainpage.appendChild(titleContainer);
            mainpage.appendChild(subtitleContainer);
            mainpage.appendChild(textContainer);
            mainpage.appendChild(button);

            switch (endflag) {
                case MOOD_END: {
                    subtitle.textContent = "郁郁而终";
                    text.textContent = "下辈子对自己好点。多出去散散心，别把自己憋坏了。";
                    title.textContent = "寄！";
                    break;
                }
                case STRENGTH_END: {
                    subtitle.textContent = "过劳死";
                    text.textContent = "居然能活活累死了，太强了！";
                    title.textContent = "寄！";
                    break;
                }
                case SPIRIT_END: {
                    subtitle.textContent = "行尸走肉";
                    text.textContent = "没精力做任何事了。看似还有一口气，其实早就能埋掉了。";
                    title.textContent = "寄！";
                    break;
                }
                case RISK_END: {
                    subtitle.textContent = "猝死";
                    text.textContent = "你坏事做尽，被天收了。真是苍天有眼。愿你下辈子做个好人。";
                    title.textContent = "寄！";
                    break;
                }
                case ART_END: {
                    subtitle.textContent = "顿悟";
                    text.textContent = "临近毕业，你突然发现眼前的一切不过是表象与幻觉。你毅然投入泥头车的怀抱，转生幻想乡。";
                    title.textContent = "寄！";
                    break;
                }
                case SOC_END: {
                    subtitle.textContent = "提篮桥进修";
                    text.textContent = "大家都在做假账，偏偏就你被抓了。可能是败人品的事做多了？愿你下辈子做个好人。";
                    title.textContent = "寄！";
                    break;
                }
                case ENG_END: {
                    subtitle.textContent = "背锅侠";
                    text.textContent = "“你是安全员，不抓你抓谁？”“靠，我TM负责的是信息安全！”";
                    title.textContent = "寄！";
                    break;
                }
                case SCI_END: {
                    subtitle.textContent = "实验室爆炸";
                    text.textContent = "“师兄，这个烧杯在冒泡诶。”“啊？”";
                    title.textContent = "寄！";
                    break;
                }
                case MED_END: {
                    subtitle.textContent = "医闹";
                    text.textContent = "“庸医，受死吧！”“我只是路过的实习生，你别过来啊。”";
                    title.textContent = "寄！";
                    break;
                }
                case GUAKE_END: {
                    subtitle.textContent = "退学通知书";
                    text.textContent = "你补考后仍有五门或以上课程不合格。根据我校学生管理规定，对你做退学处理。就算你有异议，也不允许申诉。  （教务处）";
                    title.textContent = "寄！";
                    break;
                }
                case PERFECT_END: {
                    subtitle.textContent = "圆满落幕";
                    text.textContent = "考研工作两手抓。既拿到名校的研究生offer，又能进大厂。人生跟开了挂一样。";
                    title.textContent = "完美通关";
                    break;
                }
                case BAOYAN_END: {
                    subtitle.textContent = "保送研究生";
                    text.textContent = "三年的努力有了回报。以梦为马，不负韶华。";
                    title.textContent = "未来可期";
                    break;
                }
                case KAOYAN_END: {
                    subtitle.textContent = "考上研究生";
                    text.textContent = "顺利从大学毕业，下学期继续读研究生。真是可喜可贺。";
                    title.textContent = "未来可期";
                    break;
                }
                case GONGZUO3_END:
                case GONGZUO2_END:
                    subtitle.textContent = "找到工作";
                    text.textContent = "毕业后有地方去了，正式成为社会人。";
                    title.textContent = "未来可期";
                    break;
                case BIYE_SHIYE_END: {
                    subtitle.textContent = "毕业即失业";
                    text.textContent = "大学四年顺利度过，但之后只能当家里蹲了。";
                    title.textContent = "未来可寄";
                    break;
                }
                case GONGZUO1_END: {
                    subtitle.textContent = "黑作坊牛马";
                    text.textContent = "不如高中直接进厂，少走四年弯路。";
                    title.textContent = "生不如死";
                    break;
                }
                case DANBIYE_END: {
                    subtitle.textContent = "单证战士";
                    text.textContent = "毕业了，但没完全毕业。其实……学位证也没那么重要？";
                    title.textContent = "未来可寄";
                    break;
                }
                case JIEYE_END: {
                    subtitle.textContent = "大学结业";
                    text.textContent = "甚至没能毕业。说好的大学宽进严出呢？";
                    title.textContent = "未来可寄";
                    break;
                }
                case XSH_END: {
                    subtitle.textContent = "学生会长";
                    text.textContent = "成为了这所学校的最高权力者。已经别无所求了。";
                    title.textContent = "隐藏结局";
                    break;
                }
                case GGZ_END: {
                    subtitle.textContent = "沉迷页游";
                    text.textContent = "氪到全服第一，强大无需多言。";
                    title.textContent = "隐藏结局";
                    break;
                }
                case NOBEL_END: {
                    subtitle.textContent = "诺奖得主";
                    text.textContent = "成为第一个诺贝尔数学奖得主。你就是创造历史的人！";
                    title.textContent = "隐藏结局";
                    break;
                }
            }
            document.body.appendChild(mainpage);



        }




        function setEnddataPage(player, endflag) {

            document.body.innerHTML = githubCorner;

            let fflag = endflag;
            if (endflag === BAOYAN_END) {
                if (flagBaoyan3) {
                    fflag = BAOYAN3_END;
                } else if (flagBaoyan2) {
                    fflag = BAOYAN2_END;
                } else if (flagBaoyan1) {
                    fflag = BAOYAN1_END;
                }
            }
            if (endflag === KAOYAN_END) {
                if (flagKaoYan3) {
                    fflag = KAOYAN3_END;
                } else if (flagKaoYan2) {
                    fflag = KAOYAN2_END;
                } else if (flagKaoYan1) {
                    fflag = KAOYAN1_END;
                }
            }
            let rank = end2rank(fflag);  //获得结局的评价等级


            let mainpage = document.createElement("div");

            let title = document.createElement("h1");
            title.textContent = "结算页";

            let container = document.createElement("div");

            let button = document.createElement("button");
            button.textContent = "选择通关特典";

            let endrankdiv = endRecordDiv(rank);

            let scorelist = document.createElement("ul");

            let wealthLi = document.createElement("li");
            let univLi = document.createElement("li");
            let intelligenceLi = document.createElement("li");
            let horizonLi = document.createElement("li");
            let financeLi = document.createElement("li");
            let battleLi = document.createElement("li");
            let endLi = document.createElement("li");

            scorelist.appendChild(wealthLi);
            scorelist.appendChild(univLi);
            scorelist.appendChild(intelligenceLi);
            scorelist.appendChild(horizonLi);
            scorelist.appendChild(financeLi);
            scorelist.appendChild(battleLi);
            scorelist.appendChild(endLi);
            container.appendChild(scorelist);


            let wealthspan = wealth2RatingSpan(player.wealth);
            wealthLi.appendChild(wealthspan);
            let univspan = univ2RatingSpan(player.univRank);
            univLi.appendChild(univspan);
            let intelspan = inte2RatingSpan(player.intelligence, endflag);
            intelligenceLi.appendChild(intelspan);
            let horspan = hor2RatingSpan(player.horizon);
            horizonLi.appendChild(horspan);
            let finspan = fin2RatingSpan(player.finance);
            financeLi.appendChild(finspan);
            let battlespan = battle2RatingSpan(player.battle);
            battleLi.appendChild(battlespan);
            let endspan = end2RatingSpan(endflag);
            endLi.appendChild(endspan);



            mainpage.appendChild(title);
            mainpage.appendChild(container);

            mainpage.appendChild(endrankdiv);
            mainpage.appendChild(button);

            mainpage.className = "enddata-page";
            title.className = "enddata-title";
            container.className = "enddata-container";
            endrankdiv.className = "enddata-rankdiv";
            button.className = "enddata-button";

            button.onclick = () => {
                //选择通关特典重开
                if (rank >= bestRecord) {
                    bestRecord = rank;
                }
                setGiftPage(bestRecord);
            }

            document.body.appendChild(mainpage);


        }







        //通关特典

        function setGiftPage(rank) {
            //根据上一轮结局评价，给予部分通关特典
            let maindiv = document.createElement("div");
            maindiv.className = "gift-page";

            let title = document.createElement("h2");
            title.textContent = "选择一项通关特典";
            title.className = "gift-title";
            if (rank >= A_END_RANK) {
                title.textContent = "历史最高评价达到A以上，可选择两项特典";
            }

            let button = document.createElement("button");
            button.className = "gift-button";
            button.textContent = "继承通关特典，再来一局！";
            let giftcontainer = document.createElement("div");
            giftcontainer.className = "gift-container";

            let currentGiftlist = ["one", "two", "three", "four", "five", "six", "seven", "eight", "nine", "ten"];
            let currentGiftDess = ["ich", "ni", "sann", "shi", "go", "roku", "nana", "hachi", "kyuu", "jyuu"];

            switch (rank) {
                case S_END_RANK: {
                    currentGiftlist = SrankGiftTexts;
                    currentGiftDess = SrankGiftDess;
                    break;
                }
                case A_END_RANK: {
                    currentGiftlist = ArankGiftTexts;
                    currentGiftDess = ArankGiftDess;
                    break;
                }
                case B_END_RANK: {
                    currentGiftlist = BrankGiftTexts;
                    currentGiftDess = BrankGiftDess;
                    break;
                }
                case C_END_RANK: {
                    currentGiftlist = CrankGiftTexts;
                    currentGiftDess = CrankGiftDess;
                    break;
                }
                case D_END_RANK: {
                    currentGiftlist = DrankGiftTexts;
                    currentGiftDess = DrankGiftDess;
                    break;
                }
                default: {
                    currentGiftlist = ErankGiftTexts;
                    currentGiftDess = ErankGiftDess;
                    break;
                }
            }

            let selectedgifts = [];

            for (let i = 0; i < currentGiftlist.length; i++) {
                let gdiv = document.createElement("div");
                let span1 = document.createElement("span");
                let span2 = document.createElement("span");
                gdiv.className = "gift-item";
                gdiv.appendChild(span1);
                gdiv.appendChild(span2);
                span1.textContent = currentGiftlist[i];
                span1.className = gift2SpanClassname(currentGiftlist[i]);
                span2.textContent = currentGiftDess[i];

                gdiv.addEventListener("click", function () {
                    if (span1.textContent === giftLowrank) {
                        return;
                    }
                    if (this.classList.contains("done")) {
                        let index = selectedgifts.indexOf(span1.textContent);
                        if (index !== -1) {
                            selectedgifts.splice(index, 1);
                        }
                        this.classList.toggle("done");
                        return;
                    }
                    if (selectedgifts.length >= 2) {
                        alert("最多选择两项特典");
                        return;
                    }
                    if (selectedgifts.length >= 1 && rank < A_END_RANK) {
                        alert("最多选择一项特典");
                        return;
                    }
                    this.classList.toggle("done");
                    selectedgifts.push(span1.textContent);
                })
                giftcontainer.appendChild(gdiv);
            }


            button.onclick = () => {
                if (selectedgifts.length < 2 && rank >= A_END_RANK) {
                    alert("历史最佳达到A以上，请选择两项特典");
                    return;
                }
                if (selectedgifts.length < 1) {
                    alert("请选择一项特典");
                    return;
                }
                if (selectedgifts.length === 1) {
                    resetGame(selectedgifts[0], giftnone);
                }
                if (selectedgifts.length === 2) {
                    resetGame(selectedgifts[0], selectedgifts[1]);
                }
            }



            maindiv.appendChild(title);
            maindiv.appendChild(giftcontainer);
            maindiv.appendChild(button);

            document.body.innerHTML = "";
            //document.body.innerHTML = githubCorner;
            document.body.appendChild(maindiv);

        }


        //重置游戏
        function resetGame(giftstring1, giftstring2) {
            //初始化与游戏进度相关的全局变量

            flagPinKunBuZhu = false;  //贫困补助
            flagXueShengHui = false; //学生会
            flagGuGuZhen = false;   //氪金页游
            flagNobel = false;    //诺奖相关事件
            eventPhase = 0;     //记录各事件进展阶段

            cetBase = 0;  //通过英语四级的基数
            shixiBase = 0;  //找到实习的基数
            flagCet = false;  //标志是否通过四级
            flagShixi = false;  //标志是否有实习经历
            flagRongYu = false;  //判断是否有（校级）荣誉

            numFailedExam = 0;  //表示挂过多少科
            numCurrentFail = 0;  //这学期多少门考试没通过
            flagJuanWang = false;  //与通关特典有关
            totalGPAArray = [];  //数组，用于储存考试成绩。元素是0-400的绩点，不是百分制成绩。

            specialDone = false;  //用于判断当前学期，是否已发生特殊事件
            jobpageDone = false; //用于表示第四年的求职计划页是否已显示
            flagQiuzhi = false;  //判断玩家是否投简历出去
            globalVocDivPointer = null;  //用来传参的一个全局指针，没实际含义
            flagGradeWarning = false;  //判断是否触发过学业警告，目前还没用到

            kaoyanBase = 0;  //考研分基数
            lunwenBase = 0;   //毕业论文基数
            flagBaoyan3 = false; //名校保研
            flagBaoyan2 = false;  //一般学校保研
            flagBaoyan1 = false;  //辣鸡学校保研
            flagKaoYan3 = false; //名校考研
            flagKaoYan2 = false; //一般校考研
            flagKaoYan1 = false;  //一志愿考研失败

            flagBaoyanEnd = false;
            flagKaoshangYan = false;  //考上研
            flagGongzuo3 = false;  //好工作
            flagGongzuo2 = false; //一般的工作
            flagGongzuo1 = false; //烂工作
            flagXuewei = false;  //毕业证+学位证
            flagDanbiye = false;  //单毕业证
            flagJieye = false;  //结业
            isEnd = false;  //非正常死亡


            // 初始化玩家信息。尚未实装的功能用TBD表示。
            //分别是 姓名、性别、家境、心情、体力、精力、智商、眼界、财商、幸运、风险、资金、年级、所上大学排名（初始值100）、专业代码（初始值0）、学期规划轮次（用于跟踪学期规划决断次数、期末考试成绩基础随机下限）、战斗力（初始值5）、学期（取值0-8，初始为0）、上学期绩点、总绩点
            let my = new Player("TBD", "TBD", 0, 100, 100, 100, 0, 0, 0, 0, 0, 0, 0, 100, 0, 0, 0, 5, 0, 0, 0);
            //通关特典
            //随机给出玩家初始属性。计算通关特典加成。
            initializePlayerBuild(my, giftstring1, giftstring2);
            //上大学前
            setMajorPage(my);
        }

        const githubCorner = `<a href="https://github.com/lingch16/UnivSimulator" target="_blank" class="github-corner" title="View source on GitHub">
        <svg width="80" height="80" viewBox="0 0 250 250" style="fill:#333; color:#fff; position: absolute; top: 0; border: 0; left: 0; transform: scale(-1, 1);" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path>
        <path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path>
        <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path>
        </svg>
        </a>`
    </script>
</body>

</html>